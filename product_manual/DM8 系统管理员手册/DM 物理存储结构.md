

# DM 物理存储结构

DM 数据库使用了磁盘上大量的物理存储结构来保存和管理用户数据。典型的物理存储结构包括：用于进行功能设置的配置文件；用于记录文件分布的控制文件；用于保存用户实际数据的数据文件、重做日志文件、归档日志文件、备份文件；用来进行问题跟踪的跟踪日志文件等，如图 2.1 所示。

![图 2.1 DM 物理存储结构示意图.jpg](https://eco.dameng.com/eco-file-server/file/eco/preview/20221024151148YNU68C8RRS4GDL4TSL)

图2.1 DM物理存储结构示意图

## 2.1 配置文件

配置文件是 DM 数据库用来设置功能选项的一些文本文件的集合，配置文件以 ini 为扩展名，它们具有固定的格式，用户可以通过修改其中的某些参数取值来达成如下两个方面的目标：

  1. 启用/禁用特定功能项；
  2. 针对当前系统运行环境设置更优的参数值以提升系统性能。



### 2.1.1 DM 数据库服务配置

#### 2.1.1.1 dm.ini

每创建一个 DM 数据库，就会自动生成 dm.ini 参数文件。dm.ini 是 DM 数据库启动所必须的配置文件，通过配置该文件可以设置 DM 数据库服务器的各种功能和性能选项，主要的配置模块包括：控制文件相关、实例名、内存相关、线程相关等。

参数属性分为三种：手动、静态和动态。

手动，不能被动态修改，必须手动修改 dm.ini 参数文件，然后重启才能生效。

静态，可以被动态修改，修改后重启服务器才能生效。

动态，可以被动态修改，修改后即时生效。动态参数又分为会话级和系统级两种。会话级参数被修改后，新参数值只会影响当前会话和新创建的会话，之前创建的会话不受影响；系统级参数的修改则会影响所有的会话。

其中，动态修改是指 DBA 用户可以在数据库服务器运行期间，通过调用系统过程 SP_SET_PARA_VALUE()、SP_SET_PARA_DOUBLE_VALUE()和 SP_SET_PARA_STRING_VALUE()对参数值进行修改。当动态修改 dm.ini 参数文件时，如果遇到磁盘空间不足导致系统崩溃的情况，需要手动使用 dm.ini 文件所在目录下的 dm.ini.dmbak 文件恢复 dm.ini，并重启服务器。

当手动修改 dm.ini 参数文件且将 dm.ini 中的某参数值设置为非法值时，若设置值与参数类型不兼容，则参数实际取值为默认值；若设置值小于参数取值范围的最小值，则实际取值为最小值；若设置值大于参数取值范围的最大值，则实际取值为最大值。

当动态修改 ini 参数且设置参数为非法值时，包括设置值与参数类型不兼容、设置值小于参数取值范围的最小值、设置值大于参数取值范围的最大值三种情况，均进行报错处理。

##### 2.1.1.1.1   控制文件相关

控制文件相关参数。注意：本类参数不建议用户修改。

 表 2.1 dm.ini 中控制文件相关参数 



##### 2.1.1.1.2   实例名

 表 2.2 dm.ini 中实例名相关参数 



##### 2.1.1.1.3   内存相关

表 2.3 dm.ini 中内存相关参数



##### 2.1.1.1.4   线程相关

表 2.4 dm.ini 中线程相关参数



##### 2.1.1.1.5   查询相关

表 2.5 dm.ini 中查询相关参数



##### 2.1.1.1.6   检查点相关

表 2.6 dm.ini 中检查点相关参数



##### 2.1.1.1.7   IO 相关

表 2.7 dm.ini 中 IO 相关参数



##### 2.1.1.1.8   数据库相关

表2.8 dm.ini中数据库相关参数

|**参数名**|**缺省值**|**属性**|**说明**|
|---|---|---|---|
|MAX_SESSIONS|10000|静态|系统允许同时连接的最大数。取值范围 1~150000。如果在安全版环境下，该参数还受到 LICENSE 的限制，取二者中较小者。当会话数达到 MAX_SESSIONS 值后，为了保证管理员可继续管理数据库，允许 SYSDBA 额外开启 10 个会话连接|
|MAX_CONCURRENT_TRX|0|动态，系统级|表示系统支持同时运行事务数的最大值。取值范围 0~1500，0 表示不控制  注：这个参数仅在需要超大数量连接时才需要设置|
|CONCURRENT_DELAY|16|动态，系统级|表示新创建的连接，延迟多少秒之后参与事务限流机制。仅当 MAX_CONCURRENT_TRX 非 0 时生效。取值范围 0~1000， 单位秒。0 表示立即参与|
|TRX_VIEW_SIZE|512|静态|事务视图中本地事务 ID 的缓存初始化个数。取值范围 16~150000。如果配置了 MAX_CONCURRENT_TRX 参数（MAX_CONCURRENT_TRX>0），那么 TRX_VIEW_SIZE 的取值为 TRX_VIEW_SIZE、MAX_CONCURRENT_TRX 和 MAX_SESSIONS 三者中最小的值|
|TRX_VIEW_MODE|1|静态|控制 MVCC 事务可见性判断的方式。0：事务启动前收集当前时刻的活动事务 ID 构造可见性视图，以确定某一特定事务是否对当前事务可见；1：系统维护事务提交历史，以此判断事务可见性|
|TRX_CMTARR_SIZE|10|静态|提交状态事务数组的大小，仅当 TRX_VIEW_MODE 为 1 时有效。单位为百万，取值范围 3~1000。此参数设置越大，内存消耗越多，当应用为高并发，单位时间内事务完成数量大时，可将此参数值设大|
|MAX_SESSION_STATEMENT|10000|动态，系统级|单个会话上允许同时打开的语句句柄最大数，取值范围 64~20480）|
|MAX_SESSION_MEMORY|0|动态，系统级|单个会话的运行内存上限，单位 MB，取值范围 0~262144，0 表示不限制|
|MAX_CONCURRENT_OLAP_QUERY|0|静态|OLAP 模式下能同时执行的复杂查询个数，超过限制后，复杂查询将在执行阶段进入等待。0 表示不做限制。取值范围 0~100  注：此处的复杂查询是指计划中存在行数超过参数 BIG_TABLE_THRESHHOLD*10000 的节点，含有哈希连接、哈希分组等耗内存操作符，且不涉及到系统表|
|BIG_TABLE_THRESHHOLD|1000|动态，会话级|OLAP 环境下对复杂查询最大并发数（参数 MAX_CONCURRENT_OLAP_QUERY）进行限制时，认定是否为复杂查询中表的行数下限，单位为万。取值范围 0~4294967294|
|MAX_EP_SITES|64|静态|MPP 环境下 EP 站点的最大数量，取值范围 2~1024|
|PORT_NUM|5236|静态|服务器监听通讯端口号，服务器配置此参数，取值范围 1024~65534，发起连接端的端口在 1024-65535 之间随机分配|
|LISTEN_IP|空串|手动|与 PORT_NUM 配合使用，监听 IP 地址。若指定，则连接时必须指定与该值一样的 IP，否则创建连接失败|
|FAST_LOGIN|2|静态|是否在登录时记录登录失败历史信息。0 是，同步记录；1 否，不记录；2 是，异步记录，当同一个用户的登录失败记录数超过 100，则清理前面过早的登录失败记录，避免登录相关系统表 SYSACCHISTORIES 膨胀|
|DDL_AUTO_COMMIT|1|静态|指定 DDL 语句是否自动提交，1：自动；0：手动|
|COMPRESS_MODE|0|动态，会话级|建表时是否缺省压缩。0：不进行；1：进行|
|PK_WITH_CLUSTER|0|动态，会话级|在建表语句或增加约束语句中指定主关键字时，是否缺省指定为 CLUSTER，0：不指定；1：指定  注：该参数对水平分区表、列存储表和堆表无效|
|EXPR_N_LEVEL|200|动态，会话级|表达式最大嵌套层数。取值范围 30~1000|
|N_PARSE_LEVEL|100|动态，会话级|表示对象 proc、view、pkg、class 的最大解析层次，如果层次过深则报错返回。取值范围 30~1000|
|MAX_SQL_LEVEL|500|动态，系统级|指定 DM 虚拟机允许的最大栈帧数。取值范围 100~1000。此参数值设置过大可能会导致内存暴涨，管理员需斟酌设置|
|BDTA_SIZE|300|静态|BDTA 缓存的记录数。取值范围 1~10000|
|OLAP_FLAG|2|动态，会话级|启用联机分析处理，0：不启用；1：启用；2：不启用，同时倾向于使用索引范围扫描|
|JOIN_HASH_SIZE|500000|动态，会话级|hash  join 操作时，hash 表大小，以 cell 个数为单位。取值范围 1~250000000|
|HFILES_OPENED|256|静态|设置可以同时打开的列存储表数据文件个数。取值范围 60~10000|
|ISO_IGNORE|0|动态，会话级|是否忽略显示设置的事务隔离级别，1 表示忽略，0 不忽略|
|TEMP_SIZE|10|静态|默认创建的临时表空间大小，单位 MB。取值范围 10~1048576|
|TEMP_SPACE_LIMIT|0|动态，系统级|临时表空间大小上限，单位 MB。0 表示不限制临时表空间大小。  取值范围 0~4294967294。  注：TEMP_SPACE_LIMIT 一定要大于等于 TEMP_SIZE|
|FILE_TRACE|0|静态|日志中是否记录文件操作，0：不记录；1：记录|
|COMM_TRACE|0|动态，系统级|服务器日志是否记录通信中产生的警告信息。0：不记录；1：记录|
|ERROR_TRACE|0|动态，会话级|服务器日志中是否记录语法分析出错的语句。1：是，0：否|
|CACHE_POOL_SIZE|100|静态|SQL 缓冲池大小，单位 MB。取值范围：32 位平台下为 12048；64 位平台下为 167108864|
|PLN_DICT_HASH_THRESHOLD|20|静态|仅当 CACHE_POOL_SIZE 参数值大于等于此参数值时，才开启缓存计划的字典关联登记。取值范围：32 位平台下为 12048；64 位平台下为 167108864。单位 MB|
|STAT_COLLECT_SIZE|10000|动态，会话级|统计信息收集时，样本的最小行数。取值范围 0~10000000|
|STAT_ALL|0|动态，会话级|在估算分区表行数时，控制一些优化。0：不采样所有分区子表；1：采样所有分区子表；2：优先采用统计信息中的行数；4：水平分区表不使用主表统计信息而使用叶子表统计信息。  支持使用上述有效值的组合值，如 3 表示优先采用统计信息中的行数，如果没有找到对应统计信息，则去采样所有分区子表。|
|TABLE_STAT_FLAG|0|动态，会话级|控制表统计信息的使用方式。0：以默认方式使用统计信息，不进行优化；1：MPP 环境下，对于 range/list 水平分区表，估算行数时优先采用统计信息的收集值；2：当开启对表的数据量监控时，对变化行数达到阈值的表，使其统计信息在分析阶段失效；4：优先从表统计信息中获取表行数。.支持使用上述有效值的组合值，如 3 表示同时进行 1 和 2 的优化|
|PHC_MODE_ENFORCE|0|动态，会话级|控制连接的实现方式。  0：优化器根据代价情况自由选择连接方式；  1：允许使用 nest loop inner join；  2：允许使用索引连接；  4：允许使用哈希连接；  8：允许使用归并连接  支持使用上述有效值的组合值，如 6 表示优化器根据代价情况在索引连接和哈希连接间进行选择。  当参数值不为 0 或 15 且包含 2/4/8 其中之一或者它们的组合值时，会将包含的值对应的连接模式参数置为 1，没有包含的值对应的连接模式参数置为 0（2 对应 ENABLE_INDEX_JOIN，4 对应 ENABLE_HASH_JOIN，8 对应 ENABLE_MERGE_JOIN）。例如，取值为 6 时没有包含 8，则会将 ENABLE_INDEX_JOIN 和 ENABLE_HASH_JOIN 置为 1，将 ENABLE_MERGE_JOIN 置为 0（仅强制设置内存中的值，不改变 dm.ini 文件中的值）|
|ENABLE_HASH_JOIN|1|动态，会话级|是否允许使用哈希连接，0：不允许；1：允许。|
|ENABLE_INDEX_JOIN|1|动态，会话级|是否允许使用索引连接，0：不允许；1：允许。|
|ENABLE_MERGE_JOIN|1|动态，会话级|是否允许使用归并连接，0：不允许；1：允许|
|MPP_INDEX_JOIN_OPT_FLAG|1|动态，会话级|MPP 下，是否可以使用索引左外连接，0：不使用；1：使用|
|MPP_NLI_OPT_FLAG|1|动态，会话级|MPP 下嵌套连接的优化方式。0：嵌套连接操作的左右孩子添加 MPP GATHER，汇总到主 EP 执行， 父节点添加 MPP SCATTER；1：根据左右孩子的实际情况添加通讯操作符，若当前情况为左孩上的数据为 PART（分布在每个站点上的数据都是部分的），右孩子上的数据为 FULL（数据在每个站点上分布都是完全的），则不添加；若两个孩子均为 PART，则在数据量少的那个孩子上添加 MPP GATHER 和 MPP SCATTER；2：根据左右孩子的实际情况添加通讯操作符，若当前情况为右孩子为 PART，左孩子为 FULL 则不添加；若两个孩子均为 PART，则在数据量少的那个孩子上添加 MPP GATHER 和 MPP SCATTER；3：嵌套连接操作的左右孩子都添加 MPP GATHER 和 MPP SCATTER|
|MAX_PARALLEL_DEGREE|1|动态，会话级|用来设置默认并行任务个数。取值范围 1~128。缺省值 1，表示无并行任务。当 PARALLEL_POLICY 值为 1 时该参数值才有效|
|PARALLEL_POLICY|0|动态，会话级|用来设置并行策略。取值范围：0、1 和 2，缺省为 0。其中，0 表示不支持并行；1 表示自动并行模式；2 表示手动并行模式。不支持 HINT 方式指定该参数|
|PARALLEL_THRD_NUM|10|静态|用来设置并行工作线程个数。取值范围 1~1024|
|PARALLEL_THRD_TARGET|0|动态，系统级|用于设置并行线程池中保留的线程数上限。取值范围 0~10240，0 表示不设限，系统将根据压力自动控制空闲线程数|
|PARALLEL_MODE_COMMON_DEGREE|1|动态，会话级|并发模式程度。此值越大，扫描代价将越大，越倾向于使用索引连接而不是哈希连接，需酌情使用。取值范围 1~1024|
|PUSH_SUBQ|0|动态，会话级|是否下放子查询使先做。0：始终不下放；1：相关子查询且不存在单表过滤条件时下放；2：相关子查询始终下放；4：非相关子查询下放|
|OPTIMIZER_AGGR_GROUPBY_ELIM|1|动态，会话级|当对派生视图进行分组查询，且分组项是派生视图分组项的子集时，是否允许将两层分组进行合并。0：不优化；1：将两层分组进行合并|
|UPD_TAB_INFO|0|静态|系统启动时是否更新表信息（如行数），1：启用更新；0：不更新|
|ENABLE_IN_VALUE_LIST_OPT|518|动态，会话级|是否允许 IN LIST 表达式优化。0：不优化；  1：将 IN LIST 表达式在语义分析阶段优化为 CONST VALUE LIST；   2：将 IN LIST 表达式在代价优化阶段优化为 CONST VALUE LIST；  4：生成传递闭包优化；  8：将 IN LIST 表达式优化为范围条件，仅限于 HUGE 表；  16：OR 表达式优化为 LIST IN LIST 表达式时，允许 LIST 中的列来源于不同的表；  32：允许 IN list 表达式中的列为分区列时转化为 SEMI JOIN；  64：当 IN LIST 表达式左侧包含多列，并且包含非列类型表达式时，允许将其优化为 CONST VALUE LIST；  128：分析阶段将 in value list 表达式转换为 or 表达式256：使用索引连接时，当连接条件中有多个 IN 表达式时，多个 IN 表达式会先做连接。取该值时，不允许分析阶段 IN 连接后的行数超过一万行；512：语义分析阶段将多列 NOT IN 转换为 NULL_EQU 函数，预期走批量计算，提升执行效率；目前仅支持 NOT IN 为常量值链表时进行转换；1024：在取值 1 关闭情况下，将表连接(JOIN)的 IN LIST 表达式在语义分析阶段优化为 CONST VALUE LIST；2048：扩大 IN LIST 作为 JOIN CONDITION 的代价，缩减其转换为 CONST VALUE LIST 的代价；4096：增强 OR 表达式转换为 IN 表达式（或者 AND 表达式转换为 NOT IN 表达式）的优化，将转换后的 IN 表达式（IN LIST 或 LIST IN LIST）按数据类型（仅限数值和字符类型）进行拆分，避免转换后的不等价引发的报错或结果错误；该增强优化仅在 OR 表达式转换为 IN 表达式（或者 AND 表达式转换为 NOT IN 表达式）的优化生效后有效支持使用上述有效值的组合值，如 3 表示同时进行 1 和 2 的优化|
|ENHANCED_BEXP_TRANS_GEN|3|动态，会话级|0：不允许非等值布尔表达式和外连接 ON 条件中的传递闭包；1：允许非等值布尔表达式和外连接 ON 条件中的传递闭包；2：分析阶段针对表达式通过传递闭包产生的表达式进行去重处理；4：允许将 IN LIST 过滤条件传递到非相关子查询内部  支持使用上述有效值的组合值，如 3 表示同时进行 1 和 2 的优化|
|ENABLE_DIST_VIEW_UPDATE|0|动态，系统级|是否支持更新含有 distinct 的视图，1：允许；0：不允许，当 COMPATIBLE_MODE=1 时，ENABLE_DIST_VIEW_UPDATE 的实际值均为 1|
|STAR_TRANSFORMATION_ENABLED|0|动态，会话级|是否允许对星形模型查询改写以使用位图连接索引。0：不启用；1：启用  此参数仅在 OLAP_FLAG 为 1 时才有效|
|MONITOR_INDEX_FLAG|0|动态，会话级|是否对索引进行监控，0：关闭自动监控，可使用 ALTER  INDEX 语句启用索引监控；1：打开自动监控，对用户定义的二级索引进行监控；2：禁止索引监控|
|AUTO_COMPILE_FLAG|1|动态，系统级|用于加载失效对象时是否自动编译，0：否；1：是|
|RAISE_CASE_NOT_FOUND|0|动态，系统级|CASE 语句 NOT FOUND 是否抛出异常。0：不抛出；1：抛出|
|FIRST_ROWS|100|动态，系统级|结果集一个消息中返回的最大行数，取值范围 1~1000000|
|LIST_TABLE|0|动态，会话级|默认情况下，创建的表是否为堆表，0：否；1：是|
|ENABLE_SPACELIMIT_CHECK|1|静态|是否启用创建表时定义的空间限制 DISKSPACE LIMIT 功能。1：启用；0：不启用|
|BUILD_VERTICAL_PK_BTREE|0|静态|HUGE 表上创建的主键是否需要创建物理 B 树。0：不创建；1：创建|
|BDTA_PACKAGE_COMPRESS|0|动态，会话级|是否启动 bdta 压缩传递功能， 0：不压缩；1：压缩；2：根据数据特征自适应选择是否压缩，取值 2 仅限在 DMDPC 环境下使用|
|HFINS_PARALLEL_FLAG|0|动态，系统级|是否启动 HUGE 表查询插入优化。0：否；1：对非 HUGE 分区表进行优化；2：对 HUGE 分区表也进行优化|
|HFINS_MAX_THRD_NUM|100|动态，系统级|HUGE 表查询插入优化时并行的最大线程数，取值范围 4~200|
|LINK_CONN_KEEP_TIME|15|静态|DBLINK 空闲连接缓存存在时间，单位分钟，为 0 时表示不缓存 DBLINK 连接，取值范围 0~2147483647。建议在频繁使用有限的几个 DBLINK 的时候开启该参数并设置较长时间，以便重用连接；在使用的大部分是不同的 DBLINK 时，单个 DBLINK 被重用的几率很小，此时可以考虑不设置该参数|
|MAX_LINK_SESSIONS|10000|静态|用于设置 DBLINK 连接会话数的上限值，取值范围 1~150000。当 DBLINK 连接会话数达到该上限值时，服务器将释放空闲的 DBLINK 连接，再新建连接会话；若无空闲连接，则拒绝建立新连接|
|DETERMIN_CACHE_SIZE|5|动态，会话级|确定性函数值缓冲区大小，单位 MB|
|NTYPE_MAX_OBJ_NUM|1000000|动态，系统级|复合数据类型中包含的对象或者字符串的总个数，以及查询中包含的变量的总个数，取值范围为 2000~100000000|
|CTAB_SEL_WITH_CONS|0|动态，会话级|查询建表时，是否对原始表上的相关信息进行拷贝。0：否（若源列不是主键列，且显式指定了 NOT NULL 约束，则拷贝源列的非空信息）；1：对原始表上的约束进行拷贝；2：对原始表上的表结构、分区信息、存储信息以及部分表约束进行拷贝。其中，CTAB_SEL_WITH_CONS=1 时，不支持 huge 表|
|HLDR_BUF_SIZE|8|动态，系统级|进行 HUGE 表导入时，缓冲区的大小，单位 MB，取值范围 4~1024|
|HLDR_BUF_TOTAL_SIZE|4294967294|动态，系统级|HLDR 资源控制，系统所有 HLDR 使用的 HLDR_BUF 空间的总量，单位 MB。取值范围 100~ 4294967294|
|HLDR_REPAIR_FLAG|0|动态，系统级|使用 dmfldr 装载数据时如发生错误，对错误的处理方式。0：完全回滚方式，数据将回到装载前的状态；1：修复方式，系统将数据修复到最后一个完整装载的数据区。此外，若此参数为 1，dmfldr 装载数据时不支持对事务型 HUGE 表二级索引进行维护|
|HLDR_FORCE_COLUMN_STORAGE|1|动态，系统级|装载最后一个数据区是否强制列存。1：是；0：否|
|HLDR_FORCE_COLUMN_STORAGE_PERCENT|80|动态，系统级|装载 HUGE 表时最后一个数据区强制列存的最低数据百分比。取值范围 50~100|
|HLDR_HOLD_RATE|1.5|动态，系统级|HLDR 最多保持重用 HLDR_BUF 的个数与目标表列数的比例。取值范围 1~65535|
|HLDR_MAX_RATE|2|动态，系统级|HLDR 同时使用的 HLDR_BUF 的最大个数与目标表列数的比例。取值范围 2~65535|
|HUGE_ACID|0|动态，系统级|是否支持 HUGE 表增删改与查询的并发，取值范围：0、1、2。  0：不支持 HUGE 表增删改与查询的并发；  1：支持 HUGE 表增删改与查询的并发，操作符 hflkup 检查数据区是否上锁时使用二分查找；  2：支持 HUGE 表增删改与查询的并发，操作符 hflkup 检查数据区是否上锁时使用遍历查找|
|HUGE_STAT_MODE|2|动态，会话级|设置默认情况下是否计算 with  delta 的 HUGE 表各列的统计信息，取值范围：0、1、2。  0：不计算统计信息；  1：实时计算统计信息；  2：异步计算统计信息|
|HFS_CHECK_SUM|1|静态|是否为 HUGE 表数据区进行和校验：0：否；1：是|
|HBUF_DATA_MODE|0|静态|huge 表数据缓冲区中缓存数据的格式，取值范围：0、1，缺省值为 0  0：格式与数据文件中的数据块格式一致  1：当数据块是压缩加密时，缓存解密解压后的数据|
|DBLINK_OPT_FLAG|509|动态，会话级|控制对 DBLINK 的优化。  0：不进行优化；  1：允许 dblink 整体优化，采用原始方式；  2：dblink 局部优化，采用老方式；  4：dblink 局部优化，采用新方式；  8：异构数据库情况下进行兼容性检查，根据表达式类型检查是否可以在异构数据库执行，如果不支持，则不对此表达式进行进行收集；  16：采用新方式局部优化时，考虑视图、派生表、子查询、查询表达式是否可以整体优化；  32：采用新方式局部优化时，支持外连接 WHERE 过滤条件的优化；  64：支持 member_access 转换为变量的优化方式；  128：增删改支持新方式优化；  256：计划生成阶段增加 dblink 优化，支持连接条件转换为变量的优化方式，并对 dblink 存在过滤条件的场景进行优化；  512：支持物化视图明细表是基于 DM 到异构数据库 DBLINK 的远程表；  1024：若查询包含 DBLINK，则将 LIKE 表达式的数据类型强制转为 VARCHAR(4000)，防止查询发给 ORACLE 后字符串超长报错；  2048：DBLINK 根据远端的统计信息进行代价计算;4096: 在多次执行的 Remote scan 操作符前插入 nTTS2 操作符，使用临时表接收远程数据，减少 Remote scan 执行次数。 支持使用上述有效值的组合值，如 61 表示同时进行 1、4、8、16、32 的优化。取值 16 和 32 只有和取值 4 组合才有意义|
|DBLINK_LOB_LEN|8|动态，系统级|使用 DBLINK 访问大字段类型时，大字段的长度限制。单位 KB，取值范围 4~1024|
|FILL_COL_DESC_FLAG|0|动态，系统级|服务器返回给客户端的结果集是否含有列描述信息，0：否；1：是|
|BTR_SPLIT_MODE|1|动态，系统级|B 树叶子节点分裂方式，取值范围：0~15，按位标识：0：按对半分裂，B 树插入满一页后从当前页的中间行分裂成两个页，然后重新定位插入；1：在插入点进行分裂，插满一页后重新分配一个新页插入新数据；2：二级索引开启 B 树插入封锁优化，B 树分裂时先尝试 X 封锁叶子页的父亲页，而不是直接 X 封锁整棵 B 树；4：包含索引键值的聚集索引开启 B 树插入封锁优化，B 树分裂时先尝试 X 封锁叶子页的父亲页，而不是直接 X 封锁整棵 B 树；8：不包含索引键值的聚集索引开启 B 树插入封锁优化，B 树分裂时先尝试 X 封锁叶子页的父亲页，而不是直接 X 封锁整棵 B 树|
|TS_RESERVED_EXTENTS|64|静态|系统为每个表空间提前预留的簇个数，减少系统在执行过程中申请不到空间的情况。取值范围 2 ~ 1024。  注：DMDSC 环境下，该参数所有站点需要保持一致|
|TS_SAFE_FREE_EXTE|512|静态|系统认为安全的 free extents 空间，取值范围 128~65534。  注：DMDSC 环境下，该参数所有站点需要保持一致|
|TS_MAX_ID|8192|静态|限制系统所支持的最大表空间 ID，取值范围 512~65517，  与系统实际最大 id 比较，取大。  如果设置为 590，但是系统最大 id 已经为 1000 了，最后结果是 1000。  注：DMDSC 环境下，该参数所有站点需要保持一致|
|TS_FIL_MAX_ID|2048|静态|限制每个表空间所支持的最大文件个数，取值范围 64~8191  注：DMDSC 环境下，该参数所有站点需要保持一致|
|DECIMAL_FIX_STORAGE|0|动态，会话级|是否将长度为 1~18 的 DECIMAL/DEC 类型转换为定长方式存储。0：否；1：是。  若转换为定长存储，则 DECIMAL(P,S)的转换规则为：当 0\<P\<10 时，存储为 4 字节整型值；当 10\<=P\<19 时，存储为 8 字节整型值|
|SAVEPOINT_LIMIT|512|动态，系统级|单个事务中最大可创建的保存点个数。取值范围 0~10000|
|SQL_SAFE_UPDATE_ROWS|0|动态，系统级|SQL 安全更新控制参数。取值范围：0：关闭 SQL 安全更新；1~2147483647：启用 SQL 安全更新，SQL 语句每次允许影响行数的最大值为指定的参数值|
|ENABLE_HUGE_SECIND|1|动态，系统级|是否支持事务型 HUGE 表二级索引的维护，0：不支持；1：支持|
|LOB_MAX_INROW_LEN|900|动态，系统级|指定数据库 LOB 字段的行内数据存放的上限大小，单位为 BYTE，取值范围 900~8000|
|RS_PRE_FETCH|0|动态，系统级|查询操作结果集返回时是否进行预填充，仅适用于 FORWORD_ONLY 游标的结果集。0：不预填充；1：预填充，即在一批数据返回客户端后会自动进行预取下一批数据；2：在开启消息压缩时，提前压缩结果集，提升消息响应速度|
|TIMER_TRIG_CHECK_INTERVAL|60|动态，系统级|服务器端检查触发器是否触发的时间间隔，单位为秒，即每过设置的秒数检查触发器是否需要触发，取值范围 1~60|
|INNER_INDEX_DDL_SHOW|1|动态，会话级|用于 DBMS_metadata 包查询索引结果。0: 查询系统的内部索引定义报错；1：允许查询系统的内部索引定义|
|HP_STAT_SAMPLE_COUNT|50|动态，系统级|水平分区表采集统计信息时，子表的最大采样数，取值范围 1~65535|
|MAX_SEC_INDEX_SIZE|16384|静态|控制二级索引记录的最大长度。取值范围 512~32768，单位 BYTE|
|PWR_FLUSH_PAGES|10000|动态，系统级|控制生成特殊 PWR 记录的频率，每写入 PWR_FLUSH_PAGES 页到磁盘，即生成一条特殊的 PWR 记录，标记之前的 PWR 记录是有效的。取值范围 0~4294967294|
|REDO_UNTIL_LSN|空串|静态|系统故障重启时，重做 REDO 日志的最大 LSN 值。  使用这个参数要十分慎重，一般只在数据库文件系统损坏，系统无法正常启动情况下使用，通过指定这个参数，将数据库恢复到稍早时间点，让数据库可以正常启动，以便抢救部分数据。  注：使用这个参数后，会截断指定 LSN 之后的所有日志。另外，系统启动后，一定不要忘记将参数值重新修改为缺省值|
|IGNORE_FILE_SYS_CHECK|1|静态|系统重启时，是否检查 SYSTEM/ROLL/MAIN 表空间文件系统。0：检查文件系统；1：不检查文件系统，在实际使用空间比较大情况下，可以考虑关闭文件系统检查，提高系统启动速度；2：检查文件系统，同时检查表空间全局空闲链表是否正常，若异常则截断该空闲链表|
|FILE_SCAN_PERCENT|100.0|动态，系统级|V$DATAFILE 查询时控制抽样比例，最多抽样 10000 页； 在 50 页以下的不抽样。取值范围 0~100.0，0 相当于 100|
|STARTUP_CHECKPOINT|0|静态|系统启动时 REDO 后是否强制做完全检查点。  0：不强制；1：强制|
|CHECK_SVR_VERSION|1|静态|数据库记录的执行码版本比当前 Server 版本高时，是否报错。0：不报错；1：报错，服务器不能启动成功|
|ID_RECYCLE_FLAG|0|静态|是否开启 ID 资源回收功能。1 是，即在服务器启动后，对于新申请的表 ID、索引 ID、约束 ID，如果 ID 最终未成功使用，则 ID 会被暂时放入回收缓存中，以备下次申请使用，服务器关闭后，缓存中的 ID 会被全部丢弃；0 否|
|TRXID_UNCOVERED|0|动态，会话级|是否禁止二级索引覆盖。0：否，使用二级索引覆盖，当更新不涉及二级索引时，查询最大 TRXID 可能比聚集索引的最大 TRXID 小；1：是|
|GEN_SQL_MEM_RECLAIM|1|动态，系统级|语句块执行是否提前回收空间。0：否；1：是，语句块生成各个 sql 计划后，都需尝试回收部分 pha 内存空间|
|ENABLE_PMEM|0|静态|Linux 系统中，是否使用 Intel 提供的动态库（libpmem.so）读写存储在持久性内存上的联机日志文件。libpmem.so 由 INTEL 公司提供，可通过安装 INTEL 硬件持久性内存获取。  0：否，使用系统 IO 接口读写；  1：是，安装了非易失性存储介质并且文件存储于持久性内存才使用 Intel 动态库读写，否则仍然使用系统 IO 接口读写。此种情况不支持 RESIZE  LOGFILE 语句和 RENAME LOGFILE 语句|
|HP_TAB_COUNT_PER_BP|1|动态，会话级|创建一级、二级哈希分区时，如果分区数指定为 DEFAULT 而不是具体数值，系统会根据本参数值决定每个 BP RAFT 上创建的哈希子表个数。  取值范围 1~1024|
|SQC_GI_NUM_PER_TAB|1|动态，会话级|每个表拆分的扫描单元个数。取值范围 1~1024。  扫描表对象时，每个表可以被拆分成多个单元以提升并行性能。参数值表示拆分的单元个数，每个单元可以独立用于工作线程的扫描任务。例如：需要扫描一个子表且子表数据量较大，为充分利用工作线程资源，可以调大此参数以使用分区内并行|
|DBLINK_USER_AS_SCHEMA|1|动态，会话级|是否将当前用户名作为缺省模式名（或库名）。0：否；1：是。目前仅对 ODBC 类型的 DBLINK 有效|
|CTAB_MUST_PART|0|动态，系统级|用户表是否只能创建为分区表。0：否；1：是|
|CTAB_WITH_LONG_ROW|0|动态，系统级|是否尝试在建表时隐式指定 USING LONG ROW 来开启超长记录存储功能。0：否；1：是。  当该参数为 1 时，只有满足附加条件的情况下才会成功开启超长记录存储功能，未满足条件的不能开启。  附加条件：  1. 非 HUGE 表、临时表和外部表  2. 建表不包含聚集主键约束  3. 如果是分区表，则不包含 ENABLE ROW MOVEMENT 子句  4. 整行记录总长度超长。长度上限可参考《DM8 SQL 语言使用手册》中表 1.4.1。当 CTAB_WITH_LONG_ROW=1 时，可通过 DISABLE USING LONG ROW 关闭隐式开启的超长记录存储功能|
|TMP_DEL_OPT|1|动态，系统级|是否对临时表删除进行优化。0：不优化；1：如果不要求临时表可回滚，则对于无过滤条件的临时表删除语句，在执行删除时直接清除其临时段数据|
|LOGIN_FAIL_TRIGGER|0|动态，系统级|登录失败时是否触发 LOGIN/LOGON 触发器。0：不触发；1：触发|
|INDEX_PARALLEL_FILL|0|动态，系统级|控制查询插入时二级索引是否启用并行填充。如果表上存在多个二级索引并且没有全文索引，在插入操作符执行时，一旦检测到本次填充的记录行数大于等于此参数指定值，则为每一个二级索引生成一个异步索引填充任务，由任务线程并行执行，以提升查询插入的执行效率。取值范围 0~10000，0 表示关闭并行填充|
|CIND_CHECK_DUP|0|动态，系统级|指定创建索引时检查索引冗余的方式，以及建表时是否检查重复的 UNIQUE 约束。  0：创建索引时已存在同类型且相同索引列的索引则报错，建表时不检查重复的 UNIQUE 约束  1：创建索引时已存在相同索引列的索引则报错，建表时检查重复的 UNIQUE 约束|
|TSMV_RAFIL_SIZE|64|静态|DMDPC 专用。指定表空间迁移的临时归档文件的最大空间。取值范围 2~1024。单位 Mb|
|TSMV_FILE_COPY_PLL|1|动态，系统级|DMDPC 专用。表空间迁移时物理文件拷贝并行度。取值范围 1~128|
|TSMV_WAIT_TIMEOUT|120|动态，会话级|DMDPC 专用。表空间中表对象封锁超时的时间。取值范围 0~12000，单位秒|
|TSMV_SEND_BUF_SIZE|4|动态，系统级|DMDPC 专用。表空间迁移发送文件缓冲区大小。单位 MB，取值范围 1~64。值越小，迁移越慢，但迁移中对并发业务影响越小；值越大迁移速度越快，但迁移中对并发业务影响越大，可结合实际情况设置|
|HUGE_ENABLE_DEL_UPD|1|动态，系统级|是否允许对 HUGE 表数据进行更新或删除。0：不允许更新或删除；1：允许更新或删除；2：不允许更新；3：不允许删除|
|HUGE_DEFAULT_FILE_SIZE|64|动态，系统级|创建 HUGE 表时，storage 子句中 filesize 的默认值，取值范围 16~1048576|
|HUGE_DEFAULT_SECTION_SIZE|65536|动态，系统级|创建 HUGE 表时，storage 子句中 section 的默认值，取值范围 1024~1048576|
|STAT_OPT_FLAG|0|动态，会话级|生成统计信息的优化。0：不优化；1：生成统计信息时不存储左孩子的数据，以在某些场景表实现性能的提升|
|ALLOWED_CLIENT_VERSIONS|空串|静态|控制可连接服务器的客户端版本，最多可配置 10 个支持的版本号，用逗号分隔(不带空格)。默认值空串表示支持所有版本的连接，但参数 IFUN_DATETIME_MODE=1 时可能存在版本连接限制|
|DPC_TABLESPACE_BALANCE|1|动态，系统级|当在 DPC 下创建分区表，子表个数少于所选择的表空间个数时，是否启用随机选择起始表空间以使得表空间负载均衡。0：不启用；1：启用，从已有子表所使用的表空间中挑选；2：启用，在一级水平分区表新增子表时考虑从所有表空间中挑选|
|DPC_DCT_REFRESH_POLICY|1|动态，系统级|DMDPC 专用。MP 广播实例字典信息优化开关。  0：表示关闭，MP 会定时广播实例字典信息；  1：表示打开，MP 只会在每次修改实例字典信息时进行广播|
|HANDLE_WARN_RATE|75|动态，系统级|DMSERVER 进程使用句柄数报警百分比，超过设定值则写日志警告信息，取值范围 0~100|
|CLOB_MAX_IFUN_LEN|20971520|动态，系统级|系统函数中支持的最大 CLOB 长度，取值范围 32767~104857600，单位 BYTE|
|ENET_SESS_CHECK_INTERVAL|10|动态，系统级|当 BP/SP 处于 MP 无效服务状态时，BP/SP 断开会话连接的时间间隔阈值。如果 BP/SP 处于 MP 无效服务状态的时间超过该阈值，则会主动断开所有会话连接。取值范围 0~4294967294，单位秒。0 表示关闭|
|CYT_CHECK_FLAG|0|静态|是否检查校验加解密过程。0：不检查；1：检查|
|HUGE_DEFAULT_FILE_INIT_SIZE|1|动态，会话级|指定 huge 表数据文件的初始化时的默认大小，单位 Mb，取值范围 0~1048576。0 表示关闭，即 huge 表数据文件创建时就使用其文件大小创建；非 0 时有效值是 2 的 n 次幂，会自动进行对齐|
|MAX_UNCOMPRESS_RATIO|100|动态，系统级|UTL_COMPRESS 包中解压相关方法支持的最大解压比例，取值范围 10~1000|
|MAX_UNCOMPRESS_LENGTH|1024|动态，系统级|UTL_COMPRESS 包中解压相关方法支持的解压后数据的最大长度，单位 MB，取值范围 1024~102400|
|TS_FIL_USE_ABSOLUTE_PATH|0|静态|表空间添加、重命名数据文件是否必须使用绝对路径。0：不强制使用绝对路径；1：必须使用绝对路径|
|LIST_TABLE_BRANCH|0|动态，系统级|创建堆表的并发分支数，取值范围 0~64。当 LIST_TABLE 开启时参数配置生效|
|LIST_TABLE_NON_BRANCH|0|动态，系统级|创建堆表的非并发分支数，取值范围 0~64。当 LIST_TABLE 开启时参数配置生效。为 0 时采用系统默认值 1|
|DHASH3_MAX_CONFLICT|4|动态，会话级|动态哈希扩展中允许每个槽上的最大冲突数，取值范围 1~100|
|DHASH3_SIZE_EXTEND_FACTOR|5|动态，会话级|动态哈希扩展中指定的扩展因子，取值范围 1~100|
|DB_FILE_NAME_CONVERT|空串|静态|指定还原数据库或备库重演日志时表空间数据文件路径的转换规则。参数值必须为偶数个字符串，以逗号为分隔符。每两个字符串分别表示源库数据文件路径中的待替换字符串和替换后的字符串(pattern/replace)。替换后的路径长度不能超过 256 个字节，否则认为当前 pattern/replace 无效，匹配下一对 pattern/replace。进行字符串替换时，只替换匹配成功的第一对 pattern/replace，后续 pattern/replace 不再进行替换。未找到匹配项则不进行字符串替换，可能导致重演或还原失败。参数为空串时不进行路径转换，按照 REDOS_FILE_PATH_POLICY 参数规则或者默认规则进行重演或还原|
|DPC_GUP_SESS_TIMEOUT|180|动态，会话级|用于 DMdpc 中，表示 sP 升级时事务、会话超时断开时间。取值范围 60~600。单位秒|
|TS_AUTO_EXTEND_SIZE|64|静态|表空间自动扩展大小，取值范围 1~1024，单位 MB|
|INI_SYNC|1|动态，系统级|用于控制备库是否定期从主库同步 INI 参数及每次同步的时间间隔；取值范围 0~1440，单位分钟；0 表示不开启同步。该参数也用于控制进行主备切换时，新主库是否向备库强制同步 INI 参数，0 表示不强制进行同步|
|TRUNC_CHECK_MODE|0|系统级；动态|语句检查并发 TRUNCATE 的方式。  0：分区表根据对应根表的数据版本检查；  1：分区子表各自检查；  2：索引局部进行检查。  注：DM MPP 环境不支持该参数|
|PAGE_CHECK_POLICY|1|系统级；动态|建库参数 PAGE_CHECK 非 0 时，若数据页校验失败，对于 INI 参数 PTX_ROLLBACK 为 0 或 PTX_ROLLBACK 为 1 但无法报错处理的情况的处理策略。0：忽略失败；1：系统主动 HALT|
|FAST_START_MTTR_TARGET|0|动态，系统级|数据库故障恢复时间，单位秒，取值范围 0~3600，缺省为 0。设置该参数后，系统内部会根据未刷盘日志大小及脏页数量，动态调整 RLOG_RESERVE_THRESHOLD 值  可通过 SP_SET_PARA_VALUE 系统过程设置（最终会转换为 RLOG_RESERVE_THRESHOLD 值）|
|CSEK2_CHECK_LOCK|0|动态，系统级|对于简单计划（对主键查询的更新与删除），是否需要在检索时锁行。  0：表示关闭；  1：表示尝试在查询期间提前封锁；  2：表示尝试在查询期间提前修改|
|CSCN2_CHECK_LOCK|0|动态，系统级|该参数按位取值，有两层含义  0：表示关闭  1：DSC 集群简单计划（全表更新/删除）在扫描时使用 NBTR_MODIFY_LEAF 模式，借助 PRELOAD 机制提前获取数据页 X 封锁，提升 LBS 封锁效率  2：对于简单计划（全表更新/删除）在扫描时提前修改记录 TID  3：同时启用 1 和 2 功能|
|STAT_CACHE_FLAG|1|静态|SP 是否缓存表行数。  0：不缓存；  1：SP 缓存表行数，而不是每次都向 MP 请求表行数，从本地缓存中获取表行数以降低 MP 的性能瓶颈。和 STAT_CACHE_CAPACITY 搭配使用|
|DEFAULT_FILLFACTOR|0|动态，系统级|设置填充比例的默认值，包括所有可以设置 storage 参数的模块如表、索引、物化视图等。指定插入数据时数据页的充满程度，取值范围 0~100。取缺省值 0 时，等价于 100，表示全满填充，未充满的空间可供页内的数据更新时使用|
|SHADOW_CHECK_INTERVAL|60|动态，系统级|用于设置清理影子库的本地归档文件的时间间隔，取值范围 0~3600，单位秒。如果设为 0，则关闭自动清理功能。此参数仅对影子库有用|
|WM_CONCAT_LOB|1|静态|指定 wm_concat 函数的返回值类型。0：varchar 类型；1：CLOB 类型|
|CHECK_CONS_NAME|1|动态，系统级|在创建或重命名约束时，是否对约束名合法性进行检查。0：不检查；1：检查|
|IFUN_LEN_OPT|1|动态，系统级|设置如何调整函数返回字符串结果的长度。0：不调整；1：优化部分函数返回字符串结果的最大长度；2：溢出时不报错，截断后返回，取值 2 仅在 COMPATIBLE_MODE 为 2 时生效。取值为 1 时可以进行优化的函数有：  TO_CHAR()、CONCAT()、INITCAP()、REVERSE()、LPAD()、RPAD()、SUBSTRB()、SOUNDEX()、TRANSLATE()、ASCIISTR()、RAWTOHEX()、UNISTR()、NLSSORT()、TO_SINGLE_BYTE()、TO_MULTI_BYTE()、COMPOSE()  支持使用上述有效值的组合值，如 3 表示同时进行 1 和 2 的操作|
|PKG_BUILD_WAIT_TIME|5|动态，系统级|等待包对象构建的最长等待时间，取值范围 1~604800，单位秒|
|PTX_ROLLBACK|0|静态|针对磁盘 IO 读请求超时、DMDSC 环境下 LBS 请求 GBS 授权超时场景的处理策略。0：故障退出；1：正常报错。针对访问数据页损坏的场景（建库参数 PAGE_CHECK 非零可以校验数据页损坏）的处理策略。0：此时处理策略取决于 INI 参数 PAGE_CHECK_POLICY；1：绝大部分情况可以正常报错，当损坏的数据页是文件 0 号页、系统表空间数据页、文件系统 INODE 页或者描述页等时，无法正常报错，此时的处理策略取决于 INI 参数 PAGE_CHECK_POLICY|
|LOB_READ_LOCK|1|动态，系统级|指定使用系统函数或包方法对 LOB 对象做只读操作时是否锁表并检查 LOB 数据是否匹配。1：是，0：否在 DMDPC 或 DMMPP 环境下，取值 0 不生效|
|VM_PINST_COUNT|10|动态，系统级|可以动态配置栈帧中缓存实例上限，取值范围为 0~20，设置为 0 为不打开。参数打开后，可以缓存最近访问的部分包的实例地址，用于提升后续访问速度|
|INSTRUCT_COMBINE|0|动态，系统级|是否尝试进行特定形式表达式的合并指令的生成（例如：将 a.b/a(i).b/a(i)形式的本地变量的读写，改为单独的 dop_load_spa/dop_store_spa 指令执行）；0：否，1：是|
|MAX_ESESSIONS|100000|动态，系统级|DMDPC 专用。指定分支 ESESSION 个数上限，取值范围 0~650000，0 表示无限制。ESESSION 为 SP 和其他节点之间的内部会话，SP 上的 ESESSION 为主 ESESSION，其他节点上的 ESESSION 为分支 ESESSION|
|DEFAULT_HASHPARTMAP|1|动态，系统级|创建哈希分区表未指定 HASHPARTMAP 选项时的默认值。取值范围 0~3，0 表示 DM 原有的数据定位方式，此时数据分布最均衡，但不能增删分区；1 表示采用新数据定位方式，此时可以增删哈希分区；2 为兼顾数据分布均衡和允许添加分区的数据定位方式；3 采用新的 hash 算法计算分区列哈希值,分区定位方式与 HASHPARTMAP(1) 保持一致|
|PL_SQL_STRIP|0|动态，系统级|指定是否开启语句块/过程/函数/包等脚本中的语句剥离功能，即将其中的 DML 语句改为动态执行。0：不开启语句剥离功能1：开启语句块中语句剥离功能2：开启过程和函数中语句剥离功能4：开启包和 CLASS 类中语句剥离功能8：开启触发器中语句剥离功能16：表示语句剥离后若不包含 USING 和 INTO，则动态执行直接使用原始 SQL 语句32：表示语句剥离时，补充解析 MERGE INTO 中尚未解析的部分，保证语句中的变量能够成功转换为 USING 子句64：允许 CURSOR 定义或 OPEN 游标指定的查询表达式进行 SQL 剥离。但禁止将静态游标赋值给动态游标；且 OPEN 动态游标时，必须指定 SQL，否则将报错128：在 ELOG 日志中记录 SQL 剥离转换前后的语句，并将 PL_SQL_STRIP 调整成会话级参数支持使用上述有效值的组合值，如 6 表示同时进行 2 和 4 的处理|
|IPV6_LSNR|1|静态|是否监听 IPV6 端口的请求。0：不监听；1：监听|
|DBLINK_HEALTH_CHECK|1|动态，会话级|指定重用缓存中的 DBLINK 连接时是否检查连接有效性。0：不检查；1：通过接口进行简单检查；2：通过执行查询语句进行严格检查|
|BTR_FREE_PAGE_STACK|0|动态，系统级|指定是否开启 B 树空闲页堆栈。开启 B 树空闲页堆栈后，B 树控制页增加内节点和叶子节点页堆栈，用以缓存空闲的数据页。B 树申请数据页从 B 树空闲页堆栈分配，在 B 树空闲页堆栈分配页前，需检查空闲页堆栈空闲页是否足够，必要时分配数据页填充空闲页堆栈，确保空闲页堆栈一定有足够的空闲页，释放数据页时，优先归还数据页到 B 树空闲页堆栈。0：不开启；1：开启|
|RANDOM_CRYPTO|空串|静态|指定数据库中使用的随机数算法所在的加密引擎名。未指定或指定的加密引擎不存在，又或者指定的加密引擎中不存在随机数算法，则使用 OPENSSL 提供的软件随机数算法|
|PTX_BI_PERCENTAGE|50|动态，系统级|RECYCLE POOL 中可用来分配给 PTX 前镜像页的缓冲区 BUFFER 比例。取值范围 1~100|
|GEO2_CONS_CHECK|0|动态，系统级|空间数据列是否进行约束检查。0：不进行；1：进行|
|ENABLE_FAST_REFCURSOR|1|动态，系统级|支持打开游标时指定 FAST 属性，同时支持 fast 游标作为输出参数返回上层调用。即当 ENABLE_FAST_REFCURSOR=1 时，可使用 OPEN WITH FAST……语法打开游标|
|HUGE_UNIQUE_CHECK|0|动态，系统级|设置 HUGE 表的 UNIQUE 约束或 PRIMARY KEY 约束和 UNIQUE 索引是否检查数据唯一性。0：不检查；1：检查|
|DEFERRED_SEGMENT_CREATION|0|动态，系统级|建表时是否启用延迟段分配功能。0：不启用；1：启用。HUGE 表不支持延迟段分配功能|
|PLN_INDEPENDENT|1|静态|指定构造计划时是否不再级联构造其引用过程/函数/包的计划并添加引用。0：级联构造计划并添加引用；1：不再级联构造计划并添加引用|
|USE_FORALL_ATTR|0|动态，会话级|是否使用 FORALL 语句的游标属性，0：不使用；1：使用|
|ALTER_TABLE_OPT|0|动态，会话级|是否对加列、修改列、删除列操作进行优化，0：全部不优化；1：全部优化；2：打开快速加列，对于删除列和修改列与 1 等效；3：打开快速加列，允许指定快速列默认值，其他功能与 2 时相同对于 HUGE 表的修改，该设置为 0 或 1 时效果一样，均为采用查询插入实现|
|MAX_CLTN_MEM_SIZE|4 * 1024|动态，系统级|设置单个收集类型对象的最大内存空间，单位为 MB，取值范围为 128~4294967294|
|TMP_OPT_POLICY|1|静态|临时表是否开启簇空间管理优化策略。0：不开启；1：开启|
|TMP_MAX_RESERVE_EXTENT|50|静态|临时表开启簇空间管理优化策略后，临时表最大的簇预留大小。临时表释放簇时，若全局缓存中预留的簇大小超过该值，后续释放的簇将直接释放回文件系统，而不再预留在缓存中。单位为 MB，取值范围为 0~4096。取值为 0 时表示临时表不设置预留上限，可以预留所有被临时表释放的簇在缓存中。|
|DPC_CHECK_MP_INI|1|静态|是否检查并修改 mp.ini，1：检查并修改；0：不检查|
|DPC_CONN_POLICY|0|动态|系统级 DPC 链路的管理策略，按位取值，10 进制取值如下：0：无特殊策略；1：DPC AP 监听端口如果长时间没有监听到连接，则重建监听端口；2：阻塞模式的链接对于 EINPROGRESS 错误进行检查并重试|
|PLN_BUILD_WAIT_TIME|5|动态，系统级|等待计划构建的最长等待时间，仅在 ENABLE_PLN_PRESEARCH=1 时有效，取值范围 1~604800，单位秒|
|HP_DEF_LOCK_MODE|0|动态，系统级|新建分区表时默认的封锁模式。0：只封锁根表；1：细粒度的封锁模式|


##### 2.1.1.1.9   预先装载表相关

表 2.9 dm.ini 中预先装载表相关参数



##### 2.1.1.1.10  客户端缓存相关

表 2.10 dm.ini 中客户端缓存相关参数



##### 2.1.1.1.11  REDO 日志生成相关

表 2.11 dm.ini 中 REDO 日生成相关参数



##### 2.1.1.1.12  REDO 重做/重演相关

本节的 INI 参数为重做或重演所需参数。

其中，以 REDOS_开头的 INI 参数为备库上日志重演专用参数。只需要在备库上设置，主库不需要。

表 2.12 dm.ini 中 REDO 重做/重演相关参数



##### 2.1.1.1.13  事务相关

表 2.13 dm.ini 中事务相关参数



##### 2.1.1.1.14  安全相关

表 2.14 dm.ini 中安全相关参数



##### 2.1.1.1.15  兼容性相关

表 2.15 dm.ini 中兼容性相关参数



##### 2.1.1.1.16  用户请求跟踪相关

表 2.16 dm.ini 中用户请求跟踪相关参数



##### 2.1.1.1.17  系统跟踪相关

表 2.17 dm.ini 中系统跟踪相关参数



##### 2.1.1.1.18  MONITOR 监控相关

表 2.18 dm.ini 中 MONITOR 监控相关参数



##### 2.1.1.1.19  数据守护相关

表 2.19 dm.ini 中数据守护相关参数



##### 2.1.1.1.20  全文索引相关

表 2.20 dm.ini 中全文索引相关参数



##### 2.1.1.1.21  配置文件相关

表 2.21 dm.ini 中配置文件相关参数



##### 2.1.1.1.22  备份还原相关

表 2.22 dm.ini 中备份还原相关参数



##### 2.1.1.1.23 快速插入

表2.23 dm.ini中快速插入相关参数

|**参数名**|**缺省值**|**属性**|**说明**|
|---|---|---|---|
|BATCH_INSERT_ROWS|10|动态，会话级|开启批量插入的记录行数阈值。当查询插入或批量绑定参数插入的记录行数大于等于 BATCH_INSERT_ROWS、且满足批量插入优化条件时，采用批量方式进行插入，否则采用逐行插入。取值范围 0~10000|
|INDEX_FINS_FLAG|0|动态，系统级|用于控制索引增删改的批量处理优化。当表满足批量处理的条件下，且当前语句的处理行数大于 BATCH_INSERT_ROWS 时可选的批量优化选项：0：不启用相关优化；  1：异步方式处理二级索引；  2：启用 UNIQUE 索引批量处理； 4：启用普通二级索引批量处理；  8：插入或删除前尝试先对每批数据排序；  16：当异步任务堆积时，是否使用会话工作线程协助处理；32：尝试页内比较、插入或删除；  64：尝试复用 B 树历史搜索路径； 256：启用聚集索引批量插入优化；上述取值可组合使用，但启用 8、32、64 优化的前提是开启 2/4/256 以支持对应索引。部分优化仅数据有序时有意义，启用 8 提前排序时可以应用相关优化，但也需要考虑排序代价。参数取值包含 1 时，异步处理二级索引的线程个数受参数 MAX_SEC_ASYNC_THREADS 限制，可通过查看 V$THRD_POOL_GRP 获取实际执行的使用情况，即 TYPE 为 PTHD_POOL 的记录|


##### 2.1.1.1.24  其他

表 2.24 dm.ini 中其他相关参数



##### 2.1.1.1.25  DMDSC 相关

表 2.25 dm.ini 中 DMDSC 相关参数



##### 2.1.1.1.26 RDMA 通讯

表2.26 dm.ini中RDMA通讯相关参数

|**参数名**|**缺省值**|**属性**|**说明**|
|---|---|---|---|
|USE_RDMA|0|手动|Linux 环境下，服务器是否支持 RDMA 通讯方式。  0：否，使用 TCP 方式；1：是，使用 RDMA 方式。  当 USE_RDMA=1 时，DPI 可以使用 RDMA 方式登录服务器。使用 RDMA 之前需先安装好迈络思 ofed 驱动（RDMA 协议的基础库 libibverbs.so 和 librdmacm.so）|


##### 2.1.1.1.27  未列在 dm.ini 中的 INI 配置项

下表中的 INI 参数较为特殊，没有包含在 dm.ini 文件中，但用户可通过调用系统过程与函数 SP_SET_PARA_VALUE()和 SF_SET_SYSTEM_PARA_VALUE()进行参数值的设置和修改。

表2.27 不在dm.ini中的INI配置项一



下述的 INI 参数较为特殊，没有包含在 dm.ini 文件中，且用户不可通过调用系统过程与函数 SP_SET_PARA_VALUE()和 SF_SET_SYSTEM_PARA_VALUE()进行参数值的设置和修改。

表2.28 不在dm.ini中的INI配置项二



##### 2.1.1.1.28 主备环境 INI 同步规则

在主备环境中，备库上部分 INI 参数（来自 dm.ini 或未列在 dm.ini 中的配置项）须和主库保持一致。DM 提供自动同步和手动同步两种方法。版本升降级期间，由于不同版本的 INI 参数可能不一致，因此不同版本的主备库不会进行 INI 同步。

自动同步

一 开启 INI_SYNC 参数同步后， 备库的部分 INI 参数会定时与主库同步到一致。同步原则为备库文件值与主库同步至一致，备库内存值与主库同步至一致。若备库为 DMDSC 集群，集群内节点均会进行同步。不同参数类型的同步规则如下：

  1. 静态 INI 参数：仅同步 dm.ini 文件值，不同步内存值，备库需要重启才能使用新的参数值；
  2. 系统级动态 INI 参数：同时同步 dm.ini 文件值与内存值；
  3. 会话级动态 INI 参数：同步全局内存值，不同步会话上的 INI 参数值；
  4. 若是在 INI 同步改进前后的两个版本间执行，不会真正同步，而是直接返回成功；
  5. INI_FILE 类型的参数，只会写入 INI 文件，需要重启才能生效；
  6. 不论是否开启 INI_SYNC 参数，对于参数 ENABLE_AUDIT、PWD_POLICY、PWD_MIN_LEN、MAC_LABEL_OPTION、ENABLE_DDL_ANY_PRIV，主库修改后，备库会随重演同步调整 INI 参数值；
  7. DMDSC 下启动时，非控制节点会从控制节点同步一次 INI 参数，此轮同步会登记同步信息到 V$INI_SYNC_INFO, 此轮同步不受 INI_SYNC 参数控制。



二 主备切换时，当新主库开启了 INI_SYNC 参数时，新主库会主动向所有备库归档目标同步一次参数，通知备库将参数与新主库同步到一致，对于 DMDSC 备库，归档目标为控制节点，仅会向控制节点同步参数；若新主库未开启 INI_SYNC 参数，则新主库不主动向备库同步参数。

手动同步

除了自动同步外，还可以通过 SF_SYNC_INI 或者 SF_DSC_SYNC_INI 函数进行手动同步，函数的具体使用方法可以参考《DM9_SQL 语言使用手册》。

#### 2.1.1.2 dmmal.ini

dmmal.ini 是 MAL 系统的配置文件。dmmal.ini 的配置项见下表。需要用到 MAL 环境的实例，所有站点 dmmal.ini 需要保证严格一致。

表2.29 dmmal.ini的配置项



> **注意**
>
>
> dmmal.ini和dm.ini中都可配置MAL_LEAK_CHECK，启动时以dmmal.ini中设置为准，如果dmmal.ini中没有配置，则以dm.ini中配置为准，两个都没配置时，则默认0。此参数在dm.ini中可动态更改。



#### 2.1.1.3 dmarch.ini

dmarch.ini 用于配置归档。dmarch.ini 的配置项见下表。

表2.30 dmarch.ini的配置项



相关说明

  1. 归档类型 ARCH_TYPE 有以下几种：

本地归档 LOCAL（一台主库最多配 8 个）

远程实时归档 REALTIME（一台主库最多配 8 个）

远程异步归档 ASYNC（一台主库最多配 8 个）

同步归档 SYNC（一台主库最多配 8 个）

即时归档 TIMELY（一个主库最多配 8 个）

远程归档 REMOTE（一个主库最多配 8 个）

RAFT 归档 RAFT/LEARNER (一个主库最多配 8 个)

  2. 配置名[ARCHIVE_*]表示归档名，在配置文件中必须唯一。

  3. 不能存在相同实例名的不同归档。

  4. 不能存在 DEST 相同的不同归档实例。

  5. ARCH_TIMER_NAME 为定制的定时器名称，定时器配置见 dmtimer.ini。

  6. 对于一个归档配置，ARCH_TYPE 需要配置在 ARCH_DEST、ARCH_TIMER_NAME、ARCH_INCOMING_PATH 之前。

  7. ARCH_STANDBY_APPLY 参数支持 REALTIME/TIMELY/SYNC/ASYNC/RAFT 归档，如果多个归档目标都配置了此字段，当前库会根据重已重演 LSN 值最小的备库重演信息确定自身本地归档是否可以删除。当主库配置了本地归档文件空间限制参数 ARCH_SPACE_LIMIT，同一节点号的本地归档文件已经达到空间上限，但归档又不满足删除条件的情况下，仍然正常创建新文件，不再做挂起处理，优先保证主库服务不中断。如果备库一直故障，主库从未获取过此备库的 apply 信息，则不允许删除任何日志；如果曾经获取过此备库的 apply 信息，则以此历史信息为准判断是否删除。不要求备库一定和主库配置一致，备库切换主库后，将按照新主库的配置情况来决定如何删除归档，主备切换后，有可能还是会发生归档已经被清理的情况。对于异步备库的级联配置情况，异步备库会根据级联的备库重演情况决定自身的本地归档是否可删除。没有级联配置的备库，不受此参数控制。

  8. 关于 DSC 环境的本地归档清理规则说明如下：

（1）查询 V$ARCH_FILE 时，DSC 环境不仅会有本地归档还会有远程归档，若是 ASM 环境，还可能查出 DSC
集群其他节点的本地归档和远程归档。本地归档空间上限和远程归档空间上限分开计算。

（2）配置 ARCH_STANDBY_APPLY=1 后，DSC 为备库时，主库归档空间达到上限后，按照 DSC 控制节点的重演情况清理本地归档。

（3）当主库是 DSC 集群，备库生成本地归档时会按照收到日志包的节点号分开保存归档（对于主库是 DSC2 节点的场景，备库收到 0
号节点发送过来的日志包产生的归档文件加入到 0 号归档链表中，备库收到 1 号节点发送过来的日志包产生的归档文件加入到 1
号归档链表中）。两个归档文件链表的空间上限分开计算。若此后又发生主备切换，新主库为单机库的场景，主库生成的新归档文件仅会加入到 0 号归档链表中。



#### 2.1.1.4 dm_svc.conf

dm_svc.conf 是一个客户端配置文件，它包含了 DM 各接口和客户端工具所需要配置的一些参数。它必须和接口/客户端工具位于同一台机器上才能生效。

初始 dm_svc.conf 文件在 DM 安装时自动生成。不同平台的生成目录有所不同。

  1. 32 位的 DM 安装在 Win32 操作平台下，此文件位于 %SystemRoot%\system32 目录；
  2. 64 位的 DM 安装在 Win64 操作平台下，此文件位于 %SystemRoot%\system32 目录；
  3. 32 位的 DM 安装在 Win64 操作平台下，此文件位于 %SystemRoot%\SysWOW64 目录；
  4. 在 Linux 平台下，此文件位于/etc 目录。



可以通过设置操作系统环境变量 DM_SVC_PATH 来修改 dm_svc.conf 文件路径。

##### 2.1.1.4.1 dm_svc.conf 配置项

###### 2.1.1.4.1.1  JDBC/.NET PROVIDER/NODE JS/Go 接口

下表中列举了 DM 对 JDBC/.NET PROVIDER/NODE JS/Go 接口配置项的支持情况，其中 √ 表示支持，× 表示不支持。

表 2.31 JDBC/.NET PROVIDER/NODE JS/Go 接口配置项介绍



###### 2.1.1.4.1.2 DPI 接口

表2.32 DPI接口配置项介绍

|**配置项**|**缺省值**|**简述**|
|---|---|---|
|服务名|无|连接服务名，参数值格式为 ip[:port],ip[:port],......|
|ADDRESS_REMAP|无|库地址重定向，格式 ADDRESS_REMAP =(IP:PORT,  IP:PORT)，多个：  ADDRESS_REMAP =(IP:PORT,  IP:PORT)   ADDRESS_REMAP =(IP:PORT,  IP:PORT)|
|EP_SELECTOR|0|连接数据库时采用何种模型建立连接。0：依次选取列表中的不同节点建立连接，使得所有连接均匀地分布在各个节点上；其余大于 0 整数表示选择列表中第几个节点建立连接，只有当前节点无法建立连接时才会选择下一个节点进行连接，若配置的值超过服务名列表的节点数，则连接第 (epSelector % 服务名列表节点数) 个节点|
|AUTO_RECONNECT (DO_SWITCH 别名)|0|连接发生异常或一些特殊场景下连接处理策略。0：关闭连接；1：当连接发生异常时自动切换到其他库，无论切换成功还是失败都会抛一个 SQLEXCEPTION，用于通知上层应用进行事务执行失败时的相关处理；2：配合 EP_SELECTOR=1 使用，如果服务名列表前面的节点恢复了，将当前连接切换到前面的节点上；4：保持各节点会话动态均衡，通过后台线程检测节点及会话数变化，并切换连接使之保持均衡。也可以将 AUTO_RECONNECT 置为上述几个值的组合值，表示同时进行多项配置，如置为 3 表示同时配置 1 和 2|
|CHAR_CODE|操作系统编码格式|客户端使用的编码格式，会影响帮助信息和错误提示信息，要与客户端使用的编码格式一致。支持的选项为：PG_UTF8（表示 utf8 编码）；PG_GBK/PG_GB18030（两者都表示 GBK 编码）；PG_BIG5（表示 BIG5 编码）；PG_ISO_8859_9（表示 ISO88599 编码）；PG_EUC_JP（表示 EUC_JP 编码）；PG_EUC_KR（表示 EUC_KR 编码）；PG_KOI8R（表示 KOI8R 编码）；PG_ISO_8859_1（表示 ISO_8859_1 编码）  可以不指定，若不指定，系统会读取操作系统信息获得编码信息，建议有需要才指定|
|COMPRESS_MSG|0|是否启用消息压缩。0：不启用；1：启用；2：自适应压缩。即自动选取长度较长的通信消息进行压缩；短消息不需要压缩，直接传输效率更高|
|CONNECT_TIMEOUT|5000|连接超时时间，单位为毫秒。0 表示无限制|
|DEC2DOUB|0|指明在 DPI、DMODBC、DCI、DMPHP 和 DM PRO*C 中，是否将 DEC 类型转换为 DOUBLE 类型。dec(0,0)的类型描述为 double。0：不转换；1：转换|
|ENABLE_RS_CACHE|0|是否进行客户端结果集缓存。0：不进行；1：进行|
|KEYWORDS|无|标识用户关键字，所有在列表中的字符串，如果以单词的形式出现在 sql 语句中，则这个单词会被加上双引号。该参数主要用来解决用户需要使用 DM8 中的保留字作为对象名使用的状况|
|LANGUAGE|操作系统语言|当前数据库服务器使用的语言，会影响帮助信息错误和提示信息。支持的选项为：CN（表示中文）和 EN（表示英文）。可以不指定，若不指定，系统会读取操作系统信息获得语言信息，建议有需要才指定|
|LOGIN_CERTIFICATE|无|指定登录加密用户名密码公钥所在的路径，一旦配置即认为开启了客户端的证书加密用户名密码模式|
|LOGIN_DSC_CTRL|0|服务名连接数据库时是否只选择 dsc control 节点的库。0：否；1：是注：不建议与 EP_SELECTOR 同时使用|
|LOGIN_MODE|4|指定优先登录的服务器模式。0：优先连接 Primary 模式的库，Normal 模式次之，最后选择 Stantby 模式；1：只连接主库；2：只连接备库；3：优先连接 Standby 模式的库，Primary 模式次之，最后选择 Normal 模式；4：优先连接 Normal 模式的库，Primary 模式次之，最后选择 Standby 模式|
|PROTOCOL_TYPE|TCP|网络协议类型。可选 TCP/UDP/IPC/RDMA|
|RS_CACHE_SIZE|20|设置结果集缓冲区大小，以 M 为单位。有效值为 1~65535，如果设置太大，可能导致空间分配失败，进而使缓存失效|
|RS_REFRESH_FREQ|10|结果集缓存检查更新的频率，以秒为单位，有效值为 0~10000，如果设置为 0，则不需检查更新|
|RW_PERCENT|25|读写分离分发比例，有效值范围 0~100|
|RW_SEPARATE|0|是否启用读写分离。0：不启用；1：启用；4：启用，备库由客户端进行选择，只连接事务一致性备库|
|SSL_CONFIG|无|指定用户的 SSL 信息，在配置 SSL_CONFIG 时，参数信息需要在同一行输入，输入信息中存在换行会导致初始化 SSL 环境失败。参数格式为：  (USER=(用户名 1) SSL_PATH=(SSL 路径 1) SSL_PWD=(SSL key1))...|
|SWITCH_INTERVAL|200|在服务器之间切换的时间间隔，单位为毫秒，有效值范围 1~9223372036854775807|
|SWITCH_TIMES|1|服务名连接数据库时，若未找到符合条件的库成功建立连接，将尝试遍历服务名中库列表的次数。有效值范围 1~9223372036854775807|
|TIME_ZONE|操作系统时区|指明客户端的默认时区，设置范围为：-779~840m，如 60 对应 +1:00 时区|
|WALLET_LOCATION|无|wallet 文件的路径。支持 disql、dmfldr、dimp/dexp、备份还原等客户端工具使用。wallet 文件用法请参考《DM8 安全管理》手册。该配置项仅支持全局配置，不支持服务名配置|
|DPI_TCP_DETECT|1|用于创建 TCP 的链路异常检测。1：创建；0：不创建|
|DETECT_TIMEOUT|0|用于设置链路异常检测超时时间，当链路检测时间超过设定时间没有响应，判定为链路异常，主动断开链路。取值范围：0~4294967294，0 表示没有超时，单位秒|
|RECONNECTERRORS|RECONNECTERRORS=(-6001)|用于指定需要重连的异常，即当用服务名进行连接时，若发生指定的异常时将继续找下一个节点进行连接，发生其他异常则会抛出异常停止连接。  配置格式：RECONNECTERRORS=(errorCode,errorCode,......)。errorCode 为数据库错误码（其中，超过了最大连接限制错误码-6001 不论设置与否，都会继续重连）。  例如：RECONNECTERRORS=(-14009,-13217)|
|VARCHAR_MAXSZ_DESC|无|用于指定 VARCHAR 类型的最大描述长度。取值范围 1~32767，当服务器返回的 VARCHAR 定义长度超过设定值时，按照设定值返回描述长度。若配置的参数值超出有效取值范围，则忽略该配置。建议谨慎使用该配置项，使用时必须保证设定值适应实际数据长度，否则存在数据获取不完整的风险|


###### 2.1.1.4.1.3 CYT 安全接口

表2.33 CYT安全接口配置项介绍

|**配置项**|**缺省值**|**简述**|
|---|---|---|
|CIPHER_PATH|无|第三方加密算法的路径|


###### 2.1.1.4.1.4 DIMP/DEXP 工具

表2.34 DIMP/DEXP工具配置项介绍

|**配置项**|**缺省值**|**简述**|
|---|---|---|
|DIRECT|Y|DIMP 专用，作用相当于 DIMP 工具的 FAST_LOAD 参数。表示是否使用快速装载。y：使用；n：不使用|
|DUMMY|2|DEXP 和 DIMP 均可使用。写文件时，发现文件已存在的处理方式。0：报错；1：直接覆盖文件；2：询问用户，有交互信息|
|WALLET_LOCATION|无|wallet 文件的路径。支持 disql、dmfldr、dimp/dexp、备份还原等客户端工具使用。wallet 文件用法请参考《DM8 安全管理》手册。该配置项仅支持全局配置，不支持服务名配置|
|DUMP_CONN_STR|NONE|DEXP 和 DIMP 均可使用。指定导入导出默认连接串。DEXP 或 DIMP 没有指定 USERID 连接串时，使用该连接串|
|DUMP_PASSWORD|NONE|DEXP 和 DIMP 均可使用。指定导入导出连接密码。DEXP 或 DIMP 的 USERID 参数缺省密码时，使用该密码|


###### 2.1.1.4.1.5 DPC 接口

表2.35 DPC接口配置项介绍

|**配置项**|**缺省值**|**简述**|
|---|---|---|
|DPC_TRACE|无|DPC 的 TRACE 文件路径，不配置时不写 TRACE 信息|
|ENABLE_SSL|0|是否启用 SSL。1/Y/y：启用 SSL；其他值：不启用|
|SSL_CONFIG|无|在启用 SSL 的前提下，设置 SSL 值。在配置 SSL_CONFIG 时，参数信息需要在同一行输入，输入信息中存在换行会导致初始化 SSL 环境失败。格式如下：SSL_CONFIG=((USER=(用户名 1) SSL_PATH=(SSL 路径 1) SSL_PWD=(SSL key1)) (USER=(用户名 2) SSL_PATH=(SSL 路径 2) SSL_PWD=(SSL key2)))|


###### 2.1.1.4.1.6 Disql 工具

表2.36 DISQL工具配置项介绍

|**配置项**|**缺省值**|**简述**|
|---|---|---|
|AUTO_LOGIN|无|DIsql 读取的用于自动登录的连接串。例如：AUTO_LOGIN=(SYSDBA/*****@192.168.6.7:5236)。DIsql 会优先连接 AUTO_LOGIN 中的服务器|
|WALLET_LOCATION|无|wallet 文件的路径。支持 disql、dmfldr、dimp/dexp、备份还原等客户端工具使用。wallet 文件用法请参考《DM8 安全管理》手册。该配置项仅支持全局配置，不支持服务名配置|


###### 2.1.1.4.1.7 DCI 接口

表2.37 DCI接口配置项介绍

|**配置项**|**缺省值**|**简述**|
|---|---|---|
|DCI_VERSION|0|控制 DCI 接口是否返回 DM 的版本信息。可取值 0/1，0 表示返回 DM 的版本信息，1 表示返回 Oracle 的版本信息。该配置项仅支持全局配置，不支持服务名配置|


##### 2.1.1.4.2 dm_svc.conf 用法

dm_svc.conf 配置文件的内容分为全局配置区和服务配置区。全局配置区在前，服务配置区在后，以“[服务名]”开头。“服务名”配置项可以在全局配置区，也可以在此服务名对应的服务配置区之前，即在其对应的“[服务名]”之前。

服务配置区中的配置优先级高于全局配置区。全局配置区的配置项影响所有会话，除非会话所属服务配置区中单独进行了配置，因此对于全局配置区配置项的设置修改需要慎重。

下面以一个普通环境中 dm_svc.conf 为例：

```
#  以#开头的行表示是注释

#  全局配置区
NORMAL=(192.168.0.1:5000,192.168.0.2:5236)
Data_Watch=(192.168.0.3:5236,192.168.0.4:4350)
TIME_ZONE=(480)     #表示+8:00时区
DIRECT=(Y)

#  服务配置区
#  常规环境，两个没有关系的IP
[NORMAL]
TIME_ZONE=(540)     #表示+9:00时区
LOGIN_MODE=(4)
SWITCH_TIMES=(3)
SWITCH_INTERVAL=(100)

#  服务配置区
#  数据守护环境，一主一备，只连备库
[Data_Watch]
TIME_ZONE=(540)     #表示+9:00时区
LOGIN_MODE=(2)
SWITCH_TIMES=(3)
SWITCH_INTERVAL=(100)
```

下面以 DSC 场景中 dm_svc.conf 为例：

```
# 以#开头的行表示是注释

# 全局配置区
DMDSC1=(192.168.1.1:5236,192.168.1.3:5236)
DMDSC2=(192.168.1.5:5236,192.168.1.7:5236)
TIME_ZONE=(480)   #表示+8:00时区

#DMDSC1 服务配置区
#以下配置目标连接 DMDSC1 服务名的第一个服务（192.168.1.1:5236），以间隔 1000 毫秒的节奏尝试遍历服务名中的各服务进行连接，若在遍历中成功连上符合要求的服务则立即返回；若没有，则继续。一共尝试 60 次遍历，若60次尝试后依然未连接上目标服务，则根据LOGIN_MODE的配置进行下一种连接的尝试。若连接建立时连上的是2号服务，而一段时间后 1 号服务可以正常连接了，当前连接也不会自动切换到 1 号服务。
[DMDSC1]
LOGIN_MODE=(4) #若是DSC主+单机备，建议这里配置成0
SWITCH_TIMES=(60)
SWITCH_INTERVAL=(1000)
EP_SELECTOR=(1)
AUTO_RECONNECT=(1)

#DMDSC2 服务配置区
#以下配置目标连接 DMDSC2 服务名的第一个服务（192.168.1.5:5236），以间隔 1000 毫秒的节奏尝试遍历服务名中的各服务进行连接，若在遍历中成功连上符合要求的服务则立即返回；若没有，则继续。一共尝试 60 次遍历，若60次尝试后依然未连接上目标服务，则根据LOGIN_MODE的配置进行下一种连接的尝试。假设2号服务先连接成功，由于AUTO_RECONNECT=(2)，因此当1号服务可以正常连接后当前连接会切换到1号服务。
[DMDSC2]
CLUSTER=(DSC)
LOGIN_MODE=(4) #若是DSC主+单机备，建议这里配置成0
SWITCH_TIMES=(60)
SWITCH_INTERVAL=(1000)
EP_SELECTOR=(1)
AUTO_RECONNECT=(2)
```

需要说明的是，如果对 dm_svc.conf 的配置项进行了修改，需要重启客户端程序，修改的配置才能生效。另外，如果 dm_svc.conf 配置文件中包含中文，则必须保证该配置文件的编码与客户端编码一致。

#### 2.1.1.5 sqllog.ini

sqllog.ini 用于 SQL 日志的配置，当且仅当 INI 参数 SVR_LOG=1 时使用。

##### 2.1.1.5.1   sqllog.ini 配置项

sqllog.ini 的详细配置请参考下表。

表2.38 sqllog.ini的配置项

|**参数名**|**缺省值**|**属性**|**说明**|
|---|---|---|---|
|SQL_TRACE_MASK|1|动态，系统级|指定 SQL 日志中需要被记录的语句类型。为了避免日志量过大，建议用户根据实际需要有选择地指定，而非一律全部指定。指定方式为 SQL_TRACE_MASK=位号:位号:位号……。例如：3:5:7 表示第 3，第 5，第 7 位号代表的类型需要被记录在 SQL 日志中。以下位号均可以单独使用，也可以搭配使用，其中位号 2~17 与 23、24、25、26、28 搭配使用时，表示取其交集。例如：SQL_TRACE_MASK=2 表示记录 DML 语句；SQL_TRACE_MASK=24 表示记录执行语句；SQL_TRACE_MASK=29 表示记录事务相关语句；SQL_TRACE_MASK=2:3:24:29 表示记录 DML 和 DDL 的执行语句以及事务相关语句。位号的含义如下所示：1   全部记录（等同于同时设置 4~31）2   DML 类型相关语句（等同于同时设置 4~10）3   DDL 类型相关语句（等同于同时设置 11~17）4   UPDATE 类型语句（更新）5   DELETE 类型语句（删除）	6   INSERT 类型语句（插入）7   SELECT 类型语句（查询）8   COMMIT 类型语句（提交）9   ROLLBACK 类型语句（回滚）10  CALL 类型语句（过程调用）11  BACKUP 类型语句（备份）12  RESTORE 类型语句（恢复）13  创建对象操作（CREATE DDL）14  修改对象操作（ALTER DDL）15  删除对象操作（DROP DDL）16  授权操作（GRANT DDL）17  回收操作（REVOKE DDL）22  记录绑定参数的行数23  记录存在错误的语句（语法错误，语义分析错误等）24  记录执行语句25  记录执行语句、执行语句的时间、语句的影响行数（只有增删改查有行数，其它语句无行数）26  记录执行语句的时间、语句的影响行数（只有增删改查有行数，其它语句无行数）。25 和 26 二者只能选择其一。25 和 26 同时存在时，只有 25 有效27  记录原始语句（服务器从客户端收到的未加分析的语句）28  记录参数信息，包括参数的序号、数据类型和值29  记录事务相关事件，包括锁类型、锁等待时间等30  记录 XA 事务31  记录数据库登录操作，包括登录成功、登录失败、退出登录|
|FILE_NUM|5|动态，系统级|总共记录多少个日志文件，当日志文件达到这个设定值以后，再生成新的文件时，会删除最早的那个日志文件。取值范围 2~1024。日志文件名称中将包含日期时间信息，关于日志文件命名格式的详细介绍请参考 2.9 SQL 日志文件|
|SWITCH_MODE|2|动态，系统级|表示 SQL 日志文件切换的模式:0：不切换 1：按文件中记录数量切换2：按文件大小切换 3：按时间间隔切换|
|SWITCH_LIMIT|与切换模式有关|动态，系统级|不同切换模式 SWITCH_MODE 下，意义不同：1 按数量切换时，一个日志文件中的 SQL 记录条数达到多少条之后，系统自动将日志切换到另一个文件中。取值范围 1000~10000000，缺省为 1000002 按文件大小切换时，一个日志文件达到该大小后，系统自动将日志切换到另一个文件中，单位 MB。取值范围 1~2000，缺省为 1283 按时间间隔切换时，每隔指定的时间间隔，系统自动将日志切换到另一个文件中，单位分钟。取值范围 1~30000，缺省为 60|
|ASYNC_FLUSH|1|动态，系统级|是否打开 SQL 日志异步刷盘功能。0：否，采用实时刷盘；1：是，采用异步刷盘|
|MIN_EXEC_TIME|0|动态，系统级|记录的最小语句执行时间，单位毫秒。执行时间小于该值的语句不记录在日志文件中。取值范围 0~2147483647|
|FILE_PATH|../log|动态，系统级|SQL 日志文件所在的文件夹路径。缺省生成在 DM 安装目录的 log 子目录下面|
|BUF_TOTAL_SIZE|10240|动态，系统级|SQL 日志 buffer 占用空间的上限，单位为 KB，取值范围 1024~1024000|
|BUF_SIZE|1024|动态，系统级|一块 SQL 日志 BUFFER 的空间大小，单位为 KB，取值范围 50~409600|
|BUF_KEEP_CNT|6|动态，系统级|系统保留的 SQL 日志缓存的个数，取值范围 1~ 100|
|PART_STOR|0|动态，系统级|SQL 日志分区存储，表示 SQL 日志进行分区存储的划分条件。 0 表示不划分；1 表示 user：根据不同用户分布存储|
|ITEMS|0|动态，系统级|指定一条 SQL 日志中应包含的内容。指定方式为 ITEMS=位号:位号:位号……。 例如：ITEMS=3:5:7。表示应包含第 3、第 5、第 7 位代表的内容。0   表示记录所有的列（等同于同时设置 1~12）1	TIME    执行的时间2	SEQNO    服务器的站点号3	SESS    操作的 SESS 地址4	USER    执行的用户5	TRXID    事务 ID6	STMT    语句地址7	APPNAME    客户端工具8	IP    客户端 IP9	STMT_TYPE    语句类型。分别为[ORA]表示原始语句（服务器从客户端收到的未加分析的语句） 、[DDL]表示 DDL 语句、[INS]表示 INSERT 语句、[DML]表示 DML 语句、[CAL]表示 CALL 语句、[UPD] 表示 UPDATE 语句、[DEL] 表示 DELETE 语句、[SEL]表示 SELECT 语句、[LGN]表示登录登出语句10	INFO    记录内容，记录当前执行的 SQL 语句11	RESULT    运行结果，包括运行用时、影响行数和 EXEC_ID（可能没有） 12	THRD    线程地址|
|USER_MODE|0|动态，系统级|SQL 日志按用户过滤时的过滤模式，取值0：关闭用户过滤 1：白名单模式，只记录列出的用户操作的 SQL 日志 2：黑名单模式，列出的用户不记录 SQL 日志|
|USERS|空串|动态，系统级|打开 USER_MODE 时指定的用户列表。格式为：用户名：用户名：用户名|
|EXECTIME_PREC_FLAG|0|动态，系统级|设置 SQL 日志中执行时间 exectime 的时间单位。0：单位为毫秒 ms；1：单位为微秒 us|


##### 2.1.1.5.2   sqllog.ini 用法

sqllog.ini 在 INI 参数 SVR_LOG=1 时启用。

如果在服务器启动过程中，修改了 sqllog.ini 文件，须调用过程 SP_REFRESH_SVR_LOG_CONFIG()才会生效。

sqllog.ini 配置文件的内容分为全局配置区和模式配置区。

全局配置区为 sqllog.ini 文件头中无模式的配置区。全局配置区内允许配置所有的配置项，包括全局配置项（参数 BUF_TOTAL_SIZE、BUF_SIZE、 BUF_KEEP_CNT）和模式内配置项（除 BUF_TOTAL_SIZE、BUF_SIZE、 BUF_KEEP_CNT 的其他参数）。其中，全局配置项对全部模式生效，配置的参数的优先级为：模式配置区配置的值 > 全局配置区配置的值 > 缺省值。

模式配置区位于全局配置区后面，以“[模式名]”开头，可配置表 2.36 sqllog.ini 的配置项中除了 BUF_TOTAL_SIZE、BUF_SIZE、 BUF_KEEP_CNT 三个参数之外的所有参数，只对本模式生效。

下面以一个简单的 sqllog.ini 为例。配置好 sqllog.ini 后，需同时开启 INI 参数 SVR_LOG=1，SVR_LOG_NAME=SLOG_ALL 之后，sqllog.ini 和 SLOG_ALL 模式参数才能生效。

```
#  以#开头的行表示是注释
#  全局配置区
BUF_TOTAL_SIZE          = 10240         #SQLs Log Buffer Total Size(K)(1024~1024000)
BUF_SIZE                = 1024          #SQLs Log Buffer Size(K)(50~409600)
BUF_KEEP_CNT            = 6             #SQLs Log buffer keeped count(1~100)

#  模式配置区。此处模式名为SLOG_ALL
[SLOG_ALL]
    FILE_PATH    = ../log
    PART_STOR    = 0
    SWITCH_MODE  = 2
    SWITCH_LIMIT   = 128
    ASYNC_FLUSH   = 1
    FILE_NUM = 5
    ITEMS    = 0 
    SQL_TRACE_MASK  = 1
    MIN_EXEC_TIME = 0 
    USER_MODE   = 0 
    USERS =
```

当 SVR_LOG 为 1 时，但 sqllog.ini 不存在，或 sqllog.ini 存在但是配置的多个模式名均不在 INI 参数 SVR_LOG_NAME 中的情况下，按照各配置项的系统默认值记录 SQL 日志。在系统默认值中，模式名为*\<*DEFAULT>。

通过动态视图 V$DM_SQLLOG_INI 和 V$DM_SQLLOG_CONFIG 可以分别查询 sqllog.ini 文件和内存中的 SQL 日志配置参数，由于视图中使用*\<PUBLIC> 来标记全局配置参数，并且使用 \<DEFAULT> 来标记系统默认配置，因此 sqllog.ini 中不允许指定模式名为 \<PUBLIC> 或 \<*DEFAULT>。

sqllog.ini 中可以配置多个模式配置区。不同模式配置区中的配置项（数量或取值）可以不同。例如：记录过滤掩码，刷盘方式，文件切换方式等。当各模式的 items 设置不同时，使用其并集。仅当配置的模式名存在于 INI 参数 SVR_LOG_NAME 中时，该模式名对应配置才会生效。当配置为多模式时，会在日志文件名中的实例名后面加上该日志文件对应的模式名。

例 在 INI 参数 SVR_LOG=1 时，sqllog.ini 文件中配置了两个模式，模式名分别是 SLOG_ALL 和 SLOG_LOGIN，SLOG_ALL 模式指定日志中记录全部记录，SLOG_LOGIN 模式指定日志中仅记录数据库登录操作。

```
BUF_TOTAL_SIZE          = 10240         #SQLs Log Buffer Total Size(K)(1024~1024000)
BUF_SIZE                = 1024          #SQLs Log Buffer Size(K)(50~409600)
BUF_KEEP_CNT            = 6             #SQLs Log buffer keeped count(1~100)

[SLOG_ALL]
    FILE_PATH    = ../log
    PART_STOR    = 0
    SWITCH_MODE  = 2
    SWITCH_LIMIT   = 128
    ASYNC_FLUSH   = 1
    FILE_NUM = 5
    ITEMS    = 0 
    SQL_TRACE_MASK  = 1
    MIN_EXEC_TIME = 0 
    USER_MODE   = 0 
    USERS =

[SLOG_LOGIN]
    FILE_PATH    = ../log
    PART_STOR    = 0
    SWITCH_MODE  = 2
    SWITCH_LIMIT   = 128
    FILE_NUM = 5
    ITEMS    = 0 
    SQL_TRACE_MASK  = 31
```

#### 2.1.1.6 dmthrd.ini

dmthrd.ini 用于为线程类型绑定 CPU 核心，当且仅当 INI 参数 DMTHRD_INI=1 时使用。

##### 2.1.1.6.1 dmthrd.ini 配置项

dmthrd.ini 支持的线程类型请参考下表。

表2.39 dmthrd.ini支持的线程类型

|**线程类型**|**说明**|
|----|----|
|dm_audit_thd|审计日志刷盘线程|
|dm_timwrk_thd|定时器线程|
|dm_rapply_thd|日志重演工作线程，备用节点从主节点获取重演日志|
|dm_rapredo_thd|日志并行重演线程|
|dm_iocp_thd|sess 线程池打开时的任务监控线程|
|dm_wrkgrp_thd|会话连接并发处理线程|
|dm_sqllog_thd|dmserver 的 dmsql 写线程|
|dm_rtrd_thd|高可用集群远程读线程|
|dm_gbswrk_thd|全局闩服务工作线程|
|dm_glswrk_thd|全局锁服务工作线程|
|dm_gtvwrk_thd|全局事务视图工作线程|
|dm_aux_thd|全局事务视图 AUX 系统线程|
|dm_hio_thd|HUGE 文件系统 IO 线程|
|dm_osio_thd|系统 IO 线程|
|dm_purge_thd|清除线程|
|dm_Lbswrk_thd|本地闩服务工作线程|
|dm_Llswrk_thd|本地锁服务工作线程|
|dm_Ltvwrk_thd|本地事务视图工作线程|
|dm_redolog_thd|日志重做线程，日志刷盘|
|rlog4_enc_cmpr_thd|日志加密压缩线程|
|dm_asm_io_thd|dmasm 系统 IO 线程|
|dm_async_send_tHd|异步归档发送线程|
|dm_rsyswrk_thd|异步归档工作线程|
|dm_llog_thd|逻辑日志线程|
|dm_sched_thd|调度线程，接管系统中所有需要定时调度的任务|
|dm_pwr_thd|PWR 日志刷盘线程|
|dm_chkpnt_thd|检查点刷盘线程|
|dm_trxbro_thd|活动事务视图广播线程|
|dm_lpq_thd|本地并行工作线程|
|dm_tskwrk_thd|解析执行 SQL 语句的任务工作线程|
|dm_sql_thd|会话工作线程|


##### 2.1.1.6.2 dmthrd.ini 用法

dmthrd.ini 在 INI 参数 DMTHRD_INI=1 时启用。

dmthrd.ini 中为线程类型绑定 CPU 核心的语法如下：

```
<线程类型名> = [<最小值>, <最大值>] 

或

<线程类型名> = [<绑定值>]
```

\< 线程类型名 >：指定线程类型，支持的线程类型请参考[2.1.1.6.1 dmthrd.ini 配置项](#2.1.1.6.1 dmthrd.ini 配置项)。

[\< 最小值 >, \< 最大值 >]：非负整数，指定 CPU 核心的绑定范围。例如设置 DM_AUDIT_THD=[0,2]，表示创建审计日志刷盘线程时会循环绑定编号为 0、1、2 的三个 CPU 核心。

[\< 绑定值 >]：非负整数，表示仅绑定一个 CPU 核心，例如设置 DM_AUDIT_THD=[2]，表示仅绑定编号值为 2 的 CPU 核心，等同于 DM_AUDIT_THD=[2,2]。

线程类型绑定 CPU 核心的注意事项如下：

  1. \< 最小值 > 或者 \< 最大值 > 缺省时，默认值为 0。例如 DM_AUDIT_THD=[,1]等同于 DM_AUDIT_THD=[0,1]；
  2. \< 最小值 > 不能大于 \< 最大值 >，否则生成错误日志，并将 \< 最大值 > 作为 \< 最小值 >。例如 DM_AUDIT_THD=[2,1]等同于 DM_AUDIT_THD=[1,1]；
  3. \< 最大值 > 或 \< 绑定值 > 不能大于当前机器的 CPU 核心数量，否则生成错误日志，并将其调整为 CPU 核心数量减 1；
  4. 如果对同一个线程类型多次绑定 CPU 核心，则以最后一次绑定范围或绑定值为准；
  5. 所有线程类型默认不绑定 CPU 核心。



下面以一个简单的 dmthrd.ini 为例。配置好 dmthrd.ini 后，需开启 INI 参数 DMTHRD_INI=1，dmthrd.ini 才能生效。

```
# 以#开头表示是注释

DM_TSKWRK_THD  = [0,15]     #创建DM_TSKWRK_THD类型线程时循环绑定编号在0~15范围内的CPU核心

DM_SQL_THD = [16,31]       #创建DM_SQL_THD类型线程时循环绑定编号在16~31范围内的CPU核心
```

#### 2.1.2.7 dmtimer.ini

dmtimer.ini 用于配置定时器，用于数据守护中记录异步备库的定时器信息中记录异步复制的定时器信息。dmtimer.ini 的配置项见下表。

表2.40 dmtimer.ini的配置项

|**配置项**|**配置含义**|
|----|----|
|[TIMER_NAME1]|定时器名称。例如，名为 RT 的定时器，名称书写方式为[RT]|
|TYPE|定时器调度类型：1：执行一次。时间上只需要指定 DURING_START_DATE 即可，不需要指定 START_TIME、END_TIME 和 DURING_END_DATE  2：按日执行  3：按周执行  4：按月执行的第几天  5：按月执行的第一周  6：按月执行的第二周  7：按月执行的第三周  8：按月执行的第四周  9：按月执行的最后一周  10: 按 REPEAT_INTERVAL 指定的日历表达式的频率进行。不再需要通过 START_TIME、END_TIME、DURING_START_DATE 和 DURING_END_DATE 指定时间|
|FREQ_MONTH_WEEK_INTERVAL|间隔月或周数。这个列的可选值与上面的不同调度类型有关。表示执行的频率。说明如下：  当 TYPE=1 时，这个值无效，系统不会做检查。  当 TYPE=2 时，表示每隔几天执行，值的有效范围为 1 到 100。  当 TYPE=3 时，表示的是每隔几个星期执行，值的范围没有具体的限制。  当 TYPE=4 时，表示每几个月中的某一天执行，值的范围没有具体的限制。  当 TYPE 为 5、6、7、8 或 9 时，都表示每几个月的某一周执行，值的范围也没有具体的限制|
|FREQ_SUB_INTERVAL|间隔天数。这个列的可选值与上面的不同调度类型有关。表示执行的频率，在 FREQ_MONTH_WEEK _INTERVAL 基础上，继续指定更为精细的频率。说明如下：  当 TYPE=1 或 2 时，这个值无效，系统不会做检查。  当 TYPE=3 时，表示的是某一个星期的星期几执行，可以同时选中七天中的任意几天。取值范围 1~127。具体如何取值，请用户参考如下规则。因为每周有七天，所以 DM 用七位二进制来表示选中的日子。从最低位开始算起，依次表示周日、周一...周五、周六。选中周几，就将该位置 1，否则 0。例如：选中周二和周六，7 位二进制就是 1000100，转化成十进制就是 68，所以 FREQ_SUB_INTERVAL 就取值 68。  当 TYPE=4 时，表示将在一个月的第几天执行，此时这个列的有效值范围为 1 到 31  当 TYPE 为 5、6、7、8 或 9 时，都表示将在某一周内第几天执行，有效值为 1 到 7，分别表示从周一到周日|
|FREQ_MINUTE_INTERVAL|间隔分钟数。当 TYPE 为 2、3、4、5、6、7、8 或 9 时，在 FREQ_MONTH_WEEK_INTERVALHE 和 FREQ_SUB_INTERVAL 的基础上，继续指定更为精细的频率。表示一天内每隔多少分钟执行一次。取值范围 0~1439，0 表示一天内执行一次|
|REPEAT_INTERVAL|当 TYPE 为 10 时使用，用来指定的日历表达式。语法详见《DM8 系统包使用手册》手册 DBMS_SCHEDULER 包中关于 REPEAT_INTERVAL 的介绍|
|START_TIME|定时器开始时间，TIME 类型。例如：20:59:59.999999|
|END_TIME|定时器结束时间，TIME 类型|
|DURING_START_DATE|指定定时器的有效日期范围的起始日期，必须是有效的日期字符串，不可以为空。TIMESTAMP 类型。例如：2021-12-15 10:00:00|
|DURING_END_DATE|指定定时器的有效日期范围的结束日期，可以为空。如果不为空，必须是有效的日期字符串，同时必须是在 DURING_START_DATE 日期之后。TIMESTAMP 类型|
|NO_END_DATE_FLAG|是否结束标记。1 是，0 否|
|DESCRIBE|定时器描述|
|IS_VALID|定时器有效标记，缺省为 0。0：表示已关闭定时器  1：表示已启用定时器|


## 2.2 控制文件

每个 DM 数据库都有一个名为 dm.ctl 的控制文件。控制文件是一个二进制文件，它记录了数据库必要的初始信息，其中主要包含以下内容：

  1. 数据库名称；
  2. 数据库服务器模式；
  3. OGUID 唯一标识；
  4. 数据库服务器版本；
  5. 数据文件版本；
  6. 数据库的启动次数；
  7. 数据库最近一次启动时间；
  8. 表空间信息，包括表空间名，表空间物理文件路径等，记录了所有数据库中使用的表空间，数组的方式保存起来；
  9. 控制文件校验码，校验码由数据库服务器在每次修改控制文件后计算生成，保证控制文件合法性，防止文件损坏及手工修改。



在服务器运行期间，执行表空间的 DDL 等操作后，服务器内部需要同步修改控制文件内容。如果在修改过程中服务器故障，可能会导致控制文件损坏，为了避免出现这种情况，在修改控制文件时系统内部会执行备份操作。备份策略如下：

  * 策略一  
在修改 dm.ctl 之前，先执行一次备份，确定 dm.ctl 修改成功后，再将备份删除，如果 dm.ctl 修改失败或中途出现故障，则保留备份文件。

  * 策略二  
在修改 dm.ctl 成功之后，根据 dm.ini 中指定的 CTL_BAK_PATH/CTL_BAK_NUM 对最新的 dm.ctl
执行备份，如果用户指定的 CTL_BAK_PATH 是非法路径，则不再生成备份文件，在路径有效的情况下，生成备份文件时根据指定的 CTL_BAK_NUM
判断是否删除老的备份文件。



注意：

  * 如果 dm.ctl 文件存放在裸设备上，则【策略一】不会生效。
  * 如果指定的 CTL_BAK_PATH 是无效路径，则【策略二】也不会生效。
  * 如果【策略一】和【策略二】的条件都满足，则都会生效执行，否则只执行满足条件的备份策略，如果都不满足，则不会再生成备份文件。
  * 如果是初始化新库，在初始化完成后，会在“SYSTEM_PATH/CTL_BAK”路径下对原始的 dm.ctl 执行一次备份。



## 2.3 数据文件

数据文件以 DBF 为扩展名，它是数据库中最重要的文件类型，一个 DM 数据文件对应磁盘上的一个物理文件或者达梦分布式数据库中的一个逻辑文件，数据文件是真实数据存储的地方，每个数据库至少有一个与之相关的数据文件。在实际应用中，通常有多个数据文件。

当 DM 的数据文件空间用完时，它可以自动扩展。可以在创建数据文件时通过 MAXSIZE 参数限制其扩展量，当然，也可以不限制。但是，数据文件的大小最终会受物理磁盘大小的限制。在实际使用中，一般不建议使用单个巨大的数据文件，为一个表空间创建多个较小的数据文件是更好的选择。

数据文件在物理上按照页、簇和段的方式进行管理，详细结构请参考第一章的内容。

数据文件按数据组织形式，可以分为如下几种：

  1. **B 树数据**



行存储数据，也是应用最广泛的存储形式，其数据是按 B 树索引组织的。普通表、分区表、B 树索引的物理存储格式都是 B 树。

一个 B 树包含两个段，一个内节点段，存放内节点数据；一个叶子段，存放叶子节点数据。其 B 树的逻辑关系由段内页面上的记录，通过文件指针来完成。

当表上没有指定聚集索引时，系统会自动产生一个唯一标识 ROWID 作为 B 树的 key 来唯一标识一行。

  2. **堆表数据**



堆表的数据是以挂链形式存储的，一般情况下，支持最多 128 个链表，一个链表在物理上就是一个段，堆表采用的是物理 ROWID，在插入过程中，ROWID 在事先已确定，并保证其唯一性，所以可以并发插入，插入效率很高，且由于 ROWID 是即时生成，无需保存在物理磁盘上，也节省了空间。

  3. **列存储数据**



数据按列方式组织存储，包含每个列对应的存放列数据的一系列数据文件，以及存放列数据控制信息的辅助表。读取列数据时，只需要顺序扫描列数据文件和辅助表数据。在某些特殊应用场景下，其效率要远远高于行存储。

  4. **位图索引**



位图索引与 B 树索引不同，每个索引条目不是指向一行数据，而是指向多行数据。每个索引项保存的是一定范围内所有行与当前索引键值映射关系的位图。

数据文件中还有两类特殊的数据文件：ROLL 和 TEMP 文件。

1)ROLL 文件

ROLL 表空间的 DBF 文件，称为 ROLL 文件。ROLL 文件用于保存系统的回滚记录，提供事务回滚时的信息。回滚文件可被分为若干回滚段，每个事务的回滚页在回滚段中各自挂链，页内则顺序存放回滚记录。

2)TEMP 文件

TEMP.DBF 临时数据文件，临时文件可以在 dm.ini 中通过 TEMP_SIZE 配置大小。

当数据库查询的临时结果集过大，缓存已经不够用时，临时结果集就可以保存在 TEMP.DBF 文件中，供后续运算使用。系统中用户创建的临时表也存储在临时文件中。

## 2.4 重做日志文件

重做日志（即 REDO 日志）指在 DM 数据库中添加、删除、修改对象，或者改变数据，DM 都会按照特定的格式，将这些操作执行的结果写入到当前的重做日志文件中。重做日志文件默认以 log 为扩展名，可在初始化数据库时使用建库参数 RLOG_POSTFIX_NAME 指定重做日志文件的扩展名。每个 DM 数据库实例必须至少有 2 个重做日志文件，默认两个日志文件为 DAMENG01.log、DAMENG02.log，这两个文件循环使用。

重做日志文件因为是数据库正在使用的日志文件，因此被称为联机日志文件。

重做日志文件主要用于数据库的备份与恢复。理想情况下，数据库系统不会用到重做日志文件中的信息。然而现实世界总是充满了各种意外，比如电源故障、系统故障、介质故障，或者数据库实例进程被强制终止等，数据库缓冲区中的数据页会来不及写入数据文件。这样，在重启 DM 实例时，通过重做日志文件中的信息，就可以将数据库的状态恢复到发生意外时的状态。

重做日志文件对于数据库是至关重要的。它们用于存储数据库的事务日志，以便系统在出现系统故障和介质故障时能够进行故障恢复。在 DM 数据库运行过程中，任何修改数据库的操作都会产生重做日志，例如，当一条元组插入到一个表中的时候，插入的结果写入了重做日志，当删除一条元组时，删除该元组的事实也被写了进去，这样，当系统出现故障时，通过分析日志可以知道在故障发生前系统做了哪些动作，并可以重做这些动作使系统恢复到故障之前的状态。

## 2.5 归档日志文件

日志文件分为联机日志文件和归档日志文件。DM 数据库可以在归档模式和非归档模式下运行。非归档模式下，数据库会只将重做日志写入联机日志文件中进行存储；归档模式下，数据库会同时将重做日志写入联机日志文件和归档日志文件中分别进行存储。

联机日志文件指的是系统当前正在使用的日志文件。创建数据库时，联机日志文件通常被扩展至一定长度，其内容则被初始化为空，当系统运行时，该文件逐渐被产生的日志所填充。对日志文件的写入是顺序连续的。然而系统磁盘空间总是有限，系统必须能够循环利用日志文件的空间，为了做到这一点，当所有日志文件空间被占满时，系统需要清空一部分日志以便重用日志文件的空间，为了保证被清空的日志所“保护”的数据在磁盘上是安全的，这里需要引入一个关键的数据库概念——检查点。当产生检查点时，系统将系统缓冲区中的日志和脏数据页都写入磁盘，以保证当前日志所“保护”的数据页都已安全写入磁盘，这样日志文件即可被安全重用。

归档日志文件，就是在归档模式下，重做日志被连续写入到归档日志后，所生成了归档日志文件。归档日志文件以归档时间命名，扩展名默认与初始化数据库时指定的参数 RLOG_POSTFIX_NAME 一致，也可通过 INI 参数 LOG_FILE_POSTFIX_NAME 指定归档日志文件的扩展名。只有在归档模式下运行时，DM 数据库才会将重做日志写入到归档日志文件中。采用归档模式会对系统的性能产生影响，然而系统在归档模式下运行会更安全，当出现故障时其丢失数据的可能性更小，这是因为一旦出现介质故障，如磁盘损坏时，利用归档日志，系统可被恢复至故障发生的前一刻，也可以还原到指定的时间点，而如果没有归档日志文件，则只能利用备份进行恢复。

## 2.6 物理逻辑日志文件

物理逻辑日志，是按照特定的格式存储的服务器的逻辑操作，专门用于 DBMS_LOGMNR 包挖掘获取数据库系统的历史执行语句。当开启记录物理逻辑日志的功能时，这部分日志内容会被存储在重做日志文件中。

要开启物理逻辑日志的功能，需要满足下面两个条件：

首先，要设置 RLOG_APPEND_LOGIC 为 1、2、3 或者 4；

其次，通过设置参数 RLOG_IGNORE_TABLE_SET=1 或者建表（或修改表）时指定 ADD LOGIC LOG 开启。如果需要记录所有表的物理逻辑日志，设置 INI 参数 RLOG_IGNORE_TABLE_SET 为 1 即可；如果只需要记录某些表的物理逻辑日志，设置 INI 参数 RLOG_IGNORE_TABLE_SET 为 0，并在建表或者修改表的语法中使用 ADD LOGIC LOG。

## 2.7 备份文件

备份文件以 bak 为扩展名，当系统正常运行时，备份文件不会起任何作用，它也不是数据库必须有的联机文件类型之一。然而，从来没有哪个数据库系统能够保证永远正确无误地运行，当数据库不幸出现故障时，备份文件就显得尤为重要了。

当客户利用管理工具或直接发出备份的 SQL 命令时，DM Server 会自动进行备份，并产生一个或多个备份文件，备份文件自身包含了备份的名称、对应的数据库、备份类型和备份时间等信息。同时，系统还会自动记录备份信息及该备份文件所处的位置，但这种记录是松散的，用户可根据需要将其拷贝至任何地方，并不会影响系统的运行。

## 2.8 SQL 日志文件

用户在 dm.ini 中配置 SVR_LOG 参数后就会打开 SQL 日志。

SQL 日志文件是一个纯文本文件。命名格式为“dmsql_实例名[_模式名][_用户名][_日期_时间].log”。当 sqllog.ini 中存在多个有效模式名时，日志文件名中会添加“_模式名”，否则不添加；当 sqllog.ini 参数 PART_STOR=1 时，日志文件名中会添加“_用户名”，否则不添加；当 sqllog.ini 参数 SWITCH_MODE 不为 0 时，日志文件名中会添加“_日期_时间”，否则不添加。

SQL 日志文件缺省生成在 DM 安装目录的 log 子目录下面，管理员可通过 sqllog.ini 参数 FILE_PATH 设置其生成路径。

SQL 日志内容包含系统各会话上用户执行的 SQL 语句、参数信息、错误信息等。跟踪日志主要用于分析错误和分析性能问题，基于跟踪日志可以对系统运行状态有一个分析，比如，可以挑出系统现在执行速度较慢的 SQL 语句，进而对其进行优化。

系统中 SQL 日志的缓存是分块循环使用，管理员可根据系统执行的语句情况及压力情况设置恰当的日志缓存块大小及预留的缓冲块个数。当预留块不足以记录系统产生的任务时，系统会分配新的用后即弃的缓存块，但是总的空间大小由 sqllog.ini 参数 BUF_TOTAL_SIZE 控制，管理员可根据实际情况进行设置。

打开 SQL 日志会影响系统的性能，因此一般在需要查错和调优的时候才会打开。缺省情况下系统是关闭 SQL 日志的。若用户需要打开 SQL 日志，同时对日志的实时性并没有严格的要求，又希望系统性能好，此时可以从两方面进行改进：一设置 sqllog.ini 参数 SQL_TRACE_MASK 和 MIN_EXEC_TIME 只记录关注的相关记录，减少日志总量；二设置 sqllog.ini 参数 ASYNC_FLUSH 打开 SQL 日志异步刷盘提高系统性能。

用户可以调用系统过程 SP_SET_SQLLOG_INI()或 SP_DELETE_SQLLOG_INI_MODE()来动态修改 sqllog.ini 文件的内容，修改后可以调用系统过程 SP_REFRESH_SVR_LOG_CONFIG()更新内存中对应的参数值，以使所做的修改生效。利用动态视图 V​DM_SQLLOG_INI可以查询sqllog.ini文件中的SQL日志配置参数，利用动态视图VDM_SQLLOG_CONFIG 可以查询内存中的 SQL 日志配置参数。

## 2.9 事件日志文件

事件日志文件记录了 DM 数据库运行时的关键事件。例如：系统启动、关闭、内存申请失败、IO 错误等一些致命错误；数据库运行过程中的日志信息；备份还原过程中备份还原操作的阶段性信息等。

事件日志文件主要用于系统出现严重错误时进行查看并定位问题。事件日志简称 ELOG。事件日志文件随着 DM 数据库服务的运行一直存在。

事件日志文件打印的是中间步骤的信息，所以出现部分缺失属于正常现象。事件日志信息格式为：时间 + 日志类型（INFO/WARNING/ERROR/FATAL）+ 进程(database)+ 进程 ID(P 开头)+ 线程(dm_sql_thd/main_thread 等)+ 日志内容。

初始化过程中产生的 ELOG 会保存在 ELOG_PATH 参数指定的目录下，名称为“dminit+ 日期 + 时间”。例如：dminit20220914090452.log。

系统启动和运行过程中产生的 ELOG 保存在系统 log 目录下。

系统启动时，如遇到 dm.key、dm.ini 不存在等原因无法正常启动，因尚未获取到实例名，因此将生成的事件日志文件命名为“dm_unknown_年月”。例如：dm_unknown_202212。

当 ELOG_FLAG 设为 1 时，数据库运行过程中的事件日志都记录在名为“dm_实例名”的日志文件中，如 dm_DMSERVER.log。

当 ELOG_FLAG 设为 0 时，事件日志会被拆分记录到多个带有时间后缀的日志文件中。图 2.2 展示了 ELOG_FLAG 设为 0 时，9 月份的月度日志和分时日志。运行过程中，ELOG 日志文件的生成分两步完成：

第一步，系统将所有 ELOG 内容生成到当月的月度 ELOG 日志文件中，命名为“dm_实例名_年月”。例如：9 月的月度 ELOG 日志文件为 dm_DMSERVER_202209.log。

第二步，当符合 SVR_ELOG_FREQ 切换频率的切换点来临时，系统将月度 ELOG 日志文件中最近生成的（1 月/1 日/1 时）日志，剪切并归档到新的（分月/分日/分时）ELOG 日志文件中，命名为“dm*实例名*日期_整点”，其中后缀中的整点为该日志首条记录的时间。不论切换频率为月、日或时，切换的时间点均为某时 0 分。例如：设置 SVR_ELOG_FREQ=2 按小时进行切换，则归档后的分时 ELOG 日志文件名为 dm_DMSERVER_20220914_09.log。

![图 2.2 ELOG 日志文件.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20240814144736U4KQHICLQ0VQZKXXY7)

图 2.2 ELOG_FLAG 为 0 时的 ELOG 日志文件

通过查询动态视图 V$ELOG_FILE 可以获得当前实例的日志文件的信息。可以使用系统过程 SP_ELOG_FILE_DELETE 删除指定文件名的 ELOG 日志文件。
