

# 数据库检查

本章节主要介绍达梦数据库检查常见问题，为用户提供数据库检查常见问题的分析和解决思路。除此之外，用户还可前往[达梦技术社区](https://eco.dameng.com/community/question/)参与更多问题讨论。

## 目录

  * [动态级参数在 dm.ini 里修改后重启应用不生效吗](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%8A%A8%E6%80%81%E7%BA%A7%E5%8F%82%E6%95%B0%E5%9C%A8%20dm.ini%20%E9%87%8C%E4%BF%AE%E6%94%B9%E5%90%8E%E9%87%8D%E5%90%AF%E5%BA%94%E7%94%A8%E4%B8%8D%E7%94%9F%E6%95%88%E5%90%97)
  * [dmsql_数据库实例名.log，这个日志怎么关掉](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#dmsql_%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B%E5%90%8D.log%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%97%A5%E5%BF%97%E6%80%8E%E4%B9%88%E5%85%B3%E6%8E%89)
  * [如何查看数据库初始化信息，如页大小，簇大小，字符集和大小写敏感等](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%A6%82%E9%A1%B5%E5%A4%A7%E5%B0%8F%EF%BC%8C%E7%B0%87%E5%A4%A7%E5%B0%8F%EF%BC%8C%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E5%A4%A7%E5%B0%8F%E5%86%99%E6%95%8F%E6%84%9F%E7%AD%89)
  * [DM 数据库管理常用 SQL 命令](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DM%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E5%B8%B8%E7%94%A8%20SQL%20%E5%91%BD%E4%BB%A4)
  * [报错日志、系统日志](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%8A%A5%E9%94%99%E6%97%A5%E5%BF%97%E3%80%81%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97)
  * [DM 内存泄漏/异常的检查](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DM%20%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F/%E5%BC%82%E5%B8%B8%E7%9A%84%E6%A3%80%E6%9F%A5)
  * [数据库的内存使用情况](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5)
  * [是否存在使用内存过多的 SQL](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E8%BF%87%E5%A4%9A%E7%9A%84%20SQL)
  * [是否存在扩展过大的内存池](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E6%89%A9%E5%B1%95%E8%BF%87%E5%A4%A7%E7%9A%84%E5%86%85%E5%AD%98%E6%B1%A0)
  * [确认内存的详细使用情况](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%A1%AE%E8%AE%A4%E5%86%85%E5%AD%98%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5)
  * [内存异常的检查](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%86%85%E5%AD%98%E5%BC%82%E5%B8%B8%E7%9A%84%E6%A3%80%E6%9F%A5)
  * [扩展数据库的 REDO 日志](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%89%A9%E5%B1%95%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%20REDO%20%E6%97%A5%E5%BF%97)
  * [DEM 工具及使用方法示例](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E5%B7%A5%E5%85%B7%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E7%A4%BA%E4%BE%8B)
  * [MANAGER 如何查看数据库配置信息](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#MANAGER%20%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF)
  * [MANAGER 查看外键](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#MANAGER%20%E6%9F%A5%E7%9C%8B%E5%A4%96%E9%94%AE)
  * [控制台工具查看试用截止日期](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%B7%A5%E5%85%B7%E6%9F%A5%E7%9C%8B%E8%AF%95%E7%94%A8%E6%88%AA%E6%AD%A2%E6%97%A5%E6%9C%9F)
  * [数据库完整性校验](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C)
  * [达梦数据库校验工具的使用](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%A1%E9%AA%8C%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8)
  * [字符串比较大小写敏感](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83%E5%A4%A7%E5%B0%8F%E5%86%99%E6%95%8F%E6%84%9F)
  * [对字段的值比较而言](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AF%B9%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC%E6%AF%94%E8%BE%83%E8%80%8C%E8%A8%80)
  * [对于表名、字段名而言](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AF%B9%E4%BA%8E%E8%A1%A8%E5%90%8D%E3%80%81%E5%AD%97%E6%AE%B5%E5%90%8D%E8%80%8C%E8%A8%80)
  * [查询达梦关键字列表/保留字](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%9F%A5%E8%AF%A2%E8%BE%BE%E6%A2%A6%E5%85%B3%E9%94%AE%E5%AD%97%E5%88%97%E8%A1%A8/%E4%BF%9D%E7%95%99%E5%AD%97)
  * [双引号法](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%8F%8C%E5%BC%95%E5%8F%B7%E6%B3%95)
  * [dm.ini 中的参数设置](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#dm.ini%20%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE)
  * [[-5567]授权者没有此授权权限](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#\[-5567\]%E6%8E%88%E6%9D%83%E8%80%85%E6%B2%A1%E6%9C%89%E6%AD%A4%E6%8E%88%E6%9D%83%E6%9D%83%E9%99%90)
  * [报错：多版本操作冲突过多 或 Too many mvcc conflict](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%8A%A5%E9%94%99%EF%BC%9A%E5%A4%9A%E7%89%88%E6%9C%AC%E6%93%8D%E4%BD%9C%E5%86%B2%E7%AA%81%E8%BF%87%E5%A4%9A%20%E6%88%96%20Too%20many%20mvcc%20conflict)
  * [[-2148]:标记不匹配](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#\[-2148\]:%E6%A0%87%E8%AE%B0%E4%B8%8D%E5%8C%B9%E9%85%8D)
  * [达梦数据库开启日志](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%80%E5%90%AF%E6%97%A5%E5%BF%97)
  * [修改数据库实例的字符集](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86)
  * [修改数据库实例的端口号](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7)
  * [删除模式报错](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%88%A0%E9%99%A4%E6%A8%A1%E5%BC%8F%E6%8A%A5%E9%94%99)
  * [达梦错误码汇总](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E9%94%99%E8%AF%AF%E7%A0%81%E6%B1%87%E6%80%BB)
  * [空间数据类型](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B)
  * [如何查询数据库版本](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC)
  * [设置插入空字符串，在数据库里存 NULL](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%AE%BE%E7%BD%AE%E6%8F%92%E5%85%A5%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E5%9C%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E9%87%8C%E5%AD%98%20NULL)
  * [无法比较的数据类型](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%97%A0%E6%B3%95%E6%AF%94%E8%BE%83%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B)
  * [查询所有表的字段，注释、类型、类型长度等](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E8%A1%A8%E7%9A%84%E5%AD%97%E6%AE%B5%EF%BC%8C%E6%B3%A8%E9%87%8A%E3%80%81%E7%B1%BB%E5%9E%8B%E3%80%81%E7%B1%BB%E5%9E%8B%E9%95%BF%E5%BA%A6%E7%AD%89)
  * [DMSBT 接口版本号与数据库服务器不匹配](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DMSBT%20%E6%8E%A5%E5%8F%A3%E7%89%88%E6%9C%AC%E5%8F%B7%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8D%E5%8C%B9%E9%85%8D)
  * [执行查询返回错误[-7120]:回滚记录版本太旧无法获取用户记录](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%89%A7%E8%A1%8C%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF\[-7120\]:%E5%9B%9E%E6%BB%9A%E8%AE%B0%E5%BD%95%E7%89%88%E6%9C%AC%E5%A4%AA%E6%97%A7%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%AE%B0%E5%BD%95)
  * [查看数据库的到期时间](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%88%B0%E6%9C%9F%E6%97%B6%E9%97%B4)
  * [自增列不允许修改](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%87%AA%E5%A2%9E%E5%88%97%E4%B8%8D%E5%85%81%E8%AE%B8%E4%BF%AE%E6%94%B9)
  * [如何收集统计信息](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%94%B6%E9%9B%86%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF)
  * [获取某个模式下某表的存储大小](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%9F%90%E8%A1%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%A4%A7%E5%B0%8F)
  * [扩展数据库的重做日志](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%89%A9%E5%B1%95%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%87%8D%E5%81%9A%E6%97%A5%E5%BF%97)
  * [达梦数据库怎么开启审计功能](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E6%80%8E%E4%B9%88%E5%BC%80%E5%90%AF%E5%AE%A1%E8%AE%A1%E5%8A%9F%E8%83%BD)
  * [怎样修改“LENGTH_IN_CHAR(长度是否以字符为单位)”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%80%8E%E6%A0%B7%E4%BF%AE%E6%94%B9%E2%80%9CLENGTH_IN_CHAR\(%E9%95%BF%E5%BA%A6%E6%98%AF%E5%90%A6%E4%BB%A5%E5%AD%97%E7%AC%A6%E4%B8%BA%E5%8D%95%E4%BD%8D\)%E2%80%9D)
  * [logmnr_contents 视图中，哪些字段表示用户的主机名和用户的 IP](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#logmnr_contents%20%E8%A7%86%E5%9B%BE%E4%B8%AD%EF%BC%8C%E5%93%AA%E4%BA%9B%E5%AD%97%E6%AE%B5%E8%A1%A8%E7%A4%BA%E7%94%A8%E6%88%B7%E7%9A%84%E4%B8%BB%E6%9C%BA%E5%90%8D%E5%92%8C%E7%94%A8%E6%88%B7%E7%9A%84%20IP)
  * [查询 SQL 执行记录](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%9F%A5%E8%AF%A2%20SQL%20%E6%89%A7%E8%A1%8C%E8%AE%B0%E5%BD%95)
  * [报错：reached the max session limit](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%8A%A5%E9%94%99%EF%BC%9Areached%20the%20max%20session%20limit)
  * [查询当前模式下有那些表的 SQL 语句](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E6%A8%A1%E5%BC%8F%E4%B8%8B%E6%9C%89%E9%82%A3%E4%BA%9B%E8%A1%A8%E7%9A%84%20SQL%20%E8%AF%AD%E5%8F%A5)
  * [如何查出某个用户下的某个数据库的所有表名](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E5%87%BA%E6%9F%90%E4%B8%AA%E7%94%A8%E6%88%B7%E4%B8%8B%E7%9A%84%E6%9F%90%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%89%80%E6%9C%89%E8%A1%A8%E5%90%8D)
  * [如何查看建库时的字符集](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E5%BB%BA%E5%BA%93%E6%97%B6%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86)
  * [是否有 show parameter/show variables 之类的功能参数](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%98%AF%E5%90%A6%E6%9C%89%20show%20parameter/show%20variables%20%E4%B9%8B%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD%E5%8F%82%E6%95%B0)
  * [达梦的页大小，怎么设置以及获取](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E7%9A%84%E9%A1%B5%E5%A4%A7%E5%B0%8F%EF%BC%8C%E6%80%8E%E4%B9%88%E8%AE%BE%E7%BD%AE%E4%BB%A5%E5%8F%8A%E8%8E%B7%E5%8F%96)
  * [如何切换模式](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E5%88%87%E6%8D%A2%E6%A8%A1%E5%BC%8F)
  * [如何切换数据库](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E5%88%87%E6%8D%A2%E6%95%B0%E6%8D%AE%E5%BA%93)
  * [如何查询和修改数据库实例名](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E5%92%8C%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B%E5%90%8D)
  * [如何收缩数据库大小](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%94%B6%E7%BC%A9%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%A7%E5%B0%8F)
  * [如何把 varchar 类型变成 clob/TEXT 类型](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%8A%8A%20varchar%20%E7%B1%BB%E5%9E%8B%E5%8F%98%E6%88%90%20clob/TEXT%20%E7%B1%BB%E5%9E%8B)
  * [如何获取达梦当前模式名](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E8%BE%BE%E6%A2%A6%E5%BD%93%E5%89%8D%E6%A8%A1%E5%BC%8F%E5%90%8D)
  * [列长度超出定义如何处理](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%88%97%E9%95%BF%E5%BA%A6%E8%B6%85%E5%87%BA%E5%AE%9A%E4%B9%89%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86)
  * [达梦数据库的 boolean 类型是用什么表示](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%20boolean%20%E7%B1%BB%E5%9E%8B%E6%98%AF%E7%94%A8%E4%BB%80%E4%B9%88%E8%A1%A8%E7%A4%BA)
  * [创建表的 blob 类型字段如何指定精度](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%9A%84%20blob%20%E7%B1%BB%E5%9E%8B%E5%AD%97%E6%AE%B5%E5%A6%82%E4%BD%95%E6%8C%87%E5%AE%9A%E7%B2%BE%E5%BA%A6)
  * [timestamp 类型为什么不可以修改精度](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#timestamp%20%E7%B1%BB%E5%9E%8B%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%8F%AF%E4%BB%A5%E4%BF%AE%E6%94%B9%E7%B2%BE%E5%BA%A6)
  * [字符类型 TEXT 的精度是否可以调高](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B%20TEXT%20%E7%9A%84%E7%B2%BE%E5%BA%A6%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E8%B0%83%E9%AB%98)
  * [如何判定当前库中某一个表是否存在](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E5%88%A4%E5%AE%9A%E5%BD%93%E5%89%8D%E5%BA%93%E4%B8%AD%E6%9F%90%E4%B8%80%E4%B8%AA%E8%A1%A8%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8)
  * [page_size/页大小在初始化数据库后是否可以更改](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#page_size/%E9%A1%B5%E5%A4%A7%E5%B0%8F%E5%9C%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8E%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E6%9B%B4%E6%94%B9)
  * [对 blob 字段进行 like 查询性能较慢](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AF%B9%20blob%20%E5%AD%97%E6%AE%B5%E8%BF%9B%E8%A1%8C%20like%20%E6%9F%A5%E8%AF%A2%E6%80%A7%E8%83%BD%E8%BE%83%E6%85%A2)
  * [给 TEXT 类型创建索引失败：试图在 BLOB/ClOB/ 用户自定义数据类型上建索引](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%BB%99%20TEXT%20%E7%B1%BB%E5%9E%8B%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E5%A4%B1%E8%B4%A5%EF%BC%9A%E8%AF%95%E5%9B%BE%E5%9C%A8%20BLOB/ClOB/%20%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8A%E5%BB%BA%E7%B4%A2%E5%BC%95)
  * [database 视图里 total_size 的单位是什么](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check#V$database%20%E8%A7%86%E5%9B%BE%E9%87%8C%20total_size%20%E7%9A%84%E5%8D%95%E4%BD%8D%E6%98%AF%E4%BB%80%E4%B9%88)
  * [如何查看实例是否是空格自动填充](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E5%AE%9E%E4%BE%8B%E6%98%AF%E5%90%A6%E6%98%AF%E7%A9%BA%E6%A0%BC%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85)
  * [删除用户报错：当前对象被占用](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E6%8A%A5%E9%94%99%EF%BC%9A%E5%BD%93%E5%89%8D%E5%AF%B9%E8%B1%A1%E8%A2%AB%E5%8D%A0%E7%94%A8)
  * [应用插入数据到达梦数据库报磁盘空间不足](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%BA%94%E7%94%A8%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E5%88%B0%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%A5%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3)
  * [字符串转换出错一般出现在怎样的使用场景中](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E5%87%BA%E9%94%99%E4%B8%80%E8%88%AC%E5%87%BA%E7%8E%B0%E5%9C%A8%E6%80%8E%E6%A0%B7%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%AD)
  * [试图删除已经使用的表空间](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%AF%95%E5%9B%BE%E5%88%A0%E9%99%A4%E5%B7%B2%E7%BB%8F%E4%BD%BF%E7%94%A8%E7%9A%84%E8%A1%A8%E7%A9%BA%E9%97%B4)
  * [无效的数组查询对象](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%97%A0%E6%95%88%E7%9A%84%E6%95%B0%E7%BB%84%E6%9F%A5%E8%AF%A2%E5%AF%B9%E8%B1%A1)
  * [数据插入后但是归档日志分析结果没内容](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E5%90%8E%E4%BD%86%E6%98%AF%E5%BD%92%E6%A1%A3%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C%E6%B2%A1%E5%86%85%E5%AE%B9)
  * [MEMORY_POOL 一般设置多少合适](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#MEMORY_POOL%20%E4%B8%80%E8%88%AC%E8%AE%BE%E7%BD%AE%E5%A4%9A%E5%B0%91%E5%90%88%E9%80%82)
  * [VARCHAR、TEXT 字段类型存储内容长度受分页限制吗？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#VARCHAR%E3%80%81TEXT%20%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E5%AD%98%E5%82%A8%E5%86%85%E5%AE%B9%E9%95%BF%E5%BA%A6%E5%8F%97%E5%88%86%E9%A1%B5%E9%99%90%E5%88%B6%E5%90%97%EF%BC%9F)
  * [如何修改 dm.ini 配置文件的参数](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%20dm.ini%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%8F%82%E6%95%B0)
  * [Oracle 中 raw 类型在达梦中可以用哪种类型代替](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#Oracle%20%E4%B8%AD%20raw%20%E7%B1%BB%E5%9E%8B%E5%9C%A8%E8%BE%BE%E6%A2%A6%E4%B8%AD%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%93%AA%E7%A7%8D%E7%B1%BB%E5%9E%8B%E4%BB%A3%E6%9B%BF)
  * [表空间的大小，对于数据库模式的性能会不会有影响](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%A1%A8%E7%A9%BA%E9%97%B4%E7%9A%84%E5%A4%A7%E5%B0%8F%EF%BC%8C%E5%AF%B9%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%9A%E4%B8%8D%E4%BC%9A%E6%9C%89%E5%BD%B1%E5%93%8D)
  * [收集统计信息是什么机制，是隔多长时间会执行一次，必须要手动执行？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%94%B6%E9%9B%86%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E6%98%AF%E4%BB%80%E4%B9%88%E6%9C%BA%E5%88%B6%EF%BC%8C%E6%98%AF%E9%9A%94%E5%A4%9A%E9%95%BF%E6%97%B6%E9%97%B4%E4%BC%9A%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AC%A1%EF%BC%8C%E5%BF%85%E9%A1%BB%E8%A6%81%E6%89%8B%E5%8A%A8%E6%89%A7%E8%A1%8C%EF%BC%9F)
  * [Key/授权过期后，用新的授权加载进数据库，之前数据库数据是会保留还是会被自动删除](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#Key/%E6%8E%88%E6%9D%83%E8%BF%87%E6%9C%9F%E5%90%8E%EF%BC%8C%E7%94%A8%E6%96%B0%E7%9A%84%E6%8E%88%E6%9D%83%E5%8A%A0%E8%BD%BD%E8%BF%9B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E4%B9%8B%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E6%98%AF%E4%BC%9A%E4%BF%9D%E7%95%99%E8%BF%98%E6%98%AF%E4%BC%9A%E8%A2%AB%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4)
  * [管理工具黑屏](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E9%BB%91%E5%B1%8F)
  * [表字段实际占用的长度与 VARCHAR() 精度不一致](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%A1%A8%E5%AD%97%E6%AE%B5%E5%AE%9E%E9%99%85%E5%8D%A0%E7%94%A8%E7%9A%84%E9%95%BF%E5%BA%A6%E4%B8%8E%20VARCHAR\(\)%20%E7%B2%BE%E5%BA%A6%E4%B8%8D%E4%B8%80%E8%87%B4)
  * [如何调整配置参数/调整 dm.ini 参数/调整兼容性（COMPATIBLE_MODE）参数/…](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E8%B0%83%E6%95%B4%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0/%E8%B0%83%E6%95%B4%20dm.ini%20%E5%8F%82%E6%95%B0/%E8%B0%83%E6%95%B4%E5%85%BC%E5%AE%B9%E6%80%A7%EF%BC%88COMPATIBLE_MODE%EF%BC%89%E5%8F%82%E6%95%B0/%E2%80%A6)
  * [如何在达梦数据库中获取表的创建时间](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E5%9C%A8%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E8%8E%B7%E5%8F%96%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA%E6%97%B6%E9%97%B4)
  * [达梦数据库创建函数时，如何捕获异常信息](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9B%E5%BB%BA%E5%87%BD%E6%95%B0%E6%97%B6%EF%BC%8C%E5%A6%82%E4%BD%95%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8%E4%BF%A1%E6%81%AF)
  * [达梦里有 sql_stat_history 获取 sql 的视图机制吗](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E9%87%8C%E6%9C%89%20v$sql_stat_history%20%E8%8E%B7%E5%8F%96%20sql%20%E7%9A%84%E8%A7%86%E5%9B%BE%E6%9C%BA%E5%88%B6%E5%90%97)
  * [是否可以通过不重启数据库服务的方式将临时授权替换正式授权？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%B8%8D%E9%87%8D%E5%90%AF%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%96%B9%E5%BC%8F%E5%B0%86%E4%B8%B4%E6%97%B6%E6%8E%88%E6%9D%83%E6%9B%BF%E6%8D%A2%E6%AD%A3%E5%BC%8F%E6%8E%88%E6%9D%83%EF%BC%9F)
  * [如何查看数据库里的所有外键关联表](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E9%87%8C%E7%9A%84%E6%89%80%E6%9C%89%E5%A4%96%E9%94%AE%E5%85%B3%E8%81%94%E8%A1%A8)
  * [如何查询数据库实例的初始化参数？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8F%82%E6%95%B0%EF%BC%9F)
  * [达梦数据库如何查询那些表使用了自增列？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E9%82%A3%E4%BA%9B%E8%A1%A8%E4%BD%BF%E7%94%A8%E4%BA%86%E8%87%AA%E5%A2%9E%E5%88%97%EF%BC%9F)
  * [统计用户下的表和数据量](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%BB%9F%E8%AE%A1%E7%94%A8%E6%88%B7%E4%B8%8B%E7%9A%84%E8%A1%A8%E5%92%8C%E6%95%B0%E6%8D%AE%E9%87%8F)
  * [如何查询用户拥有哪些角色权限？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E6%8B%A5%E6%9C%89%E5%93%AA%E4%BA%9B%E8%A7%92%E8%89%B2%E6%9D%83%E9%99%90%EF%BC%9F)
  * [数据库查询时间与服务器本身时间不一致](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E6%97%B6%E9%97%B4%E4%B8%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9C%AC%E8%BA%AB%E6%97%B6%E9%97%B4%E4%B8%8D%E4%B8%80%E8%87%B4)
  * [数据库中执行 DML 语句长时间无响应](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E6%89%A7%E8%A1%8C%20DML%20%E8%AF%AD%E5%8F%A5%E9%95%BF%E6%97%B6%E9%97%B4%E6%97%A0%E5%93%8D%E5%BA%94)
  * [在 DSC 环境中修改 DCR 配置信息时报错：Disk[/dev/raw/raw1] is in using](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%9C%A8%20DSC%20%E7%8E%AF%E5%A2%83%E4%B8%AD%E4%BF%AE%E6%94%B9%20DCR%20%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E6%97%B6%E6%8A%A5%E9%94%99%EF%BC%9ADisk\[/dev/raw/raw1\]%20is%20in%20using)
  * [用达梦管理工具，创建表空间报错：创建数据文件失败](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%94%A8%E8%BE%BE%E6%A2%A6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%EF%BC%8C%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%8A%A5%E9%94%99%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E5%A4%B1%E8%B4%A5)
  * [如何查看数据库所有表空间大小及其使用情况](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%80%E6%9C%89%E8%A1%A8%E7%A9%BA%E9%97%B4%E5%A4%A7%E5%B0%8F%E5%8F%8A%E5%85%B6%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5)
  * [达梦工具（manager、dts、dbca 和 console 等）详细报错可以在哪里获取](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E5%B7%A5%E5%85%B7%EF%BC%88manager%E3%80%81dts%E3%80%81dbca%20%E5%92%8C%20console%20%E7%AD%89%EF%BC%89%E8%AF%A6%E7%BB%86%E6%8A%A5%E9%94%99%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%93%AA%E9%87%8C%E8%8E%B7%E5%8F%96)
  * [dem 安装集群报错：没有创建服务权限](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#dem%20%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4%E6%8A%A5%E9%94%99%EF%BC%9A%E6%B2%A1%E6%9C%89%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90)
  * [更改后的 key 文件不生效，授权的日期时间没变，应如何正确更换 DM 的 key 文件](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%9B%B4%E6%94%B9%E5%90%8E%E7%9A%84%20key%20%E6%96%87%E4%BB%B6%E4%B8%8D%E7%94%9F%E6%95%88%EF%BC%8C%E6%8E%88%E6%9D%83%E7%9A%84%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E6%B2%A1%E5%8F%98%EF%BC%8C%E5%BA%94%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E6%9B%B4%E6%8D%A2%20DM%20%E7%9A%84%20key%20%E6%96%87%E4%BB%B6)
  * [本地 disql 登录正常，应用连接网络偶尔断开](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%9C%AC%E5%9C%B0%20disql%20%E7%99%BB%E5%BD%95%E6%AD%A3%E5%B8%B8%EF%BC%8C%E5%BA%94%E7%94%A8%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9C%E5%81%B6%E5%B0%94%E6%96%AD%E5%BC%80)
  * [如何查看统计信息收集情况](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%83%85%E5%86%B5)
  * [扩展表空间失败：[-3410]:表空间上有事务未提交](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%89%A9%E5%B1%95%E8%A1%A8%E7%A9%BA%E9%97%B4%E5%A4%B1%E8%B4%A5%EF%BC%9A\[-3410\]:%E8%A1%A8%E7%A9%BA%E9%97%B4%E4%B8%8A%E6%9C%89%E4%BA%8B%E5%8A%A1%E6%9C%AA%E6%8F%90%E4%BA%A4)
  * [如何查询统计表的各种约束](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E7%BB%9F%E8%AE%A1%E8%A1%A8%E7%9A%84%E5%90%84%E7%A7%8D%E7%BA%A6%E6%9D%9F)
  * [审计日志文件如何指定自定义路径](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%A6%82%E4%BD%95%E6%8C%87%E5%AE%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%AF%E5%BE%84)
  * [存储过程中对自动扩展的分区表执行插入未定义的分区数据报错：​"语句块/包/存储函数中的间隔分区不支持自动扩展​"](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%AF%B9%E8%87%AA%E5%8A%A8%E6%89%A9%E5%B1%95%E7%9A%84%E5%88%86%E5%8C%BA%E8%A1%A8%E6%89%A7%E8%A1%8C%E6%8F%92%E5%85%A5%E6%9C%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%88%86%E5%8C%BA%E6%95%B0%E6%8D%AE%E6%8A%A5%E9%94%99%EF%BC%9A%22%E8%AF%AD%E5%8F%A5%E5%9D%97/%E5%8C%85/%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0%E4%B8%AD%E7%9A%84%E9%97%B4%E9%9A%94%E5%88%86%E5%8C%BA%E4%B8%8D%E6%94%AF%E6%8C%81%E8%87%AA%E5%8A%A8%E6%89%A9%E5%B1%95%22)
  * [启动 dmagent 报错：permission denied](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%90%AF%E5%8A%A8%20dmagent%20%E6%8A%A5%E9%94%99%EF%BC%9Apermission%20denied)
  * [DEM 监控不到主机信息](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E7%9B%91%E6%8E%A7%E4%B8%8D%E5%88%B0%E4%B8%BB%E6%9C%BA%E4%BF%A1%E6%81%AF)
  * [创建 dm8-oracle11G 的 dblink，进行查询时报错：[-6010]:Error in line:1 Connection lost.](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%88%9B%E5%BB%BA%20dm8-oracle11G%20%E7%9A%84%20dblink%EF%BC%8C%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2%E6%97%B6%E6%8A%A5%E9%94%99%EF%BC%9A\[-6010\]:Error%20in%20line:1%20Connection%20lost.)
  * [DM 数据库在麒麟 10 操作系统上关闭 numa，透明大页和修改磁盘调度算法未生效](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DM%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8%E9%BA%92%E9%BA%9F%2010%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%8A%E5%85%B3%E9%97%AD%20numa%EF%BC%8C%E9%80%8F%E6%98%8E%E5%A4%A7%E9%A1%B5%E5%92%8C%E4%BF%AE%E6%94%B9%E7%A3%81%E7%9B%98%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E6%9C%AA%E7%94%9F%E6%95%88)
  * [dmagent 使用 service.sh start 以服务方式启动时报错：The service DmAgentService is not install](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#dmagent%20%E4%BD%BF%E7%94%A8%20service.sh%20start%20%E4%BB%A5%E6%9C%8D%E5%8A%A1%E6%96%B9%E5%BC%8F%E5%90%AF%E5%8A%A8%E6%97%B6%E6%8A%A5%E9%94%99%EF%BC%9AThe%20service%20DmAgentService%20is%20not%20install)
  * [在服务器没有 JDK 的环境下，应如何启动 dmagent 服务](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B2%A1%E6%9C%89%20JDK%20%E7%9A%84%E7%8E%AF%E5%A2%83%E4%B8%8B%EF%BC%8C%E5%BA%94%E5%A6%82%E4%BD%95%E5%90%AF%E5%8A%A8%20dmagent%20%E6%9C%8D%E5%8A%A1)
  * [如何将两台主备集群更改为 nomal 模式](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E5%B0%86%E4%B8%A4%E5%8F%B0%E4%B8%BB%E5%A4%87%E9%9B%86%E7%BE%A4%E6%9B%B4%E6%94%B9%E4%B8%BA%20nomal%20%E6%A8%A1%E5%BC%8F)
  * [DEM 监控 linux 多台主机的时候只能显示一台](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E7%9B%91%E6%8E%A7%20linux%20%E5%A4%9A%E5%8F%B0%E4%B8%BB%E6%9C%BA%E7%9A%84%E6%97%B6%E5%80%99%E5%8F%AA%E8%83%BD%E6%98%BE%E7%A4%BA%E4%B8%80%E5%8F%B0)
  * [DEM 添加 DSC 集群问题](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E6%B7%BB%E5%8A%A0%20DSC%20%E9%9B%86%E7%BE%A4%E9%97%AE%E9%A2%98)
  * [数据库连接资源释放](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E8%B5%84%E6%BA%90%E9%87%8A%E6%94%BE)
  * [DM8 客户端管理工具上修改普通用户报错“无效的表或视图名[SYSUSERPROFILES]​"](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DM8%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E4%B8%8A%E4%BF%AE%E6%94%B9%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E6%8A%A5%E9%94%99%E2%80%9C%E6%97%A0%E6%95%88%E7%9A%84%E8%A1%A8%E6%88%96%E8%A7%86%E5%9B%BE%E5%90%8D\[SYSUSERPROFILES\]%22)
  * [新建用户创建作业失败：没有 JOB 权限](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%96%B0%E5%BB%BA%E7%94%A8%E6%88%B7%E5%88%9B%E5%BB%BA%E4%BD%9C%E4%B8%9A%E5%A4%B1%E8%B4%A5%EF%BC%9A%E6%B2%A1%E6%9C%89%20JOB%20%E6%9D%83%E9%99%90)
  * [测试环境中经常有一些长时间运行的会话，如何批量 kill 这些会话，释放连接](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%BB%8F%E5%B8%B8%E6%9C%89%E4%B8%80%E4%BA%9B%E9%95%BF%E6%97%B6%E9%97%B4%E8%BF%90%E8%A1%8C%E7%9A%84%E4%BC%9A%E8%AF%9D%EF%BC%8C%E5%A6%82%E4%BD%95%E6%89%B9%E9%87%8F%20kill%20%E8%BF%99%E4%BA%9B%E4%BC%9A%E8%AF%9D%EF%BC%8C%E9%87%8A%E6%94%BE%E8%BF%9E%E6%8E%A5)
  * [使用系统包 DBMS_STATS.GATHER_SCHEMA_STATS 收集统计信息时，如何查看收集进度？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E4%BD%BF%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%8C%85%20DBMS_STATS.GATHER_SCHEMA_STATS%20%E6%94%B6%E9%9B%86%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E6%97%B6%EF%BC%8C%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E6%94%B6%E9%9B%86%E8%BF%9B%E5%BA%A6%EF%BC%9F)
  * [在 DM 达梦数据库的运行日志中出现大量 Failure occurs in data_recv_inet_once 警告信息](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%9C%A8%20DM%20%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%BF%90%E8%A1%8C%E6%97%A5%E5%BF%97%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%20Failure%20occurs%20in%20data_recv_inet_once%20%E8%AD%A6%E5%91%8A%E4%BF%A1%E6%81%AF)
  * [如何将 ASM 磁盘中的文件拷贝出来](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E5%B0%86%20ASM%20%E7%A3%81%E7%9B%98%E4%B8%AD%E7%9A%84%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D%E5%87%BA%E6%9D%A5)
  * [数据库中缺少 DBA_TABLES、USER_TABLES、DBA_FREE_SPACE 等系统视图](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%BC%BA%E5%B0%91%20DBA_TABLES%E3%80%81USER_TABLES%E3%80%81DBA_FREE_SPACE%20%E7%AD%89%E7%B3%BB%E7%BB%9F%E8%A7%86%E5%9B%BE)
  * [DEM 后台数据库数据总量过大怎么办？能定期清理吗？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E5%90%8E%E5%8F%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0%E6%8D%AE%E6%80%BB%E9%87%8F%E8%BF%87%E5%A4%A7%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F%E8%83%BD%E5%AE%9A%E6%9C%9F%E6%B8%85%E7%90%86%E5%90%97%EF%BC%9F)
  * [使用 Tomcat 10 版本部署 DEM 时，浏览器打开管理界面报错：HHTP 状态 404-未找到](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E4%BD%BF%E7%94%A8%20Tomcat%2010%20%E7%89%88%E6%9C%AC%E9%83%A8%E7%BD%B2%20DEM%20%E6%97%B6%EF%BC%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%93%E5%BC%80%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2%E6%8A%A5%E9%94%99%EF%BC%9AHHTP%20%E7%8A%B6%E6%80%81%20404-%E6%9C%AA%E6%89%BE%E5%88%B0)
  * [如何查看某个表被哪些视图引用了？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%B8%AA%E8%A1%A8%E8%A2%AB%E5%93%AA%E4%BA%9B%E8%A7%86%E5%9B%BE%E5%BC%95%E7%94%A8%E4%BA%86%EF%BC%9F)
  * [开启 SQL 监控参数，使用非 DBA 用户查看 ET 方法报错：“没有执行[ET]对象权限”。](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%BC%80%E5%90%AF%20SQL%20%E7%9B%91%E6%8E%A7%E5%8F%82%E6%95%B0%EF%BC%8C%E4%BD%BF%E7%94%A8%E9%9D%9E%20DBA%20%E7%94%A8%E6%88%B7%E6%9F%A5%E7%9C%8B%20ET%20%E6%96%B9%E6%B3%95%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9C%E6%B2%A1%E6%9C%89%E6%89%A7%E8%A1%8C\[ET\]%E5%AF%B9%E8%B1%A1%E6%9D%83%E9%99%90%E2%80%9D%E3%80%82)
  * [SQL 监控查询语句汇总](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#SQL%20%E7%9B%91%E6%8E%A7%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E6%B1%87%E6%80%BB)
  * [如何验证通信是否已经加密？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E9%AA%8C%E8%AF%81%E9%80%9A%E4%BF%A1%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%8A%A0%E5%AF%86%EF%BC%9F)
  * [如何更新某个用户所有列的统计信息，并记录更新统计信息时长？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9B%B4%E6%96%B0%E6%9F%90%E4%B8%AA%E7%94%A8%E6%88%B7%E6%89%80%E6%9C%89%E5%88%97%E7%9A%84%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%B9%B6%E8%AE%B0%E5%BD%95%E6%9B%B4%E6%96%B0%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF%E6%97%B6%E9%95%BF%EF%BC%9F)
  * [DEM 部署后，导入导出报错：​"java_library.path 路径不存在 dexp 执行程序​"](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E9%83%A8%E7%BD%B2%E5%90%8E%EF%BC%8C%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E6%8A%A5%E9%94%99%EF%BC%9A%22java_library.path%20%E8%B7%AF%E5%BE%84%E4%B8%8D%E5%AD%98%E5%9C%A8%20dexp%20%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%22)
  * [SQL 语句存在不可见字符导致语句执行失败](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#SQL%20%E8%AF%AD%E5%8F%A5%E5%AD%98%E5%9C%A8%E4%B8%8D%E5%8F%AF%E8%A7%81%E5%AD%97%E7%AC%A6%E5%AF%BC%E8%87%B4%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E5%A4%B1%E8%B4%A5)
  * [如何不停库移动用户表空间对应的数据文件](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E4%B8%8D%E5%81%9C%E5%BA%93%E7%A7%BB%E5%8A%A8%E7%94%A8%E6%88%B7%E8%A1%A8%E7%A9%BA%E9%97%B4%E5%AF%B9%E5%BA%94%E7%9A%84%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6)
  * [DBLINK 报错信息在实例日志中不显示](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DBLINK%20%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF%E5%9C%A8%E5%AE%9E%E4%BE%8B%E6%97%A5%E5%BF%97%E4%B8%AD%E4%B8%8D%E6%98%BE%E7%A4%BA)
  * [SQL 日志未按照 sqllog 配置文件大小生成](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#SQL%20%E6%97%A5%E5%BF%97%E6%9C%AA%E6%8C%89%E7%85%A7%20sqllog%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F%E7%94%9F%E6%88%90)
  * [如何通过 disql 抓取数据库中的活动会话 sql](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%20disql%20%E6%8A%93%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%B4%BB%E5%8A%A8%E4%BC%9A%E8%AF%9D%20sql)
  * [WARNING: rlog free space reserved failed,add or resize log file please](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#WARNING:%20rlog%20free%20space%20reserved%20failed,add%20or%20resize%20log%20file%20please)
  * [用户 AAA 如何操作用户 BBB 的分区表](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%94%A8%E6%88%B7%20AAA%20%E5%A6%82%E4%BD%95%E6%93%8D%E4%BD%9C%E7%94%A8%E6%88%B7%20BBB%20%E7%9A%84%E5%88%86%E5%8C%BA%E8%A1%A8)
  * [操作系统报错：“No space left on device”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9CNo%20space%20left%20on%20device%E2%80%9D)
  * [dm8-dm7 的 odbc 方式 dblink 连接报错：“[-2245]:DBLINK 加载库文件失败”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#dm8-dm7%20%E7%9A%84%20odbc%20%E6%96%B9%E5%BC%8F%20dblink%20%E8%BF%9E%E6%8E%A5%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9C\[-2245\]:DBLINK%20%E5%8A%A0%E8%BD%BD%E5%BA%93%E6%96%87%E4%BB%B6%E5%A4%B1%E8%B4%A5%E2%80%9D)
  * [同一台机器部署多个 DEM 在访问时异常](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%90%8C%E4%B8%80%E5%8F%B0%E6%9C%BA%E5%99%A8%E9%83%A8%E7%BD%B2%E5%A4%9A%E4%B8%AA%20DEM%20%E5%9C%A8%E8%AE%BF%E9%97%AE%E6%97%B6%E5%BC%82%E5%B8%B8)
  * [完全刷新物化视图恢复后物化视图原数据查询为空](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AE%8C%E5%85%A8%E5%88%B7%E6%96%B0%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE%E6%81%A2%E5%A4%8D%E5%90%8E%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE%E5%8E%9F%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E4%B8%BA%E7%A9%BA)
  * [达梦数据库管理工具使用“连接组”功能](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E2%80%9C%E8%BF%9E%E6%8E%A5%E7%BB%84%E2%80%9D%E5%8A%9F%E8%83%BD)
  * [重启数据库报错：“lic info is different between dm.key and sysinfo”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E9%87%8D%E5%90%AF%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9Clic%20info%20is%20different%20between%20dm.key%20and%20sysinfo%E2%80%9D)
  * [磁盘实际使用空间大小和显示空间大小不一致](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%A3%81%E7%9B%98%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8%E7%A9%BA%E9%97%B4%E5%A4%A7%E5%B0%8F%E5%92%8C%E6%98%BE%E7%A4%BA%E7%A9%BA%E9%97%B4%E5%A4%A7%E5%B0%8F%E4%B8%8D%E4%B8%80%E8%87%B4)
  * [dm_BAKERS_年月.log 日志文件过大](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#dm_BAKERS_%E5%B9%B4%E6%9C%88.log%20%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E8%BF%87%E5%A4%A7)
  * [DM 到 DM 的 DBLINK 报错问题](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DM%20%E5%88%B0%20DM%20%E7%9A%84%20DBLINK%20%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98)
  * [建表时报错：“列定义长度超长”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%BB%BA%E8%A1%A8%E6%97%B6%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9C%E5%88%97%E5%AE%9A%E4%B9%89%E9%95%BF%E5%BA%A6%E8%B6%85%E9%95%BF%E2%80%9D)
  * [manager 工具使用 root 用户打开过后，dmdba 用户无法正常打开](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#manager%20%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%20root%20%E7%94%A8%E6%88%B7%E6%89%93%E5%BC%80%E8%BF%87%E5%90%8E%EF%BC%8Cdmdba%20%E7%94%A8%E6%88%B7%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E6%89%93%E5%BC%80)
  * [非 DBA 角色用户如何跨模式创建模式对象](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E9%9D%9E%20DBA%20%E8%A7%92%E8%89%B2%E7%94%A8%E6%88%B7%E5%A6%82%E4%BD%95%E8%B7%A8%E6%A8%A1%E5%BC%8F%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%BC%8F%E5%AF%B9%E8%B1%A1)
  * [DM 管理工具编辑错误](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DM%20%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E7%BC%96%E8%BE%91%E9%94%99%E8%AF%AF)
  * [如何使表中同时包含聚集 KEY 和大字段](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E4%BD%BF%E8%A1%A8%E4%B8%AD%E5%90%8C%E6%97%B6%E5%8C%85%E5%90%AB%E8%81%9A%E9%9B%86%20KEY%20%E5%92%8C%E5%A4%A7%E5%AD%97%E6%AE%B5)
  * [DEM 中批量执行功能选择 ssh 类型时执行报错：无法解决密钥交换算法](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E4%B8%AD%E6%89%B9%E9%87%8F%E6%89%A7%E8%A1%8C%E5%8A%9F%E8%83%BD%E9%80%89%E6%8B%A9%20ssh%20%E7%B1%BB%E5%9E%8B%E6%97%B6%E6%89%A7%E8%A1%8C%E6%8A%A5%E9%94%99%EF%BC%9A%E6%97%A0%E6%B3%95%E8%A7%A3%E5%86%B3%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E7%AE%97%E6%B3%95)
  * [DEM 中批量执行功能选择 ssh 类型时执行报错：更换有效认证方式](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E4%B8%AD%E6%89%B9%E9%87%8F%E6%89%A7%E8%A1%8C%E5%8A%9F%E8%83%BD%E9%80%89%E6%8B%A9%20ssh%20%E7%B1%BB%E5%9E%8B%E6%97%B6%E6%89%A7%E8%A1%8C%E6%8A%A5%E9%94%99%EF%BC%9A%E6%9B%B4%E6%8D%A2%E6%9C%89%E6%95%88%E8%AE%A4%E8%AF%81%E6%96%B9%E5%BC%8F)
  * [dmagent 启动报错： dmagent may be runnin,but PID file could not be found!](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#dmagent%20%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99%EF%BC%9A%20dmagent%20may%20be%20runnin,but%20PID%20file%20could%20not%20be%20found!)
  * [系统包执行错误](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%B3%BB%E7%BB%9F%E5%8C%85%E6%89%A7%E8%A1%8C%E9%94%99%E8%AF%AF)
  * [如何查询某用户下某张表上字段的具体统计信息](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E6%9F%90%E7%94%A8%E6%88%B7%E4%B8%8B%E6%9F%90%E5%BC%A0%E8%A1%A8%E4%B8%8A%E5%AD%97%E6%AE%B5%E7%9A%84%E5%85%B7%E4%BD%93%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF)
  * [没有 et 执行权限时如何查看执行计划代价？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%B2%A1%E6%9C%89%20et%20%E6%89%A7%E8%A1%8C%E6%9D%83%E9%99%90%E6%97%B6%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E4%BB%A3%E4%BB%B7%EF%BC%9F)
  * [disql 中如何使用上下左右键](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#disql%20%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E4%B8%8A%E4%B8%8B%E5%B7%A6%E5%8F%B3%E9%94%AE)
  * [部署 dem 时 agent 日志报错：“Failed to upgrade fail”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E9%83%A8%E7%BD%B2%20dem%20%E6%97%B6%20agent%20%E6%97%A5%E5%BF%97%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9CFailed%20to%20upgrade%20fail%E2%80%9D)
  * [DEM 监控数据库实例失败](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9E%E4%BE%8B%E5%A4%B1%E8%B4%A5)
  * [DPC 如何查询正在对外提供服务节点的会话数](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DPC%20%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E6%AD%A3%E5%9C%A8%E5%AF%B9%E5%A4%96%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8A%A1%E8%8A%82%E7%82%B9%E7%9A%84%E4%BC%9A%E8%AF%9D%E6%95%B0)
  * [如何禁止修改表中指定的数据](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E7%A6%81%E6%AD%A2%E4%BF%AE%E6%94%B9%E8%A1%A8%E4%B8%AD%E6%8C%87%E5%AE%9A%E7%9A%84%E6%95%B0%E6%8D%AE)
  * [如何查询用户中所有表所有列的注释、列类型、列长度、是否允许为空、缺省值](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E4%B8%AD%E6%89%80%E6%9C%89%E8%A1%A8%E6%89%80%E6%9C%89%E5%88%97%E7%9A%84%E6%B3%A8%E9%87%8A%E3%80%81%E5%88%97%E7%B1%BB%E5%9E%8B%E3%80%81%E5%88%97%E9%95%BF%E5%BA%A6%E3%80%81%E6%98%AF%E5%90%A6%E5%85%81%E8%AE%B8%E4%B8%BA%E7%A9%BA%E3%80%81%E7%BC%BA%E7%9C%81%E5%80%BC)
  * [普通数据库用户登录报错：“-2106 ：无效的表或视图名【login_history】”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%99%AE%E9%80%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9C-2106%20%EF%BC%9A%E6%97%A0%E6%95%88%E7%9A%84%E8%A1%A8%E6%88%96%E8%A7%86%E5%9B%BE%E5%90%8D%E3%80%90login_history%E3%80%91%E2%80%9D)
  * [DEM 管理平台告警信息提示：连接状态-失败](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E5%91%8A%E8%AD%A6%E4%BF%A1%E6%81%AF%E6%8F%90%E7%A4%BA%EF%BC%9A%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81-%E5%A4%B1%E8%B4%A5)
  * [如何查询包、存储过程、函数的具体执行情况？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E5%8C%85%E3%80%81%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E3%80%81%E5%87%BD%E6%95%B0%E7%9A%84%E5%85%B7%E4%BD%93%E6%89%A7%E8%A1%8C%E6%83%85%E5%86%B5%EF%BC%9F)
  * [window 环境下通过管理工具添加 IP 限定只允许本机登录时报错](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#window%20%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%80%9A%E8%BF%87%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E6%B7%BB%E5%8A%A0%20IP%20%E9%99%90%E5%AE%9A%E5%8F%AA%E5%85%81%E8%AE%B8%E6%9C%AC%E6%9C%BA%E7%99%BB%E5%BD%95%E6%97%B6%E6%8A%A5%E9%94%99)
  * [hash 分区表进行 DDL 和 DML 操作报错:“锁超时”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#hash%20%E5%88%86%E5%8C%BA%E8%A1%A8%E8%BF%9B%E8%A1%8C%20DDL%20%E5%92%8C%20DML%20%E6%93%8D%E4%BD%9C%E6%8A%A5%E9%94%99:%E2%80%9C%E9%94%81%E8%B6%85%E6%97%B6%E2%80%9D)
  * [DPC 集群中添加分区时报错：​"-3806: 表依赖于分区组，不能做该 ALTER 操作​"](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DPC%20%E9%9B%86%E7%BE%A4%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%88%86%E5%8C%BA%E6%97%B6%E6%8A%A5%E9%94%99%EF%BC%9A%22-3806:%20%E8%A1%A8%E4%BE%9D%E8%B5%96%E4%BA%8E%E5%88%86%E5%8C%BA%E7%BB%84%EF%BC%8C%E4%B8%8D%E8%83%BD%E5%81%9A%E8%AF%A5%20ALTER%20%E6%93%8D%E4%BD%9C%22)
  * [无法对 DPC 集群进行滚动升级](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%97%A0%E6%B3%95%E5%AF%B9%20DPC%20%E9%9B%86%E7%BE%A4%E8%BF%9B%E8%A1%8C%E6%BB%9A%E5%8A%A8%E5%8D%87%E7%BA%A7)
  * [如何配置秒级调度作业](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E7%A7%92%E7%BA%A7%E8%B0%83%E5%BA%A6%E4%BD%9C%E4%B8%9A)
  * [DPC 集群扩展节点报错：“数据还原失败”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DPC%20%E9%9B%86%E7%BE%A4%E6%89%A9%E5%B1%95%E8%8A%82%E7%82%B9%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9C%E6%95%B0%E6%8D%AE%E8%BF%98%E5%8E%9F%E5%A4%B1%E8%B4%A5%E2%80%9D)
  * [通过 ET 工具查看操作符的执行时间，发现有非该语句的执行计划操作符](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E9%80%9A%E8%BF%87%20ET%20%E5%B7%A5%E5%85%B7%E6%9F%A5%E7%9C%8B%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%9C%89%E9%9D%9E%E8%AF%A5%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92%E6%93%8D%E4%BD%9C%E7%AC%A6)
  * [数据库日志报错：“pthread create error in os_thread create with 11”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9Cpthread%20create%20error%20in%20os_thread%20create%20with%2011%E2%80%9D)
  * [管理工具中批量执行 SQL 时遇到报错如何继续执行](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E4%B8%AD%E6%89%B9%E9%87%8F%E6%89%A7%E8%A1%8C%20SQL%20%E6%97%B6%E9%81%87%E5%88%B0%E6%8A%A5%E9%94%99%E5%A6%82%E4%BD%95%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C)
  * [没有 [DBA_INDEXES] 对象的查询权限](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%B2%A1%E6%9C%89%20\[DBA_INDEXES\]%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%9D%83%E9%99%90)
  * [数据库日志报错：“No space left on device”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%A5%E5%BF%97%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9CNo%20space%20left%20on%20device%E2%80%9D)
  * [创建用户时报错：“无效的用户名 [TEST1]”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E6%97%B6%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9C%E6%97%A0%E6%95%88%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%20\[TEST1\]%E2%80%9D)
  * [普通用户如何拥有关闭自己会话的权限](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E5%A6%82%E4%BD%95%E6%8B%A5%E6%9C%89%E5%85%B3%E9%97%AD%E8%87%AA%E5%B7%B1%E4%BC%9A%E8%AF%9D%E7%9A%84%E6%9D%83%E9%99%90)
  * [将表及其索引移动到其它表空间时报错](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%B0%86%E8%A1%A8%E5%8F%8A%E5%85%B6%E7%B4%A2%E5%BC%95%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%85%B6%E5%AE%83%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%97%B6%E6%8A%A5%E9%94%99)
  * [使用管理工具“编辑数据”功能按钮报错](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E4%BD%BF%E7%94%A8%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E2%80%9C%E7%BC%96%E8%BE%91%E6%95%B0%E6%8D%AE%E2%80%9D%E5%8A%9F%E8%83%BD%E6%8C%89%E9%92%AE%E6%8A%A5%E9%94%99)
  * [使用 DEM 默认加解密引擎对密码进行加密报错](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E4%BD%BF%E7%94%A8%20DEM%20%E9%BB%98%E8%AE%A4%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%BC%95%E6%93%8E%E5%AF%B9%E5%AF%86%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86%E6%8A%A5%E9%94%99)
  * [达梦数据库如何排查阻塞](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A6%82%E4%BD%95%E6%8E%92%E6%9F%A5%E9%98%BB%E5%A1%9E)
  * [如何仅收集新增分区的统计信息](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E4%BB%85%E6%94%B6%E9%9B%86%E6%96%B0%E5%A2%9E%E5%88%86%E5%8C%BA%E7%9A%84%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF)
  * [DEM 监控 DSC 集群，调用 dmcssm 监视器服务报错](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DEM%20%E7%9B%91%E6%8E%A7%20DSC%20%E9%9B%86%E7%BE%A4%EF%BC%8C%E8%B0%83%E7%94%A8%20dmcssm%20%E7%9B%91%E8%A7%86%E5%99%A8%E6%9C%8D%E5%8A%A1%E6%8A%A5%E9%94%99)
  * [CPU 使用异常，个别 CPU 使用率较高时，任有其他的 cpu 处于空闲状态](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#CPU%20%E4%BD%BF%E7%94%A8%E5%BC%82%E5%B8%B8%EF%BC%8C%E4%B8%AA%E5%88%AB%20CPU%20%E4%BD%BF%E7%94%A8%E7%8E%87%E8%BE%83%E9%AB%98%E6%97%B6%EF%BC%8C%E4%BB%BB%E6%9C%89%E5%85%B6%E4%BB%96%E7%9A%84%20cpu%20%E5%A4%84%E4%BA%8E%E7%A9%BA%E9%97%B2%E7%8A%B6%E6%80%81)
  * [如何查出所有存储过程的依赖关系](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E5%87%BA%E6%89%80%E6%9C%89%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%EF%BC%9F)
  * [如何清除 object_usage 视图中所有监控的索引信息](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%B8%85%E9%99%A4%20object_usage%20%E8%A7%86%E5%9B%BE%E4%B8%AD%E6%89%80%E6%9C%89%E7%9B%91%E6%8E%A7%E7%9A%84%E7%B4%A2%E5%BC%95%E4%BF%A1%E6%81%AF)
  * [如何设置命令行的前缀标识为用户名，IP，端口以及实例名](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%9A%84%E5%89%8D%E7%BC%80%E6%A0%87%E8%AF%86%E4%B8%BA%E7%94%A8%E6%88%B7%E5%90%8D%EF%BC%8CIP%EF%BC%8C%E7%AB%AF%E5%8F%A3%E4%BB%A5%E5%8F%8A%E5%AE%9E%E4%BE%8B%E5%90%8D)
  * [表中大字段占用的空间如何回收](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%A1%A8%E4%B8%AD%E5%A4%A7%E5%AD%97%E6%AE%B5%E5%8D%A0%E7%94%A8%E7%9A%84%E7%A9%BA%E9%97%B4%E5%A6%82%E4%BD%95%E5%9B%9E%E6%94%B6)
  * [ET 不显示结果](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#ET%20%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%BB%93%E6%9E%9C)
  * [扩容临时表空间报错：“超出数据库表空间数量限制，请检查 TS_MAX_ID 参数”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%89%A9%E5%AE%B9%E4%B8%B4%E6%97%B6%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9C%E8%B6%85%E5%87%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%95%B0%E9%87%8F%E9%99%90%E5%88%B6%EF%BC%8C%E8%AF%B7%E6%A3%80%E6%9F%A5%20TS_MAX_ID%20%E5%8F%82%E6%95%B0%E2%80%9D)
  * [客户端管理工具如何在消息框打印所有执行的内容](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%A6%82%E4%BD%95%E5%9C%A8%E6%B6%88%E6%81%AF%E6%A1%86%E6%89%93%E5%8D%B0%E6%89%80%E6%9C%89%E6%89%A7%E8%A1%8C%E7%9A%84%E5%86%85%E5%AE%B9)
  * [通过 dblink 向 oracle 端表插入 BLOB 字段数据时报错：​"字符不完整“](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E9%80%9A%E8%BF%87%20dblink%20%E5%90%91%20oracle%20%E7%AB%AF%E8%A1%A8%E6%8F%92%E5%85%A5%20BLOB%20%E5%AD%97%E6%AE%B5%E6%95%B0%E6%8D%AE%E6%97%B6%E6%8A%A5%E9%94%99%EF%BC%9A%22%E5%AD%97%E7%AC%A6%E4%B8%8D%E5%AE%8C%E6%95%B4%E2%80%9C)
  * [如何查询某个表的大字段空间占用大小](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E6%9F%90%E4%B8%AA%E8%A1%A8%E7%9A%84%E5%A4%A7%E5%AD%97%E6%AE%B5%E7%A9%BA%E9%97%B4%E5%8D%A0%E7%94%A8%E5%A4%A7%E5%B0%8F)
  * [如何通过 SQL 查看当前库中的作业状态是否启用](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%20SQL%20%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E5%BA%93%E4%B8%AD%E7%9A%84%E4%BD%9C%E4%B8%9A%E7%8A%B6%E6%80%81%E6%98%AF%E5%90%A6%E5%90%AF%E7%94%A8)
  * [如何查询分区子表的对象大小和占用空间](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E5%88%86%E5%8C%BA%E5%AD%90%E8%A1%A8%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%A4%A7%E5%B0%8F%E5%92%8C%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4)
  * [如何查看当前 DML 事务执行进度](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%20DML%20%E4%BA%8B%E5%8A%A1%E6%89%A7%E8%A1%8C%E8%BF%9B%E5%BA%A6)
  * [如何使图形化工具查询出来的数据不全是明文](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E4%BD%BF%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B7%A5%E5%85%B7%E6%9F%A5%E8%AF%A2%E5%87%BA%E6%9D%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%8D%E5%85%A8%E6%98%AF%E6%98%8E%E6%96%87)
  * [如何更换图形化工具 Mganger-DM 管理工具连接数据库的驱动](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E6%9B%B4%E6%8D%A2%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B7%A5%E5%85%B7%20Mganger-DM%20%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%A9%B1%E5%8A%A8)
  * [表空间文件达到上限后如何继续添加](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%A1%A8%E7%A9%BA%E9%97%B4%E6%96%87%E4%BB%B6%E8%BE%BE%E5%88%B0%E4%B8%8A%E9%99%90%E5%90%8E%E5%A6%82%E4%BD%95%E7%BB%A7%E7%BB%AD%E6%B7%BB%E5%8A%A0)
  * [重建系统包报错：“无效的过程/函数名”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E9%87%8D%E5%BB%BA%E7%B3%BB%E7%BB%9F%E5%8C%85%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9C%E6%97%A0%E6%95%88%E7%9A%84%E8%BF%87%E7%A8%8B/%E5%87%BD%E6%95%B0%E5%90%8D%E2%80%9D)
  * [docker 环境修改数据库参数报错：“磁盘空间不足”](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#docker%20%E7%8E%AF%E5%A2%83%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%82%E6%95%B0%E6%8A%A5%E9%94%99%EF%BC%9A%E2%80%9C%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3%E2%80%9D)
  * [归档路径的已用大小超出了归档配置的 arch_space_limit 大小](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%BD%92%E6%A1%A3%E8%B7%AF%E5%BE%84%E7%9A%84%E5%B7%B2%E7%94%A8%E5%A4%A7%E5%B0%8F%E8%B6%85%E5%87%BA%E4%BA%86%E5%BD%92%E6%A1%A3%E9%85%8D%E7%BD%AE%E7%9A%84%20arch_space_limit%20%E5%A4%A7%E5%B0%8F)
  * [DMDPC 集群怎么查询哪些列未启用压缩](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DMDPC%20%E9%9B%86%E7%BE%A4%E6%80%8E%E4%B9%88%E6%9F%A5%E8%AF%A2%E5%93%AA%E4%BA%9B%E5%88%97%E6%9C%AA%E5%90%AF%E7%94%A8%E5%8E%8B%E7%BC%A9)
  * [有哪些方法可以获取当前会话的事务 id？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B9%E6%B3%95%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E4%BC%9A%E8%AF%9D%E7%9A%84%E4%BA%8B%E5%8A%A1%20id%EF%BC%9F)
  * [DM 中创建表、索引，会修改哪些字典表？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#DM%20%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A1%A8%E3%80%81%E7%B4%A2%E5%BC%95%EF%BC%8C%E4%BC%9A%E4%BF%AE%E6%94%B9%E5%93%AA%E4%BA%9B%E5%AD%97%E5%85%B8%E8%A1%A8%EF%BC%9F)
  * [在 dmdpc 集群环境中，怎么查看用户默认表空间组？](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%9C%A8%20dmdpc%20%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E4%B8%AD%EF%BC%8C%E6%80%8E%E4%B9%88%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E9%BB%98%E8%AE%A4%E8%A1%A8%E7%A9%BA%E9%97%B4%E7%BB%84%EF%BC%9F)
  * [函数 REGEXP_LIKE 执行报错](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%87%BD%E6%95%B0%20REGEXP_LIKE%20%E6%89%A7%E8%A1%8C%E6%8A%A5%E9%94%99)
  * [达梦管理工具如何禁用 IPV6 登录数据库](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E8%BE%BE%E6%A2%A6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%A6%82%E4%BD%95%E7%A6%81%E7%94%A8%20IPV6%20%E7%99%BB%E5%BD%95%E6%95%B0%E6%8D%AE%E5%BA%93)
  * [如何配置可在任意目录下执行 disql 等命令](https://eco.dameng.com/document/dm/zh-cn/faq/faq-db-check.html#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E5%8F%AF%E5%9C%A8%E4%BB%BB%E6%84%8F%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%89%A7%E8%A1%8C%20disql%20%E7%AD%89%E5%91%BD%E4%BB%A4)



## 正文

可参考以下文章：

[DM 对 Oracle 兼容之 SQL 运维实战攻略上](http://eco.dameng.com/community/article/038c0aaa74f5745042374d8f66f2f196)

[DM 对 Oracle 兼容之 SQL 运维实战攻略下](http://eco.dameng.com/community/article/06da7dea733afece0275ef2ad8db7550)

## 动态级参数在 dm.ini 里修改后重启应用不生效吗

数据库的配置文件 dm.ini 中参数属性分为三种：静态、动态和手动。

  * 静态，可以被动态修改，修改后重启服务器才能生效;
  * 动态，可以被动态修改，修改后即时生效;
  * 手动，不能被动态修改，必须手动修改 dm.ini 参数文件，然后重启才能生效。



动态参数又分为会话级和系统级两种。会话级参数被修改后，新参数值只会影响新创建的会话，之前创建的会话不受影响；系统级参数的修改则会影响所有的会话。

## dmsql_数据库实例名.log，这个日志怎么关掉

以 dmsql_数据库实例名.log 类型命名的文件为跟踪日志文件，跟踪日志内容包含系统各会话执行的 SQL 语句、参数信息、错误信息等。跟踪日志主要用于分析错误和分析性能问题，比如，可以挑出系统现在执行速度较慢的 SQL 语句，进而对其进行优化。

打开跟踪日志对系统的性能有较大影响，一般用于查错和调优的时候才会打开，默认情况下系统是关闭跟踪日志的。当把 dm.ini 参数 SVR_LOG 设置为 1，才会打开 SQL 日志，若需要跟踪日志但对日志的实时性没有严格的要求，又希望系统有较高的效率，可以设置参数 SQL_TRACE_MASK 和 SVR_LOG_MIN_EXEC_TIME 只记录关注的相关记录。

在记录完成后，可执行: SP_SET_PARA_VALUE(1, 'SVR_LOG', 0); 进行关闭跟踪日志。

更多配置文件 dm.ini 中各参数的含义可查看《DM 系统管理员手册》第二章 2.1 节内容，手册位于数据库安装路径 `/dmdbms/doc` 文件夹。

## 如何查看数据库初始化信息，如页大小，簇大小，字符集和大小写敏感等

达梦数据库提供了多种方法查看数据库实例的初始化信息，以下给出详细使用方式：

【方法 1】：

进入数据库实例初始化路径，查看初始化日志 dminit***.log 文件

![初始化实例日志](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-028.png)

【方法 2】：

打开 DM 管理工具，右键选择数据库---管理服务器---查看系统概览

![管理服务器](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-029.png)

![系统概述](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-030.png)

【方法 3】：

利用 SQL 语句进行查询，语句参考如下：

查询大小写是否敏感：

```
SELECT SF_GET_CASE_SENSITIVE_FLAG();
或
SELECT CASE_SENSITIVE();
```

查询页大小：

```
SELECT SF_GET_PAGE_SIZE();  /* 32768/1024=32KB */
或
SELECT CAST(PAGE()/1024 AS VARCHAR);
```

查询簇大小：

```
SELECT SF_GET_EXTENT_SIZE();  
```

查询字符集：

```
SELECT SF_GET_UNICODE_FLAG();
或
SELECT unicode();
或
SELECT (CASE SF_GET_UNICODE_FLAG() WHEN '0' THEN 'GBK18030' WHEN '1' THEN 'UTF-8' WHEN '2' THEN 'EUC-KR' END);
```

## DM 数据库管理常用 SQL 命令

```
--查询数据库版本
select * from  v$version;--DM7
select id_code();--DM8

--查询授权信息
select * from  v$license;

--查询服务器信息
select * from  V$SYSTEMINFO;

--查询会话连接信息
select * from  v$sessions;

select  count(*),state from v$sessions group by state;
select  count(*),clnt_ip from v$sessions group by clnt_ip;

--查看数据库服务器配置参数

select * from  v$dm_ini;

--查询最近的 sql 执行记录
select * from  v$sql_history;

--查询某个用户下所有的表
select * from  user_tables; --查询当前用户下所有的表

select * from  all_tables where owner='TEST'; --dba 用户查询某个模式下的所有表

--查询某个用户下所有表字段
select * from  all_tab_cols where owner='TEST';

--查看表注释
select * from  ALL_TAB_COMMENTS where owner='TEST';

--查看字段注释
select * from  ALL_COL_COMMENTS where owner='TEST';

select '实例名称' 数据库选项,INSTANCE_NAME 数据库集群相关参数值 FROM v$instance union all

select '数据库版本',substr(svr_version,instr(svr_version,'(')) FROM v$instance union all   SELECT '字符集',CASE SF_GET_UNICODE_FLAG() WHEN '0' THEN 'GBK18030' WHEN '1' then 'UTF-8' when '2' then 'EUC-KR' end union all

SELECT '页大小',cast(PAGE()/1024 as varchar) union all   SELECT '簇大小',cast(SF_GET_EXTENT_SIZE() as varchar) union all

SELECT '大小写敏感',cast(SF_GET_CASE_SENSITIVE_FLAG() as varchar) union all

select '数据库模式',MODE$ from v$instance union all

select '唯一魔数',cast(permanent_magic as varchar) union all

select 'LSN',cast(cur_lsn as varchar) from v$rlog;
```

## 报错日志、系统日志

达梦数据库有相应的错误日志，存放在达梦数据库安装目录的 log 文件目录下，会有相应对应的实例名日期 .log 文件，打开相应的文件，如果里面有 ERROR 的错误信息，则可以查看具体的报错来进行修改。

## DM 内存泄漏/异常的检查

DM 运行过程中，如果发现内存突然飙升，或者占用过大， 或者操作系统反复 OOM 时，需要考虑是否是服务器存在内存泄漏问题，按照目前 DM7 的动态视图所能提供的信息，需要获取以下内容：

  1. 数据库的内存使用情况；
  2. 是否存在扩展到非常大的内存池；
  3. 确认该内存的详细使用情况。



### 数据库的内存使用情况

操作系统级别的命令判断：TOP、WINDOWS 资源管理器等，查看数据占用多少内存

数据库级别的判断：数据库使用的内存大致等于 BUFFER_SIZE + POOL_SIZE，对应的 SQL 语句如下：

```
select (select sum(n_pages * page_size) from v$bufferpool) + (select sum(total_size) from v$mem_pool) from dual;
```

一般来说，发生内存泄漏的都在 mem_pool 上，比如操作系统上看到内存占用 60G，但 BUFFER 已经占用到 50 GB，实际上发生泄漏的概率较小，应该适当调小 BUF，空出内存给内存池使用。

### 是否存在使用内存过多的 SQL

较新版本的 DM7 服务器提供会话及语句资源监控视图（ENABLE_MONITOR=1) 生效 v$SESSION_STAT，V$SQL_STAT 视图上字段比较丰富，我们这里主要关注 MAX_MEM_USED 字段。 一般来讲，如果是某条或者特定的几条 SQL 导致内存增长过多，可以通过这两个视图查询出来。

通过执行以下语句：

```
SELECT MAX_MEM_USED,SQL_TXT FROM V$SQL_STAT order by MAX_MEM_USED DESC;
```

可以确定使用内存较大的 SQL，可以针对行的优化（消除 HASH,SORT,DISTINCT 等) 注意：该查询只能查询当前活动 STMT 上的语句消耗情况，历史情况需要查询 V$SQL_STAT_HISTORY，该视图上保留 1 万行 SQLSTAT 历史信息。

以上 MAX_MEM_USED 列的单位均为 KB。

### 是否存在扩展过大的内存池

前面介绍过，正常使用过程中，内存池的大小一般会维持在 TARGET_SIZE 左右，不会发生太大的差距，如果发生非常多次计划外的扩展，需要考虑该池是否发生内存泄漏，与之相关的系统视图和系统视图字段为：v$mem_pool 上的 N_EXTEND_EXCLUSIVE 字段。

相应的查询语句为如下：

```
Select * from v$mem_pool where n_extend_exclusive = 0;
```

确认池后，通过 MEM_POOL 的 CREATOR 也就是创建这个池的线程号，去 V$SESSIONS 或者 V$SESSIONS_HISTORY 里面确认会话号，然后再去 V$SQL_STAT_HISTORY 或者 V$SESSION_STAT_HISTORY 中寻找内存消耗大的 SQL 即可。

查看存在超出计划大小扩展的内存池的计划外扩展次数以及大小，如果池大小为可 以通过 INI 调整的（如 VM_POOL_TARGET、SESS_POOL_TARGET，但这两个参数慎用，调整过大对并发影响较大），可以适当放大计划大小，再运行观察计划外扩展情况是否有改善，如果仍然存在大量的计划外扩展则需要继续跟进内存使用实况。

### 确认内存的详细使用情况

详细的内存使用情况需要视图 v$mem_reginfo，该视图在 INI 参数 MEM_LEAK_CHECK 为 1 时有效，可动态开启，开启后登记数据库中所有内存的申请释放信息。

相应的查询语句如下：

```
Select sum(reserved_size),fname,lineno from v$mem_reginfo group by fname,lineno order by sum(reserved_size) desc;
```

按照大小降序，或者根据文件名、行号分组，查看是否存在大量某文件某行使用内存未释放的情况，转交研发处理。

### 内存异常的检查

DM 提供自动的内存异常检查，检查参数为 INI 中的 MEMORY_MAGIC_CHECK，默认值为 2 大致的检查原理如下：

在每次申请内存时，返回的内存块中包含，返回内存的管理结构大小 + 申请长度 + 一个 ULINT_SIZE 大小的内存块 其中首部用于存放管理这块内存结构的结构，实际使用的内存为第二段，最后一段填入一个校验码。

校验码为一个固定魔术和该内存管理结构的首地址计算出来的一个常数。每当需要释放内存时，如果 MEMORY_MAGIC_CHECK 为 1 则会根据需要释放内存的地址计算出一个校验码，与该内存结构尾部的校验码比较，若不相等，则说明该片内存可能出现过写溢出，数据库会 HALT 掉。

如果 MEMORY_MAGIC_CHECK 配置为 2 则会在 1 的检查基础上，由于申请内存长度可能是大于需求长度的（因为申请时要求申请大小为 2 的 N 次幂，会在大于需求长度后面的每一位上都添加上特殊校验码，释放时每一位都回检查，检查失败也会 HALT。

如果实际生产中发现 CHECK 为 2 比较慢，则可以将 MAGIC_CHECK 改为 1。

## 扩展数据库的 REDO 日志

调整数据库 REDO 日志的大小，如将 2 个 REDO 日志都扩展到 2G （注意 REDO 日志的实际路径）。

使用 SYSDBA 用户登录，然后执行如下脚本：

```
alter database resize logfile 'D:\dmdbms\data\DAMENG\DAMENG01.log' to 2048;
alter database resize logfile 'D:\dmdbms\data\DAMENG\DAMENG02.log' to 2048;
```

## DEM 工具及使用方法示例

DEM 工具存放在数据库安装目录 dmdbms 下的 web 文件夹中。

![web 目录](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-002.jpg)

DEM 配置示例（以 Windows 为例）

Jdk 目录：

![JDK 目录](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-003.jpg)

Tomact 目录：

![Tomcat 目录](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-004.jpg)

DEM 目录：

![DEM 目录](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-005.jpg)

Dmagent 目录：

![Dmagent 目录](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-006.jpg)

配置环境变量：

![用户变量-java](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-007.jpg)

![用户变量-tomcat](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-008.jpg)

![系统变量 path](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-009.jpg)

![系统变量 path](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-010.jpg)

cmd 启动 tomcat(E:\tomcat\bin\startup.bat)，会自动将 dem 解压到相同目录下：

![启动 tomcat](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-011.jpg)

在数据库中新建 DEM 用户，并用 DEM 用户执行 dem_init.sql 脚本 (E:\dmdbms\web\dem_init.sql)。

![执行 sql 脚本](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-012.jpg)

更改 db.xml (E:\tomcat\webapps\dem\WEB-INF\db.xml) 中 dem 监控连接后台数据库的 ip/账号/密码/端口号：

![修改配置文件](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-013.jpg)

在 server.xml(E:\tomcat\conf\server.xml)的 host 节点中补全以下内容：

![修改 host 文件](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-014.jpg)

在 catalina.bat(E:\tomcat\bin\catalina.bat) 的最后添加以下内容：

```
set java_opts= -server -Xms40m -Xmx1024m -XX:MaxPermSize=512m -Djava.library.path=d:\dmdbms\bin;
```

![修改 bat 文件](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-015.jpg)

启动 tomcat 服务，并启动 DEM ([http://127.0.0.1:8080/dem](http://127.0.0.1:8080/dem))，账号/密码：admin/888888

![界面展示](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-016.jpg)

## MANAGER 如何查看数据库配置信息

DM 管理工具 MANAGER，在登录以后，可以选中导航菜单中的顶层连接，右键-管理服务器打开管理服务器窗口，系统概览里面展示的是数据库配置信息。

![管理工具](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-017.jpg)

![管理服务器](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-018.jpg)

## MANAGER 查看外键

在模式中找到对应的模式，点开表，找到你想要查看的表，点开【键】。

![外键](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-019.png)

如图片所示就是需要查看的外键信息，如果想要继续查看具体的信息，右键点击【外键】，选择自己需要查看的选项。

## 控制台工具查看试用截止日期

下图是 DM 控制台工具查看不到试用截止日期。

![控制台工具](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-020.jpg)

【解决方法】：

通过管理工具登陆数据库执行 `select * from SYS."V$LICENSE";` 语句即可查找出有效时间。

![执行结果](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-021.jpg)

V$license 字段信息可在《DM 系统管理员手册》中查找，手册位于数据库安装路径 `/dmdbms/doc` 文件夹。。

## 数据库完整性校验

达梦数据库提供了 dmdbchk 工具用于检查数据库完整性、正确性的命令行工具。在服务器正常关闭后的脱机情况下，用户可以使用 dmdbchk 对数据库进行校验，包括校验 DM 数据库内部的物理存储结构是否正常，对象信息是否合法等。

检验的内容具体包括三方面：

  1. 数据文件合法性检验  
数据文件校验只校验数据文件大小。如果数据库文件实际大小大于或等于文件头中记录的大小，则合法。

  2. 索引正确性校验  
索引检验包括：普通表 B 树索引校验、LIST 表扁平 B 树索引校验、列存储表索引校验。校验内容具体包括：B
树的层次、层次关系，每层的内部页、叶子页以及页之间的前后链接关系，每个页的页头信息（如页类型等)等。

  3. 对象 ID 合法性校验  
对象 ID 校验包括数据库内的所有对象的 ID 检验。对象包括：索引、表、约束、存储过程、模式、同义词、用户等。如果从系统表中查出的对象 ID 小于库的
ID 预留页中记录的该类型对象的下一分配 ID，则合法。因为库的 ID 预留页中记录的是各类型对象下一个新分配对象将使用的 ID，因此若系统表中的对象 ID
大于或等于该 ID，说明库已损坏。



以下提供数据库完整性校验方法。

具体步骤：

  1. 数据库服务正常关闭
  2. 在数据库软件安装目录 bin 下执行以下命令进行完整性检查：



```
 ./dmdbchk path=/dm8/bin/TEST/dm.ini
```

校验后的报告存在 dmdbchk 工具所在的目录中，名称为 dbchk_err.txt，检查报告如下：

```
/**一 dmdbchk  版本信息**/
[2022-12-01 16:28:46] dmdbchk V8

[2022-12-01 16:28:46] file dm.key not found, use default license!
/**二 开始标志 **/
[2022-12-01 16:28:47] DM DB CHECK START......

/**三 数据文件校验结果 **/
[2022-12-01 16:28:47] --------check dbf file size start---------

[2022-12-01 16:28:47] FILE=(ts_id=0, fil_id=0, path=/dm8/bin/TEST/SYSTEM.DBF)
[2022-12-01 16:28:47] FILE=(ts_id=1, fil_id=0, path=/dm8/bin/TEST/ROLL.DBF)
[2022-12-01 16:28:47] FILE=(ts_id=4, fil_id=0, path=/dm8/bin/TEST/MAIN.DBF)
[2022-12-01 16:28:47] FILE=(ts_id=6, fil_id=0, path=/dm8/bin/TEST/DEM.DBF)
[2022-12-01 16:28:47] --------check dbf file size end-----------

/**四 索引校验结果 **/
[2022-12-01 16:28:47] --------check indexes start---------------

[2022-12-01 16:28:47] INDEX=(id=33554433, name=SYSINDEXCOLUMNS, table_name=SYSCOLUMNS)
[2022-12-01 16:28:47] INDEX=(id=33554434, name=SYSINDEXINDEXES, table_name=SYSINDEXES)
[2022-12-01 16:28:47] INDEX=(id=33554440, name=SYSINDEXTUSERS, table_name=SYSUSER$)
[2022-12-01 16:28:47] INDEX=(id=33554442, name=SYSINDEXSYSGRANTS, table_name=SYSGRANTS)
[2022-12-01 16:28:47] INDEX=(id=33554452, name=SYSINDEXCONSTRAINTS, table_name=SYSCONS)
[2022-12-01 16:28:47] INDEX=(id=33554458, name=SYSINDEXSYSAUDIT, table_name=SYSAUDIT)
[2022-12-01 16:28:47] INDEX=(id=33554459, name=SYSINDEXSYSAUDITSQLSEQ, table_name=SYSAUDITSQLSEQ)
[2022-12-01 16:28:47] INDEX=(id=33554464, name=SYSINDEXCONTEXTINDEXES, table_name=SYSCONTEXTINDEXES)
[2022-12-01 16:28:47] INDEX=(id=33554468, name=SYSINDEXSTATS, table_name=SYSSTATS)
.........
[2022-12-01 16:28:47] INDEX=(id=33556897, name=INDEX33556897, table_name=DBTOOL_DTE_ESTIMATE_RESULT)
[2022-12-01 16:28:47] INDEX=(id=33556899, name=INDEX33556899, table_name=DMA_MAINFRAME_CORE)
[2022-12-01 16:28:47] INDEX=(id=33556900, name=INDEX33556900, table_name=DMA_MAINFRAME_CORE)
[2022-12-01 16:28:47] INDEX=(id=33556901, name=INDEX_DMA_MF_CORE, table_name=DMA_MAINFRAME_CORE)
[2022-12-01 16:28:47] INDEX=(id=33556902, name=INDEX33556902, table_name=DMA_MAINFRAME_CORE_HISTORY)
[2022-12-01 16:28:47] INDEX=(id=33556903, name=INDEX33556903, table_name=DMA_MAINFRAME_CORE_HISTORY)
[2022-12-01 16:28:47] INDEX=(id=33556904, name=INDEX_DMA_MF_CORE_HISTORY, table_name=DMA_MAINFRAME_CORE_HISTORY)
[2022-12-01 16:28:47] --------check indexes end-----------------

/**五 对象ID校验结果 **/
[2022-12-01 16:28:47] --------check iid start-------------------

[2022-12-01 16:28:47] check cons id ...
[2022-12-01 16:28:47] check index id ...
[2022-12-01 16:28:47] check table id ...
[2022-12-01 16:28:47] check proc id ...
[2022-12-01 16:28:47] check schema id ...
[2022-12-01 16:28:47] check synonym id ...
[2022-12-01 16:28:47] check user id ...
[2022-12-01 16:28:47] --------check iid end---------------------

/**六 结束标志 **/
[2022-12-01 16:28:47] DM DB CHECK END......
/**七 错误总数 **/
[2022-12-01 16:28:47] error count is 0

```

还可以通过 CHECK_INDEX() 和 CHECK_DB_INDEX()两个系统函数检查索引的合法性。

  1. CHECK_INDEX()：检查一个索引的合法性。检查过程中，会使用 S+IX 锁来封锁索引对应的表对象。
  2. CHECK_DB_INDEX()：检查数据库中所有索引的合法性。检查过程中，会使用 S+IX 锁来封锁索引对应的表对象。
  3. 返回值：0：表示不合法；1：表示合法；2：表示存在未校验的索引。



例如：

通过 CHECK_INDEX() 检查单个索引合法性：

  1. 查询系统表获取索引 ID



```
select name,id from sysobjects where name='TEST_IDX' and subtype$='INDEX';
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221211154447N4U7B41A52WL1HN51S)

  2. 检查此索引合法性：



```
select CHECK_INDEX ('SYSDBA',33556908);
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221211154707881BIIWM099KDW3ZT8)

通过 CHECK_DB_INDEX() 检查所有索引合法性：

```
SELECT CHECK_DB_INDEX ();
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202212111548169BP6HXJYVUGTAFAWBM)

> **注意**
>
> dmdbchk 并不能检查出用户实际数据的正确性，如果数据文件被手动人为修改，正好修改到的是用户数据部分，是检查不出来的。



## 达梦数据库校验工具的使用

达梦数据库校验需要在数据库服务正常关闭后进行，进入数据库程序目录 bin 下，输入 ./dmdbchk path=dm.ini 路径，例如数据文件目录为 /opt/dmdbms/data，则应该输入 `./dmdbchk path=/opt/dmdbms/data/DAMENG/dm.ini`，校验完毕后，dmdbchk 会在当前目录下（dmdbchk 所在目录）生成一个名为 dbchk_err.txt 的检查报告，供用户查看。

具体使用和解析请查看《DM_dmdbchk 使用手册》，手册位于数据库安装路径 `/dmdbms/doc/special` 文件夹。。

## 字符串比较大小写敏感

关于字符串比较大小写敏感主要涉及到两个方面的内容：

### 对字段的值比较而言

假如表 Test 中有如下两条记录
c1   c2
1     a
2     A

同样的查询语句：

```
select * from Test where c2 = 'a';
```

在大小写不敏感的库中会查出如下的两条记录
c1   c2
1     a
2     A

而在大小写敏感的库中则只会查出如下的一条记录
C1   C2
1     a

### 对于表名、字段名而言

在设置为大小写敏感的库中进行查询的时候，可能经常会遇到无效的表名或列名的问题，

下面针对这种情况进行说明。

  * 如果使用 DM 管理工具图形界面建表的话建议表名和字段名都使用大写。因为使用图形界面建表相当于使用语句建表的时候加了双引号的，会固定住大小写。如果写成小写，那么就是小写了，在查询的时候也需要加双引号，否则就有可能报无效的表名或列名的问题，比较麻烦；
  * 如果使用脚本建表的话，如果表名和字段名没有加双引号的话都会被系统自动转换成大写。



如：`create table test(a int)；` 系统会自动把表名 test，字段名 a 转换成大写，处理方式与 Oracle 数据库一致。所以针对大小写敏感的库，在使用建表脚本或者通过查询脚本进行查询的时候建议统一不要写双引号，让系统统一自动都转化为大写；

  * 以上两点主要针对大小写敏感的库而言，大小写不敏感的库则不存在上述问题。



总结：基于以上两点，在初始化数据库的过程中就可以对字符串比较大小写敏感这个参数做出合理的选择了。参考链接：[详解 DM 数据库字符串大小写敏感](http://eco.dameng.com/community/article/df11811a02de8e923c2e57ef6597bc62)

## 查询达梦关键字列表/保留字

【问题描述】：

如何达梦关键字列表/保留字？如何屏蔽保留字/关键字？

【解决方法】：

达梦的关键字/保留字可以在《DM SQL 语言使用手册》附录 1 中查询，手册位于数据库安装路径 `/dmdbms/doc` 文件夹。

下面是处理表语句和关键字或者保留字冲突的方法：

### 双引号法

这个一般可以用来处理建表语句中的保留字冲突，如表名或者字段名是 DM 的保留字。这种方法一般可以快速地绕过问题，但是对于大小写敏感的库，这种用双引号的方法会固定死字段大小写，对于小写的字段，可能会带来无效的表名或者列名的问题。

### dm.ini 中的参数设置

在 dm.ini 中有个参数 EXCLUDE_RESERVED_WORDS，这个参数可以用来屏蔽你想要屏蔽的保留字，将需要屏蔽的保留字写在 = 号后面，然后以逗号分隔。设置在 dm.ini 中的好处就是一旦设置，永久生效而且对所有客户端都有效，这样就不需要在所有客户端系统中进行专门配置。但是设置在 dm.ini 中之后，这个保留字就永久性失效了，哪怕你想通过 Manager 客户端工具在本地连接也没用了。而且该方式还存在一个隐患就是由于屏蔽掉了一些系统的保留字，所以可能会导致系统的一些功能无法正常使用。

不建议用这个参数，会有严重的副作用，并且比较隐蔽；在不改表的字段的情况下，最好的方案是改名字，次之给对象名加双引号。

> **建议**
>
> 在移植过程中遇到 DM 的保留字，最好的处理方式还是对这些保留字进行修改，尽量不要使用 DM 的保留字。



## [-5567]授权者没有此授权权限

【问题描述】：

创建用户后，给用户赋予系统权限 Any 的时候报错：错误号: -5567
错误消息: 第 1 行附近出现错误:
授权者没有此授权权限

【解决方法】：

方法 1：在 dm.ini 文件中修改参数 ENABLE_DDL_ANY_PRIV 为 1。
方法 2： 通过以下语句修改参数 ENABLE_DDL_ANY_PRIV。

```
sp_set_para_value(1,'ENABLE_DDL_ANY_PRIV',1);
或者
alter SYSTEM set 'ENABLE_DDL_ANY_PRIV'=1 both; 
```

> **注意**
>
> 考虑到参数的特殊性，在部分版本数据库的 dm.ini 文件中，没有放入参数 ENABLE_DDL_ANY_PRIV，但用户可通过调用系统过程（方法
> 2）进行参数值的设置。



## 报错：多版本操作冲突过多 或 Too many mvcc conflict

【问题描述】：

MVCC 多版本并发控制是指维持一个数据的多个版本，在保证事务隔离级的情况下，使得读写操作没有冲突，

提高了数据库并发读写的性能。因此可以解决在并发读写数据库时，做到在读操作时不用阻塞写操作，写操作

也不用阻塞读操作。当对一张表批量修改且并发量较大时，可能会报 MVCC 多版本操作冲突过多的错误。

多会话同时修改表数据时报错：Too many mvcc conflict。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20220831114602CEEA5ZGFPNJ63NTJ0R)

修改数据库 dm.ini 文件中静态参数 MVCC_RETRY_TIMES 和 BDTA_SIZE，重启数据库。

修改 MVCC_RETRY_TIMES 参数值为 100，重启数据库。

```
alter system set 'MVCC_RETRY_TIMES'=100 spfile;
```

重启后按同样语句进行测试，观察每个会话下的运行结果均正常，未发生 MVCC 多版本并发冲突错误。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/2022083111463389FJJ10U1VF8ACPNJ2)

参数说明：

MVCC_RETRY_TIMES 参数越大，发生 MVCC 冲突时的最大重试次数越多，报错可能性越低；

BDTA_SIZE 参数越大，批量数据处理大小（ BDTA 的大小）越大，报错可能性越大。

|**参数名**|**默认值**|**属性**|**说明**|
|---|---|---|---|
|MVCC_RETRY_TIMES|5|静态|指定发生 MVCC 冲突时的最大重试次数。有效值范围(1~4294967294)注：MPP 下此参数无效，发生 MVCC 冲突时将直接报错|
|BDTA_SIZE|1000|静态|BDTA 缓存的记录数。有效值范围（1~10000）|


> **注意**
>
> 在实际业务场景中，同一时刻并发执行修改同一条数据会导致此报错，建议分析确认应用中同一时刻不同事务修改同一条数的业务合理性。达梦中控制并发冲突次数的参数为
> “MVCC_RETRY_TIMES”，默认为
> 5，该参数可从一定程度上缓解冲突的概率，但该错误信息不是并发操作触发锁机制控制锁等待，而是同一时刻不同的事务修改同一条数据导致，故要综合评估业务逻辑的合理性来进行解决。



## [-2148]:标记不匹配

  1. 将配置文件 dm.ini 里面的参数 ENABLE_ENCRYPT=1 改成 0
  2. 检查数据库服务器版本/客户端版本 /dm.key 版本。若企业版数据库使用了安全版的 key 文件或者相反，也会报这个错误。



## 达梦数据库开启日志

  * 开启 SQL 日志：\`SP_SET_PARA_VALUE(1, ‘SVR_LOG’, 1);\`
  * 关闭 SQL 日志：\`SP_SET_PARA_VALUE(1, ‘SVR_LOG’, 0);\`



需要配置文件：sqllog.ini

可参考《DM 数据库管理手册》，手册位于数据库安装路径 `/dmdbms/doc` 文件夹。

> **注意**
>
> 记得关闭或者配置日志文件大小限制，不然磁盘会撑爆。



## 修改数据库实例的字符集

字符集设置是在初始化实例的时候设置的，一旦设置完成就不能修改，只能重新初始化实例。

## 修改数据库实例的端口号

修改 dm.ini 中的 port_num，需要重启数据库。

## 删除模式报错

删除模式的时候报错：试图删除用户[****]的默认模式

通常一个用户对应一个模式；要删除用户的同名模式，需要级联删除，或者直接删除对应用户。

## 达梦错误码汇总

可以使用以下语句进行查询

```
select * from v$err_info;
```

也可以查看《DM 程序员手册》附录 1 错误码汇编，手册位于数据库安装路径 `/dmdbms/doc` 文件夹。

## 空间数据类型

【问题描述】：

达梦数据库之间支持空间数据库的迁移/空间/地理空间 /GEOMETRY/ 几何类型 查询吗？

【解决方法】：

支持，请参考《DM 系统包使用手册》DMGEO 包章节”，手册位于数据库安装路径 `/dmdbms/doc/special` 文件夹下。

## 如何查询数据库版本

【问题描述】：

如何查询当前使用的达梦数据库版本。

【解决方法】：

可以执行一下命令获取信息：

```
select * from v$version;
```

## 设置插入空字符串，在数据库里存 NULL

修改设置 dm.ini 的参数 compatible_mode=2，Oracle 没有空串这个概念，所以‘’和 null 都是显示 null 。

注意修改完之后需要重启数据库。

> **建议**
>
> 建议写个触发器，把空串转成 NULL 再插入，compatible_mode 设成 2 可能产生其它影响。



## 无法比较的数据类型

【问题描述】：

在使用 Union 连接的时候，报错 error:无法比较的数据类型

【解决方法】：

检查是否有 clob/blob/TEXT 类型，如果有是要去重，对 clob/blob/text 类型不能去重。

> **建议**
>
> 如果数据用 varchar 能存储的话，就重建表，将数据类型改成 varchar。



如果因为多个数据库组合，一定要用 Union 来合并的话，可以试试 union all，但是不去重。在其它操作符，例如 order by 时，也可能报相同错误，解决方法类似。

## 查询所有表的字段，注释、类型、类型长度等

【问题描述】：

如何查询在达梦某个库中存在某个字段的所有表？字段，注释、类型、类型长度？达梦怎么通过字段注释找到表？

【解决方法】：

查询 user_tab_columns、dba_tab_columns 视图。相应视图的字段，可以在“DM 系统管理员手册“附录里面查看。

## DMSBT 接口版本号与数据库服务器不匹配

【问题描述】：

  * 执行下面语句



```
SQL> backup database full backupset '/home/dmdba/baktest/DMSERVER_BAK_09_10_2020_FULL' device type tape;
backup database full backupset '/home/dmdba/baktest/DMSERVER_BAK_09_10_2020_FULL' device type tape;
```

报错：[-10033]:DMSBT 接口版本号与数据库服务器不匹配.

  * 设置跟踪日志文件,查看追踪日志里面内容是空的



```
服务器[LOCALHOST:5236]:处于普通打开状态
登录使用时间: 10.717(毫秒)
SQL> backup database full backupset '/home/dmdba/baktest/DMSERVER_BAK_09_10_2020_FULL' device type tape TRACE FILE '/home/dmdba/baktest/DMSERVER_BAK_trace.log' TRACE LEVEL 2;
backup database full backupset '/home/dmdba/baktest/DMSERVER_BAK_09_10_2020_FULL' device type tape TRACE FILE '/home/dmdba/baktest/DMSERVER_BAK_trace.log' TRACE LEVEL 2;
[-10033]:DMSBT接口版本号与数据库服务器不匹配.
已用时间: 00:00:01.004. 执行号:0.
```

【解决方法】：

检查服务器上是否安装了多套不同版本的 DM 数据库。检查目前启动的 dmap 服务和当前的 dmserver 服务的版本是否相同，是否使用同样的用户启动的。

## 执行查询返回错误[-7120]:回滚记录版本太旧无法获取用户记录

【解决方法】：

  * 方法一：修改 dm.ini 中的 undo_retention=1800 ，然后重启数据库；
  * 方法二：动态调整参数 UNDO_RETENTION 值为 1800，该参数为 double 类型使用如下函数动态修改： 
    
        SP_SET_PARA_DOUBLE_VALUE(1,'UNDO_RETENTION',1800);
    

  * 方法三：SQL 执行时，涉及到的数据被其他人修改了，所以会这样，建议停应用或者找个没人用的时候再迁移。



备注: UNDO_RETENTION 单位为秒，建议后续改回默认参数。

## 查看数据库的到期时间

可以执行以下 SQL 语句:

```
select　*　from　v$license;
```

查看 expired_date 列的信息。

## 自增列不允许修改

自增列一旦生成，无法更新，也不允许用 UPDATE 语句进行修改。

可以参考《DM SQL 语言使用手册》--5.6 DM 自增列的使用，手册位于数据库安装路径 `/dmdbms/doc` 文件夹。

## 如何收集统计信息

```
/* 收集整个库的统计信息 */
CALL SP_DB_STAT_INIT ();
DBMS_STATS.GATHER_SCHEMA_STATS('用户名',100,TRUE,'FOR ALL COLUMNS SIZE AUTO');

/* 统计用户下所有索引 */
DBMS_STATS.GATHER_SCHEMA_STATS('用户名',1.0,TRUE,'FOR ALL INDEXED SIZE AUTO');

/* 统计用户下所有字段 */
DBMS_STATS.GATHER_SCHEMA_STATS('用户名',100,TRUE,'FOR ALL COLUMNS SIZE AUTO');

/* 统计用户下某表 */
DBMS_STATS.GATHER_TABLE_STATS('用户名','表名',NULL,100,TRUE,'FOR ALL COLUMNS SIZE AUTO');

```

## 获取某个模式下某表的存储大小

有两种方式：

  * 使用管理工具，选择表右键属性；
  * 可以使用下列语句查询，TEST 为表名。



```
SELECT TABLE_USED_SPACE('SYSDBA','TEST')*page()/1024/1024.0  FROM dual;
SELECT segment_name AS TABLENAME,
       BYTES B,
       BYTES / 1024 KB,
       BYTES / 1024 / 1024 MB
  FROM user_segments
WHERE segment_name = upper('TEST');
```

## 扩展数据库的重做日志

调整数据库 REDO 日志的大小，比如将 2 个 REDO 日志都扩展到 2 GB，注意 REDO 日志的实际路径。
使用 SYSDBA 用户登录，然后执行如下脚本：

```
alter database resize logfile 'D:\dmdbms\data\DAMENG\DAMENG01.log' to 2048;
alter database resize logfile 'D:\dmdbms\data\DAMENG\DAMENG02.log' to 2048;
```

## 达梦数据库怎么开启审计功能

在 DM 系统中，专门为审计设置了开关，要使用审计功能首先要打开审计开关。审计开关由过程 VOID SP_SET_ENABLE_AUDIT（param int）; 控制，过程执行完后会立即生效，param 有三种取值：

  * 0：关闭审计
  * 1：打开普通审计
  * 2：打开普通审计和实时审计



缺省值为 0。

例，打开普通审计开关，需要使用 SYSAUDITOR 用户登录，执行：SP_SET_ENABLE_AUDIT (1);

## 怎样修改“LENGTH_IN_CHAR(长度是否以字符为单位)”

“LENGTH_IN_CHAR(长度是否以字符为单位)”一旦设置好，就无法修改。如需修改，则需要重新初始化数据库实例。

## logmnr_contents 视图中，哪些字段表示用户的主机名和用户的 IP

如果想要查看用户的主机名和用户的 IP 等信息，可以查看 V$SESSION 动态视图：

```
SELECT CLNT_HOST,CLNT_IP,OSNAME FROM V$SESSIONS;
```

## 查询 SQL 执行记录

可以执行下面语句进行查询：

```
SELECT * FROM V$SQL_HISTORY;
```

SQL 执行历史存放数据有限，若有需要，可以开启 DEM 监控，具体部署方法请参考 [DEM 部署](https://eco.dameng.com/document/dm/zh-cn/ops/tool-monitor.html#2.4%20DEM%20%E9%83%A8%E7%BD%B2)。

## 报错：reached the max session limit

需要调整 max_session 参数，数值调大一点，可以参考以下设置：

```
SP_SET_PARA_VALUE(2,'MAX_SESSIONS', 1000);
SP_SET_PARA_VALUE(2,'MAX_SESSION_STATEMENT', 20000);
```

## 查询当前模式下有那些表的 SQL 语句

```
SELECT TABLE_NAME FROM DBA_TABLES WHERE OWNER='模式名';
```

> **建议**
>
> 可以参考《DM 系统管理员手册》附录-兼容 Oracle 视图章节，查看更多动态视图信息，手册位于**数据库安装路径** \`/dmdbms/doc\`
> 文件夹。



## 如何查出某个用户下的某个数据库的所有表名

```
select NAME from sysobjects where "SUBTYPE$"='UTAB'
AND SCHID=(SELECT ID FROM sysobjects WHERE NAME='USER01' AND TYPE$='SCH');
--查询用户为 USER01 的 USER01模式下所有表名
```

> **建议**
>
> 可以参考《DM 系统管理员手册》，查看更多动态视图信息，手册位于数据库安装路径下 doc 文件夹。



## 如何查看建库时的字符集

执行以下语句：

```
select unicode();
--根据返回值进行判断
--0 表示 GB18030，1 表示 UTF-8，2 表示 EUC-KR
```

## 是否有 show parameter/show variables 之类的功能参数

执行下面语句进行参数查询：

```
select * from v$dm_ini;
```

> **建议**
>
> 可以参考《DM 系统管理员手册》附录章节，查看更多动态视图信息，手册位于**数据库安装路径** \`/dmdbms/doc\` 文件夹。



## 达梦的页大小，怎么设置以及获取

页大小的设置：达梦数据库的页大小是初始化参数，只能在初始化数据库实例的时候设置，修改只能重新初始化实例。

页大小的获取：可以通过语句获取 select page/1024; 单位为 KB。

## 如何切换模式

单机切换模式：set schema 模式名;

实时主备的集群如何切换模式：确认监视器输入 login，然后输入用户名 SYSDBA 密码 SYSDBA，最后输入执行 switchover。

## 如何切换数据库

使用不同用户登录即可访问各自数据库用户下的表。

## 如何查询和修改数据库实例名

查询：

```
SELECT * FROM V$INSTANCE;
```

修改：

可以修改 dm.ini 配置文件的 INSTANCE_NAME 参数值。

## 如何收缩数据库大小

不能收缩

## 如何把 varchar 类型变成 clob/TEXT 类型

不能直接把 varchar 转换成大字段。可以用如下方式：

在表中创建大字段，首先把 varchar 字段内容 insert 或者 update 到大字段，然后把字段名称互相调换更改，最后删除 varchar 字段。

## 如何获取达梦当前模式名

运行下面语句获取：

```
SELECT SF_GET_SCHEMA_NAME_BY_ID(CURRENT_SCHID());
```

## 列长度超出定义如何处理

  1. 找到报错列，将精度调大；
  2. 可以加大类型：比如 varchar 内容太长，改成 text 类；
  3. 调整数据库页大小，建议调整成 16 KB 以上。



## 达梦数据库的 boolean 类型是用什么表示

达梦数据库的 boolean 类型可以用 bit 类型。

## 创建表的 blob 类型字段如何指定精度

blob 类型不能修改精度，大字段类型的精度都不能修改。

## timestamp 类型为什么不可以修改精度

不可以修改精度，可以修改标度。

## 字符类型 TEXT 的精度是否可以调高

不能调，TEXT 为变长字符串类型。其字符串的长度最大为 2G-1。

## 如何判定当前库中某一个表是否存在

可以通过查询 DBA_TABLES 或 ALL_TABLES，如果要查询某个用户下某个表是否存在，可以通过 OWNER 列进行限定。

如：查询用户 TEST 下是否存在表 TAB，SQL 脚本如下：

```
select * from DBA_TABLES where owner = 'TEST' and table_name = 'TAB';
```

> **注意**
>
> 1.关于 DBA_TABLES 中每个字段的具体含义，可以参考《DM 系统管理员手册》附录-兼容 Oracle
> 视图章节，查看更多动态视图信息，手册位于数据库安装路径 doc 文件夹。  
> 2.为了提高 DM 与 Oracle 的兼容性，DM 提供了较为丰富的与 Oracle 兼容的视图。



## page_size/页大小在初始化数据库后是否可以更改

簇，页，日志文件大小，字符集，大小写敏感，这些是需要在数据库创建之前就确定好的，不可以修改。

## 对 blob 字段进行 like 查询性能较慢

可以使用全文索引。DM 的全文索引现只支持简体中文、英文语言。较为详细的语法介绍可参考《DM_SQL 语言使用手册》，手册位于数据库安装路径 `/dmdbms/doc` 文件夹。

## 给 TEXT 类型创建索引失败：试图在 BLOB/ClOB/ 用户自定义数据类型上建索引

TEXT 类型在达梦里面是大字段，是不允许创建索引的。

## V$database 视图里 total_size 的单位是什么

单位是页，total_size*页大小(K)/1024 单位才是 MB。

## 如何查看实例是否是空格自动填充

```
select  * from v$dm_ini where para_name = 'BLANK_PAD_MODE';
```

BLANK_PAD_MODE：字符串比较时，结尾空格填充模式是否兼容 Oracle。取值：1 兼容；0 不兼容。 默认为 0。可选参数。

该参数设置后不能修改，需要重新初始化数据库。

## 删除用户报错：当前对象被占用

可以使用语句进行级联删除：

```
drop user 用户名 cascade;
```

> **警告**
>
> 级联删除用户，将删除该用户所拥有的所有表、视图等资源，为保证数据不丢失，请务必确认无误后进行删除。



## 应用插入数据到达梦数据库报磁盘空间不足

  1. 表空间是不是没开自动扩展；
  2. df -h 查看下操作系统空间，另外查看下是哪个表空间满了。



## 字符串转换出错一般出现在怎样的使用场景中

  1. 字符串混合转换。



```
select cast('123' as int); --可以正常执行
select cast('123a' as int); --报错字符串转换出错
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202302161004264PI792EYD09XW19R40)

数据类型最好一致，不同数据类型转换可能会报该错误。

具体的类型转换相容矩阵，可以参考《DM SQL 语言使用手册》函数章节--类型转换函数，手册位于数据库安装路径 `/dmdbms/doc` 文件夹。

  2. 在使用函数 DECODE()时,例如：



```
select DECODE('688.46673946623', null,null,0,null,'VERIFY', 0, '688.46673946623') from dual;
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230216101226S2M6D7EQT5ABVSEG8N)

解决办法：

方式一：修改 sql

```
select DECODE('688.46673946623', null,null,'0',null,'VERIFY', 0, '688.46673946623') from dual;
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230216101424DDY2USKSUAG13XNH6F)

方式二：通过以下命令修改参数 CASE_COMPATIBLE_MODE 值为 2，并重启数据库生效。

```
SP_SET_PARA_VALUE(2,'CASE_COMPATIBLE_MODE',2);
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230216101746CSCATJ4TQJY48PRZAW)

数据库重启后检查是否修改成功,值为 2 表示修改成功。

```
select * from v$dm_ini where para_name = 'CASE_COMPATIBLE_MODE';
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230216105119RP82E0S2S5GTZ8KQU8)

再次使用函数 DECODE() 查询即可成功。

```
select DECODE('688.46673946623', null,null,0,null,'VERIFY', 0, '688.46673946623') from dual;
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230216102427BNHM5YGPZU1JLXXMHY)

函数 DECODE() 解释：

语法：`DECODE(exp, search1, result1, … searchn, resultn[,default])`

功能：查表译码，DECODE 函数将 exp 与 search1,search2, … searchn 相比较，如果等于 searchx，则返回 resultx，如果没有找到匹配项，则返回 default, 如果未定义 default，返回 NULL。

参数 CASE_COMPATIBLE_MODE 解释：

|**参数名**|**默认值**|**属性**|**说明**|
|---|---|---|---|
|CASE_COMPATIBLE_MODE|1|动态，系统级|涉及不同数据类型的 CASE 运算，是否需要兼容 ORACLE 的处理策略。0：不兼容；1：兼容，本模式下，当函数 DECODE() 中的多个 CASE 类型不一致时，DECODE 会从其中选择一个类型进行匹配；2：兼容，本模式下，当函数 DECODE() 中的多个 CASE 类型不一致时，DECODE 根据第一个 CASE 的类型来决定匹配类型。|


## 试图删除已经使用的表空间

可以尝试先把表空间里的表删掉，如果删除表空间里面的数据还是报错：

  1. 可以尝试先 offline 表空间，表空间脱机处理后进行删除操作。
  2. 查询 sysobjects 或者 dba_objects，查看表空间里是否还存放了其它对象。



## 无效的数组查询对象

添加 hint: /+ ENABLE_TABLE_EXP_REF_FLAG(1)/ 解决。

## 数据插入后但是归档日志分析结果没内容

![问题截图](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-024.jpg)

需要修改 dm.ini 中以下两个参数值

  * ARCH_INI = 1
  * RLOG_APPEND_LOGIC = 1



重启数据库服务器生效

```
SELECT NAME , FIRST_TIME , NEXT_TIME , FIRST_CHANGE# , NEXT_CHANGE# FROM V$ARCHIVED_LOG;

DECLARE
BEGIN
FOR LOGPATH IN (SELECT PATH FROM V$ARCH_FILE) LOOP
DBMS_LOGMNR.ADD_LOGFILE(LOGPATH.PATH);
--DBMS_LOGMNR.ADD_LOGFILE('F:\arch\ARCHIVE_LOCAL1_0x10F0D1B2[0]_2020-12-25_11-55-05.log');
END LOOP;
END;
SELECT LOW_SCN, NEXT_SCN, LOW_TIME, HIGH_TIME, LOG_ID, FILENAME FROM V$LOGMNR_LOGS;

DBMS_LOGMNR.START_LOGMNR(OPTIONS=>2130 , STARTTIME=>TO_DATE('2020-11-20 01:05:44','YYYY-MM-DD HH24:MI:SS') , ENDTIME=>TO_DATE('2020-12-25 23:04:55','YYYY-MM-DD HH24:MI:SS'));
SELECT * FROM V$LOGMNR_CONTENTS;
```

![分析结果](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-025.jpg)

DBMS_LOGMNR.END_LOGMNR();

## MEMORY_POOL 一般设置多少合适

【问题背景】：

用户找了一些资料 说设置为服务器内存的 80 %，结果直接内存溢出了。

用户服务器 32 GB 内存，memory_pool 调到 20 GB，然后数据库宕机了。

用户主要是在做压力测试过程中，发现数据库内存使用量上不来，就强行提高了 memory_pool

![错误结果](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-026.jpg)

【问题解答】：

这个资料完全不对，如果按照以上资料进行配置的话，数据库运行不了多久就会宕机。请按照下面进行配置：

|**主机物理内存配置（G）**|**16**|**32**|**64**|**128**|**256**|
|-----------|-----------|-----------|-----------|-----------|-----------|
|应用最大连接数(个)|200|1000|2000|4000|5000|
|最大连接占用内存（G）|2|6|12|36|36|
|DM 软件内存占用（G）|5|5|5|5|5|
|MAX_OS_MEMORY|100|100|100|100|100|
|MEMORY_POOL（M）|2048|2048|2048|2048|2048|
|BUFFER（M）|8000|17000|33000|66000|131000|
|MAX_BUFFER（M）|8000|17000|33000|66000|131000|
|BUFFER_POOLS（个）|23|43|83|101|101|
|RECYCLE（M）|2000|4000|8000|16000|33000|
|HJ_BUF_GLOBAL_SIZE（M）|1000|2000|4000|8000|15000|
|HJ_BUF_SIZE（M）|500|500|1000|1000|1000|
|HAGR_BUF_GLOBAL_SIZE（M）|1000|2000|4000|8000|15000|
|HAGR_BUF_SIZE（M）|500|500|1000|1000|1000|
|SESS_POOL_SIZE（K）|16|16|32|32|32|
|SESS_POOL_TARGET（M）K|16384|16384|16384|16384|32768|
|CACHE_POOL_SIZE（M）|1024|1024|2048|2048|2048|
|DICT_BUF_SIZE（M）|500|500|500|500|500|
|SORT_FLAG|0|0|1|1|1|
|SORT_BLK_SIZE（M）|1|1|1|1|1|
|SORT_BUF_SIZE（M）|10|10|512|512|512|
|SORT_BUF_GLOBAL_SIZE（M）|2000|2000|5120|5120|5120|


## VARCHAR、TEXT 字段类型存储内容长度受分页限制吗？

VARCHAR 存储内容受分页限制，TEXT 最大内容可以存 2G-1 不受分页限制。
VARCHAR 数据类型指定变长字符串，用法类似 CHAR 数据类型，可以指定一个 不超过 8188 的正整数作为字符长度，例如：VARCHAR (100)。如果未指定长度，缺省为 8188。 在基表中，当没有指定 USING LONG ROW 存储选项时，插入 VARCHAR 数据类型的实际最大存储长度由数据库页面大小决定，具体最大长度算法如下表：

|**数据库页面大小**|**实际最大长度**|
|-------|-------|
|4K|1900|
|8K|3900|
|16K|8000|
|32K|8188|


如果指定了 USING LONG ROW 存储选项，则插入 VARCHAR 数据类型的长度不受数据库页面大小限制。VARCHAR 类型在表达式计算中的长度上限不受页面大小限制，为 32767。

## 如何修改 dm.ini 配置文件的参数

达梦的配置参数参数属性分为三种：静态、动态和手动。
静态，可以被动态修改，修改后重启服务器才能生效。
动态，可以被动态修改，修改后即时生效。参数详情参考安装目录 DOC 目录下的“ DM 系统管理员手册”-第 2.1 章节。
在 DM 数据库中，很多参数都是动态的，会自动响应各种负载，但是 DBA 仍然可以调用系统过程来改变 DM 实例的运行参数，从而获得更佳的性能体验。
DBA 可以在 DM 数据库运行过程中执行：SF_GET_PARA_VALUE 、 SF_GET_PARA_DOUBLE_VALUE 和 SF_GET_PARA_STRING_VALUE 这三个函数来获取系统的当前配置参数，并且可以使用 SP_SET_PARA_VALUE 和 SP_SET_PARA_DOUBLE_VALUE 过程来修改静态/动态配置参数。
详细函数修改方式参数详情参考安装目录 DOC 目录下的“ DM 系统管理员手册”-第 20 章节- 20.5 调整配置参数。

## Oracle 中 raw 类型在达梦中可以用哪种类型代替

在 DM 中可以使用 varbinary 代替。

## 表空间的大小，对于数据库模式的性能会不会有影响

表空间打开自动扩充，其大小不会有什么数据库性能有影响。
详细的性能参考资料，可以参考：[数据库性能诊断](http://eco.dameng.com/docs/zh-cn/ops/performance-db.html)

## 收集统计信息是什么机制，是隔多长时间会执行一次，必须要手动执行？

默认需要手动执行，如果有需求，可以配置定时作业，定期收集。
详细请参考：[统计信息](https://eco.dameng.com/document/dm/zh-cn/ops/performance-optimization.html#%E4%BA%94%E3%80%81%E7%BB%9F%E8%AE%A1%E4%BF%A1%E6%81%AF)

## Key/授权过期后，用新的授权加载进数据库，之前数据库数据是会保留还是会被自动删除

数据库里面的数据不会删除，将新的授权替换旧的授权后，数据库可以正常启动。

## 管理工具黑屏

【问题详情】：
达梦 7 数据库，在达梦管理工具中，新建管理用户后，给其分配“系统权限”，点击“系统权限”按钮，出现黑屏然后自动跳转到用户登录界面。在其他相同系统的服务器上使用相同的工具链接相同的数据库就没问题。
【问题解答】：

  1. 可以重启一下管理工具客户端
  2. 检查客户端和服务器版本是否一致,如果客户端版本比较低，可以升级一下客户端版本



> **备注**
>
> 检查数据库版本的命令： dm7:select * from v$version; Dm8:select id_code();



## 表字段实际占用的长度与 VARCHAR() 精度不一致

如果数据库的 LENGTH_IN_CHAR 初始化是设置为 1，那么 VARCHAR 表示以字符为长度，中文数据实际长度会比 VARCHAR 精度大。

> **备注**
>
> LENGTH_IN_CHAR 这个参数是确定：VARCHAR 类型对象的长度是否以字符为单位。
> 1：是，设置为以字符为单位时，定义长度并非真正按照字符长度调整，而是将存储长度值按照理论字符长度进行放大。所以会出现实际可插入字符数超过定义长度的情况，这种情况也是允许的。同时，存储的字节长度
> 8188 上限仍然不变，也就是说，即使定义列长度为8188 字符，其实际能插入的字符串占用总字节长度仍然不能超过 8188； 0：否，所有
> VARCHAR 类型对象的长度以字节为单位



## 如何调整配置参数/调整 dm.ini 参数/调整兼容性（COMPATIBLE_MODE）参数/…

可以参考安装目录下 doc 目录下 DM 系统管理员手册 第 20 章节 —20.5 小节调整配置参数。

## 如何在达梦数据库中获取表的创建时间

```
select * from dba_objects where OBJECT_TYPE='TABLE';
--查询的结果集中 created 列就是对象的创建时间。
```

## 达梦数据库创建函数时，如何捕获异常信息

可以参考安装目录 doc 目录下的 DM SQL 程序设计手册—第 6 章节 DMSQL 程序异常处理。

## 达梦里有 v$sql_stat_history 获取 sql 的视图机制吗

开启 SQL 跟踪日志，可以看到开启之后的执行过的 sql 操作：

开启语句：`SP_SET_PARA_VALUE(1,‘SVR_LOG’,1);`

日志文件在安装目录的 log 目录下，有个 dm_sql 这种开头的 log 文件。

用完记得关闭：执行 SP_SET_PARA_VALUE(1,‘SVR_LOG’,0);

## 是否可以通过不重启数据库服务的方式将临时授权替换正式授权？

可以，具体步骤如下：

  * 至数据库安装目录 bin 下将临时授权 dm.key 重命名



```
例：mv dm.key dm.key_bak
```

  * 将正式授权 dmxxxx.key 修改为 dm.key 文件拷贝至 bin 目录下
  * 登录客户端  
执行 SQL：



```
sp_load_lic_info();
```

## 如何查看数据库里的所有外键关联表

SQL 语句查询如下：

```
select
 t1.owner 原始表用户名,
  t1.table_name 原始表,
  t2.owner as 被依赖表用户名,
      t2.table_name as  被依赖的表,
      t1.constraint_name 外键名称,
      a1.column_name 列,
      a2.column_name as  被依赖的列
  
from dba_constraints t1, dba_constraints t2, dba_cons_columns a1, dba_cons_columns a2
where
     t1.r_constraint_name = t2.constraint_name and
     t1.constraint_name = a1.constraint_name and
     t1.r_constraint_name = a2.constraint_name
     order by t1.owner;
```

## 如何查询数据库实例的初始化参数？

```
select '实例名称' 数据库选项,INSTANCE_NAME  数据库集群相关参数值 FROM v$instance union all
select top 1 '数据库版本', banner ||'.'||id_code from v$version
union all
SELECT '字符集',CASE SF_GET_UNICODE_FLAG() WHEN '0' THEN 'GBK18030' WHEN '1' then 'UTF-8' when '2' then 'EUC-KR' end union all
SELECT '页大小',cast(PAGE()/1024 as varchar) union all
SELECT '簇大小',cast(SF_GET_EXTENT_SIZE() as varchar) union all
SELECT '大小写敏感',cast(SF_GET_CASE_SENSITIVE_FLAG() as varchar) union all
select '数据库模式',MODE$ from v$instance;
```

## 达梦数据库如何查询那些表使用了自增列？

```
select
       b.table_name,
       a.name COL_NAME
from
       SYS.SYSCOLUMNS a,
       all_tables b    ,
       sys.sysobjects c
where
       a.INFO2=1
   and a.id           =c.id
   and c.name         = b.table_name；
```

## 统计用户下的表和数据量

```
--创建表存储信息
create table test(table_name varchar,cnt bigint);

--将以下SYSDBA替换成需要统计的用户名
declare
sql varchar ;
cnt bigint ;
begin
for rec in (select table_name from dba_tables where owner = 'SYSDBA') loop
 sql = 'select count(*) from SYSDBA."'||rec.table_name||'"';
 execute immediate sql into cnt;
 insert into test values (rec.table_name,cnt);
 commit;
end loop;
end;

--查询
select * from test order by cnt desc;
```

## 如何查询用户拥有哪些角色权限？

  * 使用管理员权限用户执行：



```
select * from dba_role_privs where grantee = '用户名';
```

  * 右键用户查看属性，在会话框点击权限即可；  
![用户权限](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-
check-027.png)



## 数据库查询时间与服务器本身时间不一致

【问题描述】：

服务器本身时区及时间均正确，但数据库中查询 select sysdate;  比实际时间早 8 小时。

【问题解答】：

需要配置 dm_svc.conf 文件，其中指定 TIME_ZONE=(480)，即指明客户端的时区为东八区。
dm_svc.conf 文件是 DM 安装时生成一个配置文件，不同平台的目录有所不同：

  * 32 位的 DM 安装在 Win32 操作平台下，此文件位于 %SystemRoot%\system32 目录；
  * 64 位的 DM 安装在 Win64 操作平台下，此文件位于 %SystemRoot%\system32 目录；
  * 32 位的 DM 安装在 Win64 操作平台下，此文件位于 %SystemRoot%\SysWOW64 目录；
  * 在 Linux 平台下，此文件位于/etc 目录。



## 数据库中执行 DML 语句长时间无响应

【问题分析】：

主要通过以下两点进行排查：

  * 首先排查数据库中是否产生了锁；如果存在，则可以等待或使用 call sp_close_session 杀掉相关阻塞会话。
  * 其次查看磁盘空间是否正常，比如归档满了，数据盘满了等问题也会导致数据库无法写入。



## 在 DSC 环境中修改 DCR 配置信息时报错：Disk[/dev/raw/raw1] is in using

【问题描述】：

导入 DCR 配置文件时，报如下错误：

![报错信息](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-031.png)

【问题解决】：

出现该报错是由于导入 dcr 文件时，dcr 配置信息被 css 进程占用。需要把 css 服务关闭才可以导入修改 dcr 信息。

## 用达梦管理工具，创建表空间报错：创建数据文件失败

【问题描述】：

利用 DM 管理工具，创建表空间报错，具体报错信息如下：

![报错信息](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-032.png)

【问题解决】：

达梦管理工具创建表空间在输入文件路径时，不需要手动新建.dbf 文件，只需要在确认文件路径后，输入文件名即可。具体步骤如下：
步骤 1：新建表空间；

![新建表空间](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-033.png)

步骤 2：输入表空间名(TEST)；

![输入表空间名](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-034.png)

步骤 3：点击添加数据文件，设置文件大小，自动扩展等；

![添加数据文件](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-035.png)

步骤 4：输入文件路径，选择需要存放的路径；

![选择文件路径](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-036.png)

步骤 5：在选择好文件存放路径后，直接输入想要创建的文件名，不需要自己手动新建.dbf 文件。

![输入文件名](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-037.png)

## 如何查看数据库所有表空间大小及其使用情况

【问题解决】：

可利用如下语句查询表空间大小及其使用情况：

```
SELECT F.TABLESPACE_NAME,
(T.TOTAL_SPACE - F.FREE_SPACE) / 1024 "USED (GB)",
F.FREE_SPACE / 1024 "FREE (GB)",
T.TOTAL_SPACE / 1024 "TOTAL(GB)",
(ROUND((F.FREE_SPACE / T.TOTAL_SPACE) * 100)) || '% '
PER_FREE
FROM (SELECT TABLESPACE_NAME,
ROUND(SUM(BLOCKS *
(SELECT PARA_VALUE / 1024
FROM V$DM_INI
WHERE PARA_NAME =
'GLOBAL_PAGE_SIZE') / 1024)) FREE_SPACE
FROM DBA_FREE_SPACE
GROUP BY TABLESPACE_NAME) F,
(SELECT TABLESPACE_NAME, ROUND(SUM(BYTES /
1048576)) TOTAL_SPACE
FROM DBA_DATA_FILES
GROUP BY TABLESPACE_NAME) T
WHERE F.TABLESPACE_NAME = T.TABLESPACE_NAME;
```

## 达梦工具（manager、dts、dbca 和 console 等）详细报错可以在哪里获取

【问题解决】：

在数据库的安装目录下的../log 文件夹中的 tool.log 文件获取，该日志文件中有详细的错误信息。

## dem 安装集群报错：没有创建服务权限

【问题解决】：

原因是 dmagent 是用 dmdba 用户权限启动的，使用 root 权限重新启动 agent 程序即可。

![改为 root 权限启动](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-038.png)

## 更改后的 key 文件不生效，授权的日期时间没变，应如何正确更换 DM 的 key 文件

【问题解决】：

  * 替换 key 文件



  1. 移出原有的 dm.key 文件到其他目录或重名为其他名称；
  2. 将授权文件 dm.key 拷贝到安装目录的 bin 目录下，以下以数据库软件安装在/home/dmdba/dmdbms 目录，授权文件是 dm.key 上传到了/home/dmdba 目录为例。



```
su - dmdba
cd /home/dmdba/dmdbms/bin
cp /home/dmdba/dm.key /home/dmdba/dmdbms/bin     #将授权文件 dm.key 拷贝到bin目录下
chown -R dmdba:dinstall dm.key      #修改 dm.key 文件权限
chmod 755 dm.key
```

  * 让 key 文件信息生效



方法一：等待数据库自动检测并更新。
默认每天凌晨数据库会自动检测 key 信息，如果 key 被替换，会自动更新，建议第三天查询授权是否生效。
方法二：不重启数据库，执行函数生效。
该方法非所有版本都有，需要查看手册进行确认。打开数据库工具，新建查询：

```
call sp_load_lic_info();
```

方法三：重启数据库使 key 文件生效。
若为单机库，在/home/dmdba/dmdbms/bin 目录执行：./DmS(按 tab 键补全)空格 restart
若为集群，请和工程师确定重启方式。

  * 查询授权是否生效



```
select expired_date from  v$license;  #查询 key 的到期时间
```

若查询返回结果是否为'NULL'，则表示已更新为永久授权，否则返回到期时间。

> **注意**
>
> 1\. 切勿在生产环境下，随意替换 key 文件；  
>  2\. key 文件名称一定要改成 dm.key，如果不修改直接放到服务器上是不生效的；  
>  3\. 如果之前的旧授权也在，可以先移走或者删除；  
>  4\. 替换 key 文件前，请确保与服务器架构匹配，否则有可能造成服务启动失败；  
>  5\. 若 key 替换完后，查询结果未达到预期，请确保 key 文件的权限属组正常。



## 本地 disql 登录正常，应用连接网络偶尔断开

【问题解决】：

检查服务器进程：

```
ps -ef|grep port
```

Kill 该进程，并将 ports.sh 修改为 ports.sh_bak，重新连接即可。

## 如何查看统计信息收集情况

【问题解决】：

利用如下 SQL 语句，可以查看某用户下的统计信息收集情况：

```
select a.object_name,a.owner,a.object_type,b.last_gathered 
from dba_objects a,SYSSTATS b 
where a.object_id = b.id --and a.OWNER = '用户名'
order by b.last_gathered limit 10;
```

查询结果如下图：

![查询结果](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-039.png)

## 扩展表空间失败：[-3410]:表空间上有事务未提交

【问题解决】：

可通过以下步骤进行检查：

  1. 检查是否有查询表空间类视图未提交，例如 dba_data_files 等；
  2. 检查是否有查询表类视图未提交，例如 user_tables 等；
  3. 检查是否存在一些其他涉及表空间查询的事务未提交，可以通过查询视图 v$trxwait 查看具体等待事务及 sql。查询语句如下：



```
select tw.*,ss.clnt_ip,ss.SQL_TEXT from V$TRXWAIT tw join v$sessions ss on ss.trx_id=tw.wait_for_id order by wait_time desc;
```

## 如何查询统计表的各种约束

【问题解决】：

```
---查询主键
SELECT a.OWNER as "模式名",a.TABLE_NAME as "表名",b.COLUMN_NAME as "列名", a.CONSTRAINT_NAME as "约束名"
from DBA_CONSTRAINTS a, ALL_CONS_COLUMNS b where a.CONSTRAINT_NAME=b.CONSTRAINT_NAME and CONSTRAINT_TYPE='P';

---查询外键
SELECT a.OWNER as "模式名",a.TABLE_NAME as "表名",b.COLUMN_NAME as "列名", a.CONSTRAINT_NAME as "约束名"
from DBA_CONSTRAINTS a, ALL_CONS_COLUMNS b where a.CONSTRAINT_NAME=b.CONSTRAINT_NAME and CONSTRAINT_TYPE='R';

---查询唯一约束
SELECT a.OWNER as "模式名",a.TABLE_NAME as "表名",b.COLUMN_NAME as "列名", a.CONSTRAINT_NAME as "约束名"
from DBA_CONSTRAINTS a, ALL_CONS_COLUMNS b where a.CONSTRAINT_NAME=b.CONSTRAINT_NAME and CONSTRAINT_TYPE='U';

---查询check约束
SELECT a.OWNER as "模式名",a.TABLE_NAME as "表名",b.COLUMN_NAME as "列名", a.CONSTRAINT_NAME as "约束名",SEARCH_CONDITION as "CHECK约束的条件"
from DBA_CONSTRAINTS a, ALL_CONS_COLUMNS b where a.CONSTRAINT_NAME=b.CONSTRAINT_NAME and CONSTRAINT_TYPE='C';

---查询默认列
SELECT OWNER as "模式名",TABLE_NAME as "表名",COLUMN_NAME as "列名",DATA_TYPE as "列类型",DATA_DEFAULT as "默认值" FROM DBA_TAB_COLUMNS WHERE DATA_DEFAULT IS NOT NULL;

---查询非空列
SELECT OWNER as "模式名",TABLE_NAME as "表名",COLUMN_NAME as "列名",DATA_TYPE as "列类型" FROM DBA_TAB_COLUMNS WHERE NULLABLE ='Y';
```

## 审计日志文件如何指定自定义路径

【问题解决】：

审计日志文件缺省使用 SYSTEM_PATH 路径，若要把审计日志文件单独指定到自定义的路径下，dm.ini 文件中提供了 AUD_PATH 参数，可以指定自定义路径，该参数为静态参数，修改后重启数据库生效。

## 存储过程中对自动扩展的分区表执行插入未定义的分区数据报错："语句块/包/存储函数中的间隔分区不支持自动扩展"

【问题描述】：

问题重现过程如下：

```
---创建表
create table  dmtest(
c1 datetime(6) default sysdate not null,
c2 varchar2(10))partition by range(c1)
interval(numtodsinterval(1,'DAY'))
(
partition p1 values less than (datetime'2018-04-01 00:00:00')
);

---创建存储过程，执行分区表插入
create or replace procedure insert_interval(v_update datetime, v_paravalue varchar(10))
as
begin
 insert into dmtest values(v_update,v_paravalue);
 commit;
end;
/

---调用存储过程，出现报错：执行失败，语句块/包/存储函数中的间隔分区不支持自动扩展
call insert_interval(datetime'2021-10-13 19:33:41','aswq');
```

【问题解决】：

dm.ini 提供了 DEL_HP_OPT_FLAG 参数来控制分区表的操作优化，该参数为动态会话级参数。出现如上问题，需要修改 DEL_HP_OPT_FLAG 的取值，使其包含 4：允许语句块中的间隔分区表自动扩展。

DEL_HP_OPT_FLAG 参数说明：控制分区表的操作优化。
0：不优化；
1：打开分区表 DELETE 优化；
2：控制范围分区表创建的优化处理，转换为数据流方式实现；
4：允许语句块中的间隔分区表自动扩展；
8：开启对 truncate 分区表的优化处理；
16：完全刷新时删除老数据使用 delete 方式。
DEL_HP_OPT_FLAG 参数取值支持使用上述有效值的组合值，如 7 表示同时进行 1、2、4 的优化。

## 启动 dmagent 报错：permission denied

【问题描述】：

搭建 DEM 时，启动 dmagent 时出现如下报错：

![报错信息](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-040.png)

【问题解决】：

该情况一般出现在 dmagent 是从其他数据库拷贝过来的情况，拷贝过来后文件权限改变，导致报错，修改 dmagent 文件权限即可。

```
chown -R dmdba:dinstall /home/dmdba/dmagent
chmod -R 755 /home/dmdba/dmagent
```

## DEM 监控不到主机信息

【问题描述】：

A 主机 Dmagent 正常启动，B 主机部署的 DEM 检测不到对应的主机信息。DEM 主机部署和 dmagent 均按照规范部署。

【问题解决】：

查看两台主机的时间，发现 A、B 主机间的时间不一致，如下图：

![主机时间](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-041.png)

DEM 监控 5 分钟为消息有效时间，即如果收到 dmagent 发送的消息的时间与 DEM 运行机器当前时间相差 5 分钟，则认为该消息无效，不处理该消息。
因此需要重新同步时间，并重启 dmagent。之后查看 DEM 主机监控信息，可以查看到监控的主机信息。

## 创建 dm8-oracle11G 的 dblink，进行查询时报错：[-6010]:Error in line:1 Connection lost.

【问题描述】：

dm8 通过 oci 接口创建到 oracle 的 dblink 连接，已配置 oracle_client 客户端及环境变量，已配置 tnsnames.ora 文件，tnsnames.ora 参考配置如下：

```
[dmdba@dmdsc01 log]$ cat /soft/dsc/dmdbms/bin/instantclient_19_18/network/admin/tnsnames.ora
ORCL =
 (DESCRIPTION =
   (ADDRESS = (PROTOCOL = TCP)(HOST = xxx.xxx.xxx.xxx)(PORT = 1522))
   (CONNECT_DATA =
     (SERVER = DEDICATED)
     (SERVICE_NAME = ORCLPDB)
   )
 )
```

在通过网络服务名创建 dblink 后进行 dblink 链接查询时提示报错："-6010：连接丢失"。

【问题分析】

通过查看数据库 log 日志文件发现报错如下：

```
2023-03-13 14:06:20.894 [ERROR] database P0000055023 T0000000000000078148  Oracle connect error:[12154]ORA-12154: TNS:could not resolve the connect identifier specified
```

根据该日志报错可以推断主要原因为 tnsnames.ora 未被识别，定位在环境变量存在问题。

【问题解决】：

  1. 排查 dmdba 环境变量中是否配置了 TNS_ADMIN，若未配置需要先配置该变量，具体配置方法如下：



```
[dmdba@dmdsc01 log]$ cat ~/.bash_profile  | grep TNS_ADMIN
export TNS_ADMIN=/soft/dsc/dmdbms/bin/instantclient_19_18/
```

  2. 重启数据库服务，确保数据库服务能够识别该新配置的环境变量，再次发送 dblink 请求。
  3. 用户名和密码需要正确，如果查看到 dm_DMSERVER_202109.log 日志有如下报错，则说明用户名和密码错误：



![日志信息](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-043.png)

注意检查大小写，如果密码为小写，请注意用双引号引起来。

## DM 数据库在麒麟 10 操作系统上关闭 numa，透明大页和修改磁盘调度算法未生效

【问题解决】：

1.检查操作系统内核版本。
操作系统内核版本为 27 之前和 27 之后的修改方法有所不同，如果是 27 版本之后的用通用方法关闭，如果是 27 版本之前的用下面的方法关 numa ，透明大页和磁盘调度；

2.关闭 numa 和透明大页。
修改/boot/efi/EFI/kylin/grub.cfg 文件，查找关键字：menuentry，在相对位置添加 numa 和透明大页命令：

```
numa=off transparent_hugepage=never
```

重启生效，如用命令查看 numa 没有生效，请联系友商，从 BIOS 上进行关闭 numa 。

3.修改磁盘调度算法。修改/usr/lib/udev/rules.d/60-block-scheduler.rules 文件，改磁盘调度算法，重启生效。

## dmagent 使用 service.sh start 以服务方式启动时报错：The service DmAgentService is not install

【问题解决】：

出现该问题是由于 DmAgentService 服务未注册导致。可通过如下方法解决：

以 root 用户登陆后，进入到 dmagent 安装目录，执行：./service.sh install 注册服务，然后输入 dmagent 的路径，dmagent.ini 的路径进行注册即可。如下图所示：

![注册服务](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-044.png)

注册完成后，就可以使用./service.sh start 或者 systemctl start DmAgentService.service 进行启动。

## 在服务器没有 JDK 的环境下，应如何启动 dmagent 服务

【问题解决】：

在此种情况下，用户未安装 JDK 环境，可以使用 DM 数据库自带的 JDK 环境，位于数据库安装目录 $DM_HOME/jdk 下，具体步骤如下：
1.配置 Java 环境变量：

```
export JAVA_HOME=$DM_HOME/jdk --此变量替换为达梦数据库安装目录绝对路径
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
```

![配置 JDK 环境](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-045.png)

2.启动 dmagent。当前提供了两种方式启动 dmagent，具体如下：
（1）使用 dmdba 以进程启动。直接进入 dmagent 目录执行：./startup agent.ini 即可正常启动。

![以进程方式启动 dmagent](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-046.png)

（2）以服务方式启动。需要在 root 用户中先载入数据库的 JDK 环境变量，参考第 1 步（未执行此步骤将无法注册服务）。然后进入 dmagent 的目录中执行：./service.sh install 进行注册。

![以进程方式启动 dmagent](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-047.png)

最后，注册完成后，在 dmagent/service/DmAgentService 中添加第（1）步的 JDK 环境变量保存后即可使用服务方式启动。注意，JDK 的路径一定要使用达梦数据库 JDK 的绝对路径，否则还是无法正常启动 dmagent。

![查看服务配置](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-048.png)

![查看服务状态](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-049.png)

## 如何将两台主备集群更改为 nomal 模式

【问题解决】：
先启动到 mount 状态，执行如下命令，修改 ALTER_MODE_STATUS 参数

```
SQL> sp_set_para_value(1,'ALTER_MODE_STATUS',1);  
SQL> alter database normal;
SQL> sp_set_para_value(1,'ALTER_MODE_STATUS',0);
SQL> alter database open;
```

然后，修改启动服务内容

```
vi DmServiceSERVER
---修改服务启动方式为 open
start_mode=open
```

最后，将配置文件做备份，并修改回原本的参数：
1、修改 dmarch.ini，只保留 local 本地归档；
2、dm.ini 关闭 MAL_INI；
3、重启数据服务。

## DEM 监控 linux 多台主机的时候只能显示一台

【问题解决】：

配置 agent 时，修改 center_url，还需要配置 id_policy = 1 使用 ip 的方式监控（默认 0 采用 mac 地址），配置完成之后重启正常。

![配置 agent](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-050.png)

## DEM 添加 DSC 集群问题

DEM 添加 DSC 集群时，主要包含以下两类问题：

问题一： DEM 监控 DSC 集群无法通过扫描站点添加成功

【问题描述】：

DEM 监控 DSC 集群通过扫描站点测试连接成功，但点击确定后，报错：站点扫描失败。

【问题解决】：

通过新增站点来添加 DSC 集群，点击下图中的“+”号，填写 DSC 集群信息，新增即可（DSC 每个节点都要新增一次）。

![新增 dsc 集群](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-051.png)

问题二：添加站点时候无法直接修改保存

【问题描述】：

当需要修改下图中服务名和启动命令时报错，并提示以下信息：主机和对应端口已存在。

![待修改的集群信息](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-052.png)

【问题解决】：

点击标记的倒三角形图标，如下图，选择“编辑”，进行修改即可。

![修改步骤](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-053.png)

## 数据库连接资源释放

【问题解决】：

如果用户的资源一直没有释放，可以从应用层和数据库两个方面来做设置。
注意需要考虑实际业务场景：如果从数据库层面断开，应用层面再次连接数据库会报错，那么最好从应用层面来设置资源限制。
从应用层面设置会话空闲期，请联系应用负责人进行相应设置，以下主要介绍从数据库层面进行资源限制。

  * 管理工具设置：设置用户会话空闲时间，管理工具–管理用户–修改用户—资源设置项—会话空闲期。
  * 命令行设置：比如设置会话空闲时间为 10 分钟，采用如下 SQL 语法：  
alter user 用户名 limit CONNECT_IDLE_TIME 10;

  * 通过 V$SESSIONS 查出空闲会话，然后使用 sp_close_session(会话 ID) 关闭会话。



```
select * from V$SESSIONS where  STATE='IDLE' ;
sp_close_session(会话ID)
```

## DM8 客户端管理工具上修改普通用户报错“无效的表或视图名[SYSUSERPROFILES]"

【问题解决】：

1、通过 select * from sysuserprofiles 查询报错，确实不存在相关的表；
2、通过 select id_code 查询服务器端版本为 2021.06.07 号的，再查看 manager 客户端为 2021.10.21 号的版本，客户端版本超过服务端版本；
3、更换客户端为 2021.06 月份左右的版本后，修改普通用户，正常执行；

总结：建议在 DM8 的数据库上，客户端版本尽量和服务端版本保持一致。

## 新建用户创建作业失败：没有 JOB 权限

【问题解决】：

可以通过单独授权或者授权 dba 角色进行解决。

方法一： 通过管理工具授予用户 admin job 权限。

![修改步骤](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-054.png)

方法二： 通过命令的方式进行授权。

```
grant ADMIN JOB to "CYTEST";
```

说明：也可通过授予用户 dba 权限解决该问题，但生产环境中不推荐使用该方法。

## 测试环境中经常有一些长时间运行的会话，如何批量 kill 这些会话，释放连接

【问题解决】：

结束会话一般使用 sp_close_session() 命令。如果想批量执行的话，可以根据条件在 v$sessions 中查询，并使用游标去执行。
批量结束会话操作要小心，可以先根据条件查看相关的 SQL_TEXT，确定后再去执行。
以下例子是结束 60 秒以上的活动会话。

1.首先查看一下符合条件的相关会话：

```
select * from
(SELECT
       DATEDIFF(SS, LAST_RECV_TIME, SYSDATE) SS    ,
       DBMS_LOB.SUBSTR(SF_GET_SESSION_SQL(SESS_ID)),
       *
FROM
       V$SESSIONS
WHERE
       STATE = 'ACTIVE'
order by
       ss desc) where SS >60;
```

2.使用游标去执行：

```
DECLARE
CURSOR c_sessions
is
select * from
(SELECT
       DATEDIFF(SS, LAST_RECV_TIME, SYSDATE) SS    ,
       DBMS_LOB.SUBSTR(SF_GET_SESSION_SQL(SESS_ID)),
       *
FROM
       V$SESSIONS
WHERE
       STATE = 'ACTIVE'
order by
       ss desc) where SS >60;
c_raw c_sessions%rowtype;
begin
for c_row in c_sessions
loop
execute immediate 'sp_close_session('''||c_row.sess_id||''')';
end loop;
end;
```

## 使用系统包 DBMS_STATS.GATHER_SCHEMA_STATS 收集统计信息时，如何查看收集进度？

【问题描述】：

使用系统包：DBMS_STATS.GATHER_SCHEMA_STATS()，收集一个模式下的表的统计信息时，应如何查看收集进度。
例如：

```
--收集SYSDBA模式下所有对象的统计信息
DBMS_STATS.GATHER_SCHEMA_STATS('SYSDBA',100,FALSE,'FOR ALL COLUMNS SIZE AUTO');
```

【问题解决】：

系统表 dba_tables 中的 last_analyzed 字段可以看到调用系统包收集统计信息的最后收集时间，所以一般可以使用下面的 SQL 以表个数为单位查看收集进度（可根据实际情况调整 OWNER）:

```
SELECT wm_concat(progess) from (
select COUNT(*)  progess from dba_tables where 
OWNER='SYSDBA' AND to_char(last_analyzed,'yyyymmdd') =to_char(sysdate,'yyyymmdd') --目前收集的个数
UNION
SELECT COUNT(*) progess  from dba_tables where OWNER='SYSDBA' --总的表个数
);
```

## 在 DM 达梦数据库的运行日志中出现大量 Failure occurs in data_recv_inet_once 警告信息

【问题描述】：

在 DM 达梦数据库的运行日志中出现大量 Failure occurs in data_recv_inet_once 警告信息，如下图：

![报错截图](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-055.png)

【问题解决】：

如果 WARNING 非常频繁，可能会导致告警日志文件特别大。这里的 Failure occurs in data_recv_inet_once 是消息检验的告警，与网络环境有一定的关系，网络不稳定的情况下触发此告警的可能性较大，可以直接修改 dm.ini 的 COMM_VALIDATE 参数来关闭该功能。该参数可以动态或系统级修改，用来控制是否对消息进行校验。0 表示不检验；1 表示检验，默认值为 1。
关闭消息校验的警告操作如下：

```
---查看 COMM_VALIDATE 参数
select para_name,para_value,description,para_type from v$dm_ini where para_name='COMM_VALIDATE';

---修改参数 COMM_VALIDATE 为 0
SP_SET_PARA_VALUE(1, 'COMM_VALIDATE', 0);
```

修改完成后在 dm.ini 中检查是否参数是否已修改。

```
cat dm.ini |grep COMM_VALIDATE
```

## 如何将 ASM 磁盘中的文件拷贝出来

【问题解决】：

```
---A、B 机器启动 CSS 和 ASM 服务：
[dmdba@ ~]$ /opt/dsc/dmdbms/bin/dmcss DCR_INI=/opt/dsc/config/dmdcr.ini
[dmdba@ ~]$ /opt/dsc/dmdbms/bin/dmasmsvr DCR_INI=/opt/dsc/config/dmdcr.ini

---在A机器上创建data目录：
[dmdba@dmdsc01 ~]$ mkdir /opt/ASMdata

---在A机器上拷贝ASM中文件到操作系统，在ASM磁盘中拷贝文件需要加绝对路径或加单引号：
[dmdba@dmdsc01 ~]$ /opt/dsc/dmdbms/bin/dmasmtool DCR_INI=/opt/dsc/config/dmdcr.ini
 ASM> cp -r '*' '/opt/ASMdata'
ASM>cp 'ARCHIVE_LOCAL1_0x71BFA289[0]_2021-08-26_08-00-05.log' '/opt/ASMdata'
ASM>cp -r +DMDATA/data/dsc1/arch/ARCHIVE_LOCAL1_0x71BFA289[0]_2021-08-26_08-00-05.log /opt/ASMdata
```

## 数据库中缺少 DBA_TABLES、USER_TABLES、DBA_FREE_SPACE 等系统视图

【问题解决】：

可通过如下步骤解决：

1.创建系统视图 `SP_CREATE_SYSTEM_VIEWS(1);`

2.如果报语法错误或其它错误，检查是否屏蔽了关键字；

```
select * from v$dm_ini where para_name='EXCLUDE_RESERVED_WORDS';
```

如果存在关键字屏蔽，修改 dm.ini 中 EXCLUDE_RESERVED_WORDS 参数，去掉关键字屏蔽后重启数据库。并执行 `SP_CREATE_SYSTEM_VIEWS(1);`

## DEM 后台数据库数据总量过大怎么办？能定期清理吗？

【问题描述】：

DEM 在长期使用后，后台数据库中会保存很多历史数据信息，后台数据总数据量会变的很大，占用磁盘空间。同时，部分记录详细信息表的数据量会变的很大，导致前台部分功能点涉及到大表的关联查询时，会出现缓慢卡顿的问题。

【问题解决】：

可通过以下两种方法解决问题：

方法一： 使用 DEM 管理平台的历史数据管理功能，设置历史数据保留时间上限。进行该设置后，系统会自动删除指定天数之前的历史数据。

1.选择系统配置模块。

![系统配置模块](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-056.png)

2.历史数据管理选项，选择数据保留时间，勾选对应表，点击应用。

![选择数据保留时间](https://download.dameng.com/eco/docs/asset/faq/check/faq-db-check-057.png)

方法二： 在相应表上设置索引和定时作业，解决查询慢和占用磁盘空间大的问题。

1.在大表上添加索引。

```
CREATE INDEX IDX_DMA_DATABASE_SQL_COUNT_TS ON DEM.DMA_DATABASE_SQL_LOG_FILE_INFO(TS);
CREATE INDEX IDX_DMA_DATABASE_SESSION_TS ON DEM.DMA_DATABASE_SESSION(TS);
CREATE INDEX IDX_DMA_DATABASE_SQL_SLOW_TS ON DEM.DMA_DATABASE_SQL_LOG_VIEW_INFO(TS);
CREATE INDEX IDX_DMA_MAINFRAME_DISK_TS ON DEM.DMA_MAINFRAME_DISK(TS);
CREATE INDEX IDX_DMA_DATABASE_TS_TS ON DEM.DMA_DATABASE_TS(TS);
```

2.创建存储过程，更新大表统计信息和清理大表数据。

```
CREATE PROCEDURE CLEAR_HISTORY_DAYS(DAYS INT) AS
BEGIN
DELETE FROM DEM.DMA_DATABASE_SQL_LOG_FILE_INFO WHERE TS < TIMESTAMPDIFF(MS,'1970-01-01',SYSDATE - DAYS); 
DELETE FROM DEM.DMA_DATABASE_SESSION WHERE TS < TIMESTAMPDIFF(MS,'1970-01-01',SYSDATE - DAYS);
DELETE FROM DEM.DMA_DATABASE_STAT WHERE TS < TIMESTAMPDIFF(MS,'1970-01-01',SYSDATE - DAYS);
DELETE FROM DEM.DMA_MAINFRAME_STAT WHERE TS < TIMESTAMPDIFF(MS,'1970-01-01',SYSDATE - DAYS);
DELETE FROM DEM.DMA_DATABASE_SQL_LOG_VIEW_INFO WHERE TS < TIMESTAMPDIFF(MS,'1970-01-01',SYSDATE - DAYS);
DELETE FROM DEM.DMA_MAINFRAME_DISK WHERE TS < TIMESTAMPDIFF(MS,'1970-01-01',SYSDATE - DAYS);
DELETE FROM DEM.DMA_DATABASE_EVENT WHERE TS < TIMESTAMPDIFF(MS,'1970-01-01',SYSDATE - DAYS);
DELETE FROM DEM.DMA_DATABASE_TS WHERE TS < TIMESTAMPDIFF(MS,'1970-01-01',SYSDATE - DAYS);
COMMIT;

--更新统计信息
EXECUTE IMMEDIATE 'STAT 100 ON INDEX DEM.DMA_DATABASE_SQL_LOG_FILE_INFO';
EXECUTE IMMEDIATE 'STAT 100 ON INDEX DEM.IDX_DMA_DATABASE_SESSION_TS';
EXECUTE IMMEDIATE 'STAT 100 ON INDEX DEM.INDEX_DMA_DB_STAT_TS';
EXECUTE IMMEDIATE 'STAT 100 ON INDEX DEM.INDEX_DMA_MF_STAT_TS';
EXECUTE IMMEDIATE 'STAT 100 ON INDEX DEM.DMA_DATABASE_SQL_LOG_VIEW_INFO';
EXECUTE IMMEDIATE 'STAT 100 ON INDEX DEM.IDX_DMA_MAINFRAME_DISK_TS';
EXECUTE IMMEDIATE 'STAT 100 ON INDEX DEM.INDEX_DMA_DB_EVENT_TS';
EXECUTE IMMEDIATE 'STAT 100 ON INDEX DEM.IDX_DMA_DATABASE_TS_TS';
END;
```

3.创建定时作业，定时执行存储过程。

```
SP_INIT_JOB_SYS(1);
call SP_CREATE_JOB('HIS_CLEAR',1,0,'',0,0,'',0,'');
call SP_JOB_CONFIG_START('HIS_CLEAR');
call SP_ADD_JOB_STEP('HIS_CLEAR', 'STEP1', 0, 'CALL CLEAR_HISTORY_DAYS(30);', 1, 2, 0, 0, NULL, 0);--清除30天前历史数据
call SP_ADD_JOB_SCHEDULE('HIS_CLEAR', 'DAY1', 1, 1, 1, 0, 0, '02:00:00', NULL, '2021-01-11 16:24:10', NULL, '');
call SP_JOB_CONFIG_COMMIT('HIS_CLEAR');
```

## 使用 Tomcat 10 版本部署 DEM 时，浏览器打开管理界面报错：HHTP 状态 404-未找到

【问题描述】：

当部署 DEM 时，使用 Tomcat 10 版本，不管使用 JDK 1.8.0_333(JDK8 最新版本)，还是使用 JDK 11.0.9(JDK11 最新版本)，浏览器打开 http://xx.xx.xx.xx:8080/dem 都提示：HHTP 状态 404-未找到。

【问题解决】：

达梦 DEM 目前暂不支持 Tomcat 10 的版本。

处理办法：替换 Tomcat 10 版本至 Tomcat 7-9 之间的版本即可。

## 如何查看某个表被哪些视图引用了？

【问题解决】：

可通过以下语句查询某个表被哪些视图引用：

```
select * from DBA_dependencies T WHERE  t.REFERENCED_NAME = ‘表名’；
```

例如，查询  “DEPARTMENT” 这张表被那些视图引用，可执行以下命令：

```
select * from DBA_dependencies T WHERE  t.REFERENCED_NAME = 'DEPARTMENT';
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202208180910522G3X7U2ULX8B480RQT)

在查询结果中显示的前面 3 字段 OWENRR、NAME、TYPE 分别表示所有者、名称和类型， “REFERENCED_XXX" 的字段为被引用的对象所有者，被引用对象名称以及被引用象类型等信息。

## 开启 SQL 监控参数，使用非 DBA 用户查看 ET 方法报错：“没有执行[ET]对象权限”。

【问题描述】：

第一步：SYSDBA 用户开启 SQL 监控，使用 ET 方法查看执行操作符及耗时情况：

```
/**开启系统监控**/
SP_SET_PARA_VALUE(1,'ENABLE_MONITOR',1);
/**开启时间监控**/
SP_SET_PARA_VALUE(1,'MONITOR_TIME' ,1);
```

第二步：打开操作符、虚拟机栈帧、执行计划节点的监控，选择打开系统级或者会话级。

```
/*系统级*/
SP_SET_PARA_VALUE(1,'MONITOR_SQL_EXEC' ,1);

/*会话级,只对本会话有效*/
SF_SET_SESSION_PARA_VALUE('MONITOR_SQL_EXEC' ,1);
```

第三步：开启后使用非 DBA 用户查看 ET 时报错：

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20220908174105S5YPGL33GKY7ZNW1J8)

【问题解决】：

  1. 检查相关参数是否开启；



```
select para_name,sess_value from v$dm_ini where para_name in ('MONITOR_TIME','ENABLE_MONITOR','MONITOR_SQL_EXEC');
--sess_value  都为1 表示开启，缺少这表示未开启。
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230222142114Q02712QF8ZUAG2LTV7)

  2. 检查当前用户是否拥有 et 权限；



```
select * from (
select urid,(select name from SYSOBJECTS where type$='UR' and id=urid) user_name,objid,(select name from SYSOBJECTS where  id=objid) obj_name,grantor,(select name from SYSOBJECTS where  id=grantor) grantor_name from SYSGRANTS a where OBJID  in (select object_id from all_objects where object_name ='ET')
) where user_name=user;
--有一条记录表示当前用户拥有ET权限，没有则表示该用户未授权使用ET.
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202302221421455KZ32GJD3PQC15C8O6)

  3. 如果没有授权通过以下方法进行授权。



```
grant EXECUTE on "SYS"."ET" to "TEST";```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202209081746083DADFRHCRGOXBJFMYP)

授权成功后再使用非 DAB 用户查看 ET 成功。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20220908174817X5XW7GNNN5P0MRVD38)

相关参数说明：

|**参数**|**默认值**|**属性**|**说明**|
|---|---|---|---|
|ENABLE_MONITOR|1|动态，系统级|用于打开或者关闭系统的监控功能。1：打开；0：关闭。|
|MONITOR_TIME|1|动态，系统级|用于打开或者关闭时间监控。该监控项的生效必须是在ENABLE_MONITOR 打开的情况下。1：打开；0：关闭。|
|MONITOR_SQL_EXEC|0|动态，会话级|操作符、虚拟机栈帧、执行计划节点的监控开关。该监控项的生效必须是在 ENABLE_MONITOR 打开的情况下。0：关闭监控；1：打开监控；2：打开监控，在 1 的基础上，又增加了表达式运行时操作符的统计。|


## SQL 监控查询语句汇总

1.查询慢 SQL 及阻塞

```
--检查当前数据库中包含的慢 SQL 及阻塞语句
SELECT
        DS.SESS_ID "被阻塞的会话ID",
        DS.SQL_TEXT "被阻塞的SQL",
        DS.TRX_ID "被阻塞的事务ID",
        (CASE L.LTYPE WHEN 'OBJECT' THEN '对象锁' WHEN 'TID' THEN '事务锁' END CASE ) "被阻塞的锁类型",
        DS.CREATE_TIME "开始阻塞时间",
        SS.SESS_ID "占用锁的会话ID",
        SS.SQL_TEXT "占用锁的SQL",
        SS.CLNT_IP "占用锁的IP",
        L.TID "占用锁的事务ID"
FROM
        V$LOCK L
LEFT JOIN V$SESSIONS DS
ON
        DS.TRX_ID = L.TRX_ID
LEFT JOIN V$SESSIONS SS
ON
        SS.TRX_ID = L.TID
WHERE
        L.BLOCKED = 1;
```

2. 查询死锁历史事务信息

```
select
        dh.trx_id ,
        sh.sess_id,
        wm_concat(top_sql_text)
from
        V$DEADLOCK_HISTORY dh,
        V$SQL_HISTORY sh
where
        dh.trx_id =sh.trx_id
    and dh.sess_id=sh.sess_id
group by
        dh.trx_id, sh.sess_id;
```

3. 查询有事务未提交的表

```
SELECT b.object_name, c.sess_id, a.*
FROM v$lock a, dba_objects b, v$sessions c
 WHERE a.table_id = b.object_id AND a.ltype = 'OBJECT' AND a.trx_id = c.trx_id;
```

4. 查询已执行超过 2 秒的活动 SQL

```
select  *  from
        (
                SELECT
                        user_name,
                        clnt_ip,
                        sess_id,
                        sql_text,
                        datediff(ss, last_send_time, sysdate) ss,
                        SF_GET_SESSION_SQL(SESS_ID) fullsql   
                FROM
                        V$SESSIONS
                WHERE
                        STATE='ACTIVE' and user_name!='SYSDBA'
        )
where ss>=2 order by 5 desc;
```

5. 查询实例中已执行未提交的 SQL

```
SELECT t1.sql_text, t1.state, t1.trx_id
 FROM v$sessions t1, v$trx t2
 WHERE t1.trx_id = t2.id AND t1.state = 'IDLE' AND t2.status = 'ACTIVE';
```

6. 查询占用内存最多的 sql

```
--查询执行在 1 秒以上的SQL语句使用的内存
SELECT "SESSID", MAX_MEM_USED||'KB',SQL_TXT FROM V$SQL_STAT order by MAX_MEM_USED DESC;
```

通过此 SQL 语句确定使用内存较大的 SQL，进行针对性的优化，如消除 HASH,SORT,DISTINCT 等操作。该查询只能查询当前活动 STMT 上的语句消耗情况，历史情况需要查询 V$SQL_STAT_HISTORY，详细内容请参考数据库安装 doc 目录下《系统管理员手册》。

7. 查询占用 io 较大的 sql

```
--查询物理读次数较大的 sql
select
        s.sess_id,
        s.sql_text,
        s.user_name,
        s.state,
        st.PHY_READ_CNT,
        st.iO_WAIT_TIME
from
        v$sessions s, v$session_stat st
where
        s.sess_id=st.sessid and s.state  ='ACTIVE'
ORDER BY  5 DESC;
```

8. 查找性能相对较差的 sql。 即磁盘读取次数较多，按照硬解析读取次数倒叙排序。

```
select
        SQL_TXT,
	EXEC_TIME,
	PARSE_CNT,
        PARSE_TIME,
	HARD_PARSE_CNT,
	HARD_PARSE_TIME
FROM
        v$sql_stat
ORDER BY
        HARD_PARSE_CNT DESC,
        EXEC_TIME DESC;
```

## 如何验证通信是否已经加密？

【问题描述】

开启通信加密后，如何验证通信已经加密了？

【问题解决】

可以通过抓包测试来验证通信是否加密。主要有以下两种方式：

方式一：Linux 环境，通过 tcpdump 命令，进行抓包测试，如果是连接的本机，直接在服务器上进行前台抓包测试，命令如下：`tcpdump -XX -vvv -nn -i lo dst port 数据库端口号` 以上端口号根据实际情况修改，输入完以上命令之后，可以用命令行或者管理工具，创建个测试表进行测试，`create table t1(a int,b int,c int);` 可以在没有打开通信加密的时候，先用该方式测试，会发现，打印出来的网络包可以看到 create 完整语句，打开通信加密之后，再去执行抓包，看不到相应完整的 sql 语句。

方式二：用 Windows 的 wireshark 工具进行分析，如果是在 Linux 上先抓包，拿到 Windows 去分析，可以用以下 tcpdump 命令进行抓包后保存到 pcap 文件中，然后 Windows 上用 wireshark 工具打开该文件，看到的信息基本和 Linux 前台打印类似。pcap 文件打开方式 `tcpdump -i 网口名 -w xxx.pcap` 。

例如采用方式一进行抓包测试。详细步骤如下：

  1. 在未开启通信加密情况下，进行 tcpdump 抓包测试。



（1）登录数据库检查未开启通信加密：

```
SELECT * FROM V$DM_INI WHERE PARA_NAME= 'COMM ENCRYPT_NAME';
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221014093947QG5YFVU2OMSMI6BZIO)

```
tcpdump -XX -vvv -nn -i lo dst port 1313
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221014094444VKBRF9VA4ZTC3XHC0H)

（3）登录数据库创建表：

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221014094515O5GGENBKY2SEVZ2VJH)

（4）检查抓包命令是否以抓取到创建表的命令。在前台抓包命令打印的信息中可以看到已经抓取到之前的建表命令通过明文显示。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221014094622H81R4X4FUMAQJTV4OS)

  2. 在开启通信加密情况下，进行 tcpdump 抓包测试。



（1）登录数据库检查未开启通信加密：

```
SELECT * FROM V$DM_INI WHERE PARA_NAME= 'COMM ENCRYPT_NAME';
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202210140951106SWRQLTJLQWZ34L2DN)

（2）服务器上进行前台执行抓包命令：

```
tcpdump -XX -vvv -nn -i lo dst port 1313
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221014094444VKBRF9VA4ZTC3XHC0H)

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221014095240B870PN56YIK0BE2VH5)

（4）检查抓包命令是否以抓取到创建表的命令。在前台抓包命令打印的信息中可以看到抓取到之前的建表命令通过密文显示，说明通信已加密。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221014095307QS4AAE1OK52X906CF9)

## 如何更新某个用户所有列的统计信息，并记录更新统计信息时长？

【问题解决】

  1. 创建用来记录更新统计信息时长的表。



```
create table stat_history (beg_time TIMESTAMP,end_time timestamp,sql_str varchar2(500),table_name varchar2(200),col_name VARCHAR2(200));
```

  2. 更新所有列的统计信息，并将更新统计信息的时长写入创建的表中。



```
--更新所有列的统计信息
declare
v_sql varchar(4000);
v_begtime VARCHAR2(200);
v_endtime varchar2(200);
CURSOR c1 IS SELECT
       TAB.NAME                                             AS TABLE_NAME ,
       SYSCOL.NAME                                          AS COLUMN_NAME--,
FROM
       SYSOBJECTS AS TAB,
       SYSOBJECTS AS SCH,
       SYSCOLUMNS AS SYSCOL
WHERE
       SCH.ID =TAB.SCHID
   AND TAB.ID =SYSCOL.ID
   AND SCH.NAME = 'SYSDBA'
   AND SYSCOL.TYPE$ NOT IN ('BLOB','CLOB','TEXT')
   and TAB.NAME  IN(select  TABLE_NAME  from   ALL_TABLES WHERE OWNER = 'SYSDBA');
begin
 for i in c1
 loop
     v_sql :='stat 100 on "'|| i.TABLE_NAME ||'"("' ||i.COLUMN_NAME ||'");';
     --v_sql='stat 100 on SP_TS_BAKSET_REMOVE_BATCH(DEVICE_TYPE);';
 --print v_sql;
 v_begtime := sysdate();
 execute immediate v_sql;
 v_endtime :=sysdate();
--更新统计信息的时长写入创建的表中
 insert into stat_history VALUES (v_begtime,v_endtime,v_sql,i.TABLE_NAME,i.COLUMN_NAME);
 commit;
 end loop;
end;
```

3.查看统计信息更新时长。

```
select * from  stat_history;
```

## DEM 部署后，导入导出报错："java_library.path 路径不存在 dexp 执行程序"

【问题描述】：

dem 在部署完毕后，使用管理工具导入导出功能时出现报错："java_library.path 路径不存在 dexp 执行程序"

【问题解决】：

主要排查以下两方面内容：

  1. 检查环境变量配置是否有问题。
  2. 检查 \`catalina.sh\` 中的配置项 \`JAVA_OPTS\` 是否配置完整。添加 \`JAVA_OPTS\` 配置方法如下所示：



在 tomcat 安装目录下的 bin 目录下打开配置文件 `catalina.sh` 添加以下配置信息：

```
JAVA_OPTS="-server -Xms256m -Xmx1024m -Djava.library.path=/dm8/dmdbms/bin"
```

参数 `-Djava.library.path` 的值为数据库安装目录的 bin 目录地址。

## SQL 语句存在不可见字符导致语句执行失败

【问题描述】：

SQL 语句存在不可见字符 “M-oM-;M-?” 导致 sql 语句执行失败。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221020153541Y84S87Y1HGSRUXMRJY)

【问题分析】：

这种情况，一般就要检查是否存在不可见字符，对于普通的文本编辑器一般无法直接看到不可见字符，但是通过一些高级的编辑器或者是 Linux 系统上的 cat 等命令相关选项可以发现。如果只是直接 cat 文件是无法看到不可见的字符，需要将文件保存为 txt 文件再进行查看。

这里直接将文本内容保存到 txt 文件，然后拷贝到 Linux 系统中，使用 `cat -v xxx.txt | more ` 进行查看，就可以看到多出一串字符 “M-oM-;M-?”，如下：

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221020153522YMG5HSN4C26C70648T)

这个字符串是由于使用 UTF-8 带有 BOM 编码格式导致。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221020163638GXMDDM664UBOBLDP38)

【解决办法】

将文件编码格式转成 UTF8 无 BOM 编码格式，即可解决。可通过如下方式解决：

方法一：使用 IDE 工具或者高级编辑器工具将文件编码格式转换成无 BOM 格式。

例如：使用 editplus 工具进行格式调整，将文件编码格式转成 UTF8 无 BOM 编码格式。点击文本选择【文本编码】---> 选择【特殊文本编码】---> 选择格式转换为 UTF-8。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221020164738YTU8X1M2MUMV6MGMYH)

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202210201646042NKG3IUATCTYAZXQYH)

方法二：单个文件可以使用 vim 打开对应文件进行修改，执行 `shift+:` 然后 写入 `set nobomb`，然后保存退出。

修改后，再次查看该文件，字符 “M-oM-;M-?” 已消失。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221020170251H2TBDHIIM3CLSS2DZ8)

方法三：多个文件可以在 shell 脚本中使用 sed 命令将 “M-oM-;M-?” 换成对应的 16 进制字符。

例如：`sed -i '1s/^\xef\xbb\xbf//' no1.txt`

以下提供 16 进制字符查看方法：执行命令 `od -tx1 no1.txt | more` 可以以十六进制显示文件内容。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221020165226N7C74GV3D71H0VSP76)

```
od -tc no1.txt | more  ```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221020170504TNBKTS11GD4YV89079)

## 如何不停库移动用户表空间对应的数据文件

【问题解决】：

需要移动的表空间必须处于脱机状态，并且只可修改用户创建的表空间数据文件的路径（其中：system、roll 表空间不允许脱机）。例如修改 TBS 表空间数据文件路径，具体步骤如下：

  1. 查看表空间对应的数据文件。



```
SELECT TS.NAME, DF.PATH FROM V$TABLESPACE AS TS, V$DATAFILE AS DF WHERE TS.ID = DF.GROUP_ID;
```

  2. 修改 TBS 表空间状态为脱机。



```
ALTER TABLESPACE TBS OFFLINE;
```

  3. 修改表空间所对应的一个数据文件的路径。



```
ALTER TABLESPACE TBS RENAME DATAFILE ‘/dm8/data1/DAMENG/TB01.DBF’ TO ‘/dm8/data1/DAMENG1/TB01.DBF’;
```

  4. 修改 TBS 表空间状态为联机。



```
ALTER TABLESPACE TBS ONLINE;
```

至此表空间移动完毕。

如果修改 system、roll 表空间，则需要首先停库，拷贝所对应数据文件到新的文件目录，备份控制文件，通过修改控制文件里对应数据文件路径，再启动数据库实现。

> **注意**
>
> temp 路径不记录在控制文件里，若文件丢失，每次重启数据库会自动生成一个临时数据文件。.



## DBLINK 报错信息在实例日志中不显示

【问题解决】

若需在实例日志中打印 DBLINK 报错信息，则要提前修改 DBLINK 打印日志参数 ELOG_REPORT_LINK_SQL。方法如下：

  1. 执行以下命令开启 DBLINK 打印日志；



```
alter system set 'ELOG_REPORT_LINK_SQL' = 1;
```

  2. 同样的窗口运行报错的 DBLINK 语句；
  3. 数据库实例日志查看报错。



参数解释：

|**参数名**|**默认值**|**属性**|**说明**|
|---|---|---|---|
|ELOG_REPORT_LINK_SQL|0|动态，会话级|是否记录 DBLINK 执行的 SQL 到服务器日志文件中。0：不记录；1：记录|


## SQL 日志未按照 sqllog 配置文件大小生成

【问题描述】

配置好 sqllog.ini，打开日志功能后，发现生成的 log 文件并未按照 sqllog 配置文件大小生成，总是在文件达到 11M 后自动切换下一个 log 文件，并未按照配置生成 2G 的文件，即 SWITCH_LIMIT   = 2048 未生效，重新将 SVR_LOG 关闭重新开启，也未生效。

sqllog.ini 配置文件如下：

```
BUF_TOTAL_SIZE          = 10240         #SQLs Log Buffer Total Size(K)(1024~1024000)
BUF_SIZE                = 1024          #SQLs Log Buffer Size(K)(50~409600)
BUF_KEEP_CNT            = 6             #SQLs Log buffer keeped count(1~100)
[SLOG_ALL]
   FILE_PATH    = /dmlog/logcommit/     #sqllog存放位置
   PART_STOR    = 0
   SWITCH_MODE  = 2  
   SWITCH_LIMIT   = 2048   
   ASYNC_FLUSH   = 1   
   FILE_NUM = 30  
   ITEMS    = 0
   SQL_TRACE_MASK  = 1   
   MIN_EXEC_TIME = 0
   USER_MODE   = 0   
   USERS =
```

【问题分析】

当 SWITCH_LIMIT 参数在按照文件大小切换时，有效值范围是（1~2000），设置成 2048，超出有效范围，自动生成默认大小 11M。

【问题解决】

将 SWITCH_LIMIT 参数值修改在 1~2000 之间后，生成的 log 文件大小达到限制后会自动切换。

参数说明：

|**参数**|**默认值**|**说明**|**属性**|
|---|---|---|---|
|BUF_TOTAL_SIZE|10240|SQL 日志 BUFFER 占用空间的上限，单位为 KB，取值范围（1024~1024000）。|动态，系统级|
|BUF_SIZE|1024|一块 SQL 日志 BUFFER 的空间大小，单位为 KB，取值范围（50~409600）。|动态，系统级|
|FILE_PATH|../log|SQL 日志文件所在的文件夹路径。|动态，系统级|
|SWITCH_MODE|2|表示 SQL 日志文件切换的模式:0：不切换；1：按文件中记录数量切换；2：按文件大小切换；3：按时间间隔切换|手动|
|SWITCH_LIMIT|128|同切换模式 SWITCH_MODE 下，意义不同：1、按数量切换时，一个日志文件中的 SQL 记录条数达到多少条之后系统会自动将日志切换到另一个文件中。一个日志文件中的 SQL 记录条数达到多少条之后系统会自动将日志切换到另一个文件中。有效值范围（1000~ 10000000）；2、按文件大小切换时，一个日志文件达到该大小后，系统自动将日志切换到另一个文件中，单位为 M。有效值范围（1~ 2000）；3、按时间间隔切换时，每个指定的时间间隔，按文件新建时间进行文件切换，单位为分钟。有效值范围（1~ 30000）。|动态，系统级|
|ASYNC_FLUSH|1|是否打开异步 SQL 日志功能。0：表示关闭；1：表示打开。|动态，系统级|
|FILE_NUM|5|总共记录多少个日志文件，当日志文件达到这个设定值以后，再生成新的文件时，会删除最早的那个日志文件，日志文件的命令格式为 dmsql_实例名_日期_时间.log。当这个参数配置成 0 时，只会生成两个日志相互切换着记录。有效值范围（0~1024）。|动态，系统级|


## 如何通过 disql 抓取数据库中的活动会话 sql

【问题描述】

因为网络限制无法通过管理工具连接数据库，在只能通过 disql 连接数据库的情况下，如何抓取数据库中的正在运行的活动会话 sql，并分析其执行计划。除了查看 logcommit 还有什么办法？

【问题解决】

可以通过 spool 命令将查询结果输出到指定文件。

```
./disql SYSDBA/'"密码"'
SQL>spool '/home/dmdba/SQL_TEXT.txt'; ---控制台打印查询结果，并将查询结果输出到指定文件/home/dmdba/SQL_TEXT.txt
SQL>select sql_text,count(*) from v$sessions where state='ACTIVE' group by sql_text order by 2;
SQL>spool off ;----关闭spool
```

> **注意**
>
> 只有 SPOOL OFF 之后，才能在输出文件中看到完整的输出内容。 最后将想要查看 sql 的执行计划 ，在 sql 前加上 EXPLAIN
> 再执行即可查看该 sql 的执行计划。



## WARNING: rlog free space reserved failed,add or resize log file please

【问题描述】

数据库日志持续刷告警信息如下：

```
database P0000033904 T0000000000000127776 ckpt info adjust: ckpt_lsn(104870593524), ckpt_fil(1), ckpt_off(257687040), cur_lsn(104870595310)
database P0000033904 T0000000000000267396 WARNING: rlog free space reserved failed, add or resize log file please!
database P0000033904 T0000000000000127776 ckpt info adjust: ckpt_lsn(104870595165), ckpt_fil(1), ckpt_off(257974272), cur_lsn(104870596531)
database P0000033904 T0000000000000026956 WARNING: rlog free space reserved failed, add or resize log file please!
```

【问题解决】

redo 日志默认大小为 256M，2 个日志文件循环写。根据告警信息显示 redo 日志频繁切换，应调大或者增加 redo 日志。通过以下 SQL 可以调整 redo 日志大小。

```
alter database resize logfile '/dmdata/dmdbms/DAMENG/DAMENG/DAMENG01.log'  to 2048;
alter database resize logfile '/dmdata/dmdbms/DAMENG/DAMENG/DAMENG02.log'  to 2048
```

## 用户 AAA 如何操作用户 BBB 的分区表

【问题描述】

用户 AAA 如何操作用户 BBB 的分区表 BBB_FQ

【问题解决】

授予 AAA 用户操作 BBB 用户分区表 BBB_FQ 的权限即可。

用 SYSDBA 用户登录数据库，使用以下命令将 BBB 模式下的分区表 BBB_FQ 授予 ALL 权限给 AAA 用户。或者按最小权限原则授予 AAA 用户操作 BBB 模式下的分区表 BBB_FQ 的权限。

```
grant SELECT on "SYSDBA"."BBB_FQ" to "AAA";

grant INSERT on "SYSDBA"."BBB_FQ" to "AAA";

grant DELETE on "SYSDBA"."BBB_FQ" to "AAA";

grant UPDATE on "SYSDBA"."BBB_FQ" to "AAA";

grant REFERENCES on "SYSDBA"."BBB_FQ" to "AAA";

grant SELECT FOR DUMP on "SYSDBA"."BBB_FQ" to "AAA";

grant ALTER on "SYSDBA"."BBB_FQ" to "AAA";

grant INDEX on "SYSDBA"."BBB_FQ" to "AAA";
```

也可以通过管理工具授予对应权限，方法和普通表的授权方式一致。

## 操作系统报错：“No space left on device”

【问题描述】

在创建表空间文件的时，操作系统报错：“No space left on device”。使用 `df -h` 命令查看磁盘空间，发现磁盘空间有足够剩余。使用 mkdir 命令无法创建新文件。检查 SQL 语法并没有错误，表空间文件始终无法创建成功。

【问题解决】

操作系统不能创建新的目录和文件，但是磁盘空间却有空闲，一般是因为 inodes 文件数量被占满导致，可以使用 `df -i` 命令查看 Inodes 使用率。最直接有效的解决方法是查找到大文件并进行删除， linux 查找命令如下：

```
for i in 需要查找的目录; do echo $i; find $i |wc -l; done
```

## dm8-dm7 的 odbc 方式 dblink 连接报错：“[-2245]:DBLINK 加载库文件失败”

【问题描述】

配置 dm8-dm7 的 odbc 方式 dblink 连接，测试时报错：[-2245]:DBLINK 加载库文件失败。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221123160633TB4BUXLX8B3S8SQ6DW)

【问题解决】

将解压后的 ODBC 目录下的所有 .so 文件复制到数据库安装目录 bin 下，然后再修改属主和属组。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202211231607446LEK3PTPD9ABD35AM3)

```
[root@dsc1 bin]# chown dmdba:dinstall libodbccr.so libodbcinst.so libodbc.so
```

再次通过 dblink 查看 dm7 数据库中的表，可以成功查看。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202211231609013KHCASFG1ZU6M9ZAOL)

## 同一台机器部署多个 DEM 在访问时异常

【问题描述】

在同一台服务器上部署两个 tomcat，每个 tomcat 中都部署一个 DEM，并同时启动。在一台电脑上同一个浏览器下，分别访问两个 DEM，在第一个登陆成功之后，访问第二个项目，第一个项目就会自动退出。

【问题分析】

由于 IP 相同的两个 session 对应的 cookie 是一样的，其中 sessionID 就保存在 cookie 中，两个项目共用一个 cookie，但是只能存储一个 sessionID，所以导致出现了在第一个登陆成功之后，访问第二个项目，第一个项目自动退出。

【问题解决】

在两个 tomcat 的配置文件中修改 content.xml 文件，在 Context 节点上添加 sessionCookieName 属性给其赋与不同的值后即可同时访问两个项目。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221207100545FZRGRYX64JFCL0ER0J)

## 完全刷新物化视图恢复后物化视图原数据查询为空

【问题描述】

当物化视图中包括 DBLINK 远端表时,完全刷新物化视图过程中若远端库服务异常，恢复后物化视图原数据没有回滚数据查询为空。

【问题分析】

参数 DEL_HP_OPT_FLAG 默认值为 0 ，物化视图完全刷新默认采用 truncate 方式清除原始数据，刷新过程中出现异常无法进行回滚。

【问题解决】

可以通过 DEL_HP_OPT_FLAG 参数进行控制，当取值 16 时，完全刷新采用 DELETE 方式，若刷新过程中异常，能够进行回滚，保证物化视图数据不丢失，不影响上层应用查询。

参数说明：

|**参数**|**默认值**|**属性**|**说明**|
|---|---|---|---|
|DEL_HP_OPT_FLAG|0|动态，会话级|控制分区表的操作优化0：不优化；1：打开分区表 DELETE 优化；2：控制范围分区表创建的优化处理，转换为数据流方式实现；4：允许语句块中的间隔分区表自动扩展；8：开启对 TRUNCATE 分区表的优化处理；16：完全刷新时删除老数据使用 DELETE 方式支持使用上述有效值的组合值，如 7 表示同时进行 1、2、4 的优化|


## 达梦数据库管理工具使用“连接组”功能

【问题描述】

DBA 运维 N 套达梦数据库时，通过 IP 辨别易错，那么如何解决此问题呢？如下图所示，当数据库过多时难免会造成混乱，通过 IP 不方便运维人员识别。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221214091847XQ6RNIJTB55HV7P4G0)

【问题解决】

可以采用达梦数据库管理工具的“连接组”功能，来对数据库进行分类管理，具体方法如下：

  1. 点击管理工具对象导航栏右上角的【下三角】可以看到【配置连接组】选项，点击【配置连接组】。



![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221214092109LE0Z6A85ELHU1WMIAB)

  2. 点击【新建】进入【创建连接组】，选择想要配置到同一个组的数据库点击【增加】添加到【连接组内容】中，在【连接组名称】中自定义连接组名，配置完成后点击【确定】。其它数据库通过相同方法来配置连接组。



![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221214092406UDT0BM2QD811XEXCF1)

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221214092542HVWMEB9UZ30I23ADYS)

  3. 数据库连接组配置完成后点击【确定】。



![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221214093311T9TXF6K10UUVAYQ2FE)

  4. 再次点击管理工具对象导航栏右上角的【下三角】点击【显示方式】选择【连接组】，至此数据库连接组配置完成。



![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221214093639VB6XLZ2FT8HWK847MV)

配置完连接组，【显示方式】选择为【连接组】后可以看到数据库被划分到了不同的组中，这样更加便于运维人员管理数据库。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202212140940361EQN4FRPUXNAZWVGWA)

除此之外，用户在注册新的数据库连接时，也可以将数据库指定添加到已有的连接组中。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20221214095343A9T161ES022H5SVRLA)

## 重启数据库报错：“lic info is different between dm.key and sysinfo”

【问题描述】

安全版数据库更换正式 key 之后，重启数据库报错：“lic info is different between dm.key and sysinfo”。

【问题分析】

此报错是由于版本的安全类型不匹配导致。

【问题解决】

方法一：检查数据库版本和 key 的版本是否一致，如果不一致需更换为一致版本的 key。

方法二：确定版本无问题，可通过以下命令手动升级数据库的安全状态，只需做一次：

```
./dmserver <ini.path> upd_lic=1
```

## 磁盘实际使用空间大小和显示空间大小不一致

【问题描述】

/dmarch 实际磁盘使用空间 1T，但是 df -h 显示却已使用 1.8T。

【问题解决】

利用 lsof 命令排查，获取到占用文件的进程，对该进程进行处理，释放被占用文件，命令如下：

```
lsof +D /dmarch
```

> **注意**
>
> 使用 lsof 命令要用 root 用户，其他用户可能权限不够大从而找不全进程。



## dm_BAKERS_年月.log 日志文件过大

【问题描述】

dm_BAKERS_年月.log 日志文件大小在 5G 左右，数据库备份作业为每天全备，并且日志中平均 1min 会对 V$BACKUPSET 视图做如下的查询来监控备份。

```
select
        backup_name                                   as backup_name,
        to_char(backup_time, 'yyyy-mm-dd hh24:mi:ss') as backup_time,
        1                                             as non
from
        (
                select backup_name, backup_time from v$backupset order by backup_time desc
        )
        t
where
        rownum<11;
```

【问题分析】

查询 .V$BACKUPSET 视图需要调用备份接口去扫描指定的路径下的备份集，1min 一次，导致日志量过大。

【问题解决】

降低 `.V`$BACKUPSET`` 视图监控备份情况的频率 ，或者使用 `$backup_history` 替换 `$BACKUPSET` 来做监控。

## DM 到 DM 的 DBLINK 报错问题

问题一：

【问题描述】

DBLINK 连接时报错：“self instance(DMSERVER) not found in d:\dmdbms\data\DAMENG\dmmal.ini
dmserver startup failed, code = -9501 [MAL sys has not configured or serveris not enterprise version]."。

【问题解决】

  1. 通过以下 SQL 检查数据库是否为企业版：



```
select SERVER_SERIES from v$license；  --E代表企业版
```

  2. 检查 dmmal.ini 是否配置正确，注意文件扩展名要正确：



问题二：

【问题描述】

DBLINK 连接时报错：

```
nsvr_ini_file_read failed, [code: -9501]
MAL_INST_NAME:[DMSERVER] is duplicated in [d:\dmdbms\data\DAMENG\dmmal.ini]!
dmserver startup failed, code = -801 [Duplicate ini config option]
nsvr_ini_file_read failed, [code: -801]
```

【问题解决】

该问题是 dmmal.ini 配置文件中存在两个相同实例名的数据库导致，需修改其中一个数据库的实例名，即两个 MAL_INST_NAME = DMSERVER 名字不能一样。

```
 [MAL_INST1]
MAL_INST_NAME = DMWIN
MAL_HOST = 10.10.10.3
MAL_PORT = 5251
MAL_INST_HOST = 10.10.10.3
MAL_INST_PORT = 5236
[MAL_INST2]
MAL_INST_NAME = DMSERVER
MAL_HOST = 10.10.10.4
MAL_PORT = 5250
MAL_INST_HOST = 10.10.10.14
MAL_INST_PORT = 5236
```

补充 DM 到 DM 的 DBLINK 的三种创建方式如下：

```
--方式1 —mal_inst_host/mal_inst_port
create link “链接名” connect ‘DAMENG’ with “用户名” identified by “密码” using ‘实例IP地址/实例端口号’;
--方式2 —mal_host/mal_port
create link “链接名” connect ‘DAMENG’ with “用户名” identified by “密码” using ‘MAL IP地址/MAL 端口号’;
--方式3 —mal_inst_name
create link “链接名” connect ‘DAMENG’ with “用户名” identified by “密码” using ‘实例名’;
```

## 建表时报错：“列定义长度超长”

【问题描述】

在 create table 创建表时报错：“列定义长度超长”。

【问题分析】

DM 数据库在初始化时，默认页大小为 8KB，而一条记录的长度除大字段类型（clob、blob）以外不能超过页大小的一半，也就是说表一条记录的所有字段的总长度之和不能超过 4KB。页大小影响表每行数据的长度，超过则会报错。

可以使用以下 SQL 查询当前数据库页大小：

```
select page();
```

【问题解决】

重新初始化数据库，设置初始化参数 page_size=32，即设置页大小为 32K 或者在创建表时控制字段总长度不超过页大小的一半。

## manager 工具使用 root 用户打开过后，dmdba 用户无法正常打开

【问题描述】

在部分 Linux 环境下：manager 工具先使用 root 用户打开后，再使用 dmdba 用户打开会报错：

```
<title>Invalid Configuration Location</title>
Locking is not possible in the directory "/home/dmdba/dmdbms/tool/configuration/org.eclipse.osgi".
 A common reason is that the file system or Runtime Environment does not support file locking for that location. 
Please choose a different location, or disable file locking passing "-Dosgi.locking=none" as a VM argument.
/home/dmdba/dmdbms/tool/configuration/org.eclipse.osgi/.manager/.fileTableLock (权限不够)
```

【问题分析】

使用 root 用户启动后：`/home/dmdba/dmdbms/tool/configuration/org.eclipse.osgi/.manager/ ` 该路径属主属组被改为 root。再使用 dmdba 用户启动时，由于需要依赖上述文件，会提示权限不够。

【问题解决】

以下提供两种方法解决该问题，选取其中一种方法解决即可。

  1. 使用 root 用户执行以下命令修改属主和属组后即可使用 dmdba 用户启动 manager 管理工具。



```
chown -R dmdba.dinstall  /home/dmdba/dmdbms/tool/configuration/org.eclipse.osgi/.manager/
```

  2. 删除该临时目录：\`/home/dmdba/dmdbms/tool/configuration/org.eclipse.osgi/.manager\` 再使用 dmdba 用户也可启动 manager 管理工具。



## 非 DBA 角色用户如何跨模式创建模式对象

【问题描述】

非 DBA 角色用户无法跨模式创建/删除模式对象（如表、视图等）会报错“没有创建表权限”。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230215134841WTD9NBNVSXXXF2S2JP)

【问题解决】

授予用户 ANY 权限，具体步骤如下：

  1. 登陆 DBA 权限用户，通过以下命令查看 ENABLE_DDL_ANY_PRIV 值，若为 0，则表示此用户不能给其他  
用户授予和回收 DDL ANY 权限。



```
select * from v$dm_ini where para_name='ENABLE_DDL_ANY_PRIV';
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230215135148KQTBNWF4R3A9E2R0MU)

  2. 通过以下命令开启 DDL ANY 权限。



```
sp_set_para_value(1,'ENABLE_DDL_ANY_PRIV',1);
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230215135348RJ7KS0L1S6TBJFKZD2)

  3. 确认 ENABLE_DDL_ANY_PRIV 值修改成功，通过以下命令查出值为 1 表示修改成功。



```
select * from v$dm_ini where para_name='ENABLE_DDL_ANY_PRIV';
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230215135540785WZXLW5Z558D3A6K)

  4. 授予普通用户需要的 any 系统权限。比如此普通用户需要在其它模式下创建表，则通过以下命令赋予该用户 create any table 权限。授权成功后该普通用户即可在其他模式下创建表。



```
grant CREATE ANY TABLE to "AA";
```

  5. 授权完成后 DBA 用户，通过以下命令关闭 DDL ANY 权限。



```
sp_set_para_value(1,'ENABLE_DDL_ANY_PRIV',0)；
```

  6. 通过以下命令检查 DDL ANY 权限是否关闭成功，值为 0 表示关闭成功。



```
select * from v$dm_ini where para_name='ENABLE_DDL_ANY_PRIV';
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230215140232H8UQ5MRLYGA4Y7OO4L)

## DM 管理工具编辑错误

【问题描述】

在 DM 管理工具查询编辑框中，输入的字体变大，间距变长了，执行语句提示语法分析错误。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230215141116QG8LKSMO9Q3BZ2EN46)

【问题分析】

该问题是由于操作系统输入法切换为全角输入导致。

【问题解决】

检查操作系统输入法，在设置中切换全角为半角即可恢复正常输入。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230215141326AA9F2DHVLLR06JHOKV)

## 如何使表中同时包含聚集 KEY 和大字段

【问题描述】

该问题主要发生在默认为聚集索引的情况。

```
sp_set_para_value(1,'PK_WITH_CLUSTER',1);
CREATE TABLE TEST
(
id int primary key,
name varchar2(100)
);
--创建大字段列，报错
alter table TEST add column(image clob);
-3243: 第1 行附近出现错误:
表 [XB1] 中不能同时包含聚集 KEY 和大字段
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230223161827KP2B79JCDLS940NKOC)

【问题解决】

可以通过以下方法解决该问题。

  1. 添加一个临时字段；



```
alter table TEST add column(cs int);
```

  2. 临时字段创建聚集索引,自动将主键的聚集索引变为非聚集索引；



```
CREATE cluster INDEX index_test_cs ON TEST(cs);
```

  3. 删掉临时聚集索引；



```
drop index index_test_cs;
```

  4. 删除临时字段；



```
alter table TEST drop column cs;
```

  5. 添加大字段，成功。



```
alter table TEST add column(image clob);
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202303091025525NSOQGRCKZEKHCLUFN)

## DEM 中批量执行功能选择 ssh 类型时执行报错：无法解决密钥交换算法

【问题描述】

在 DEM 中新建批量执行，当选择 ssh 类型执行批量执行任务时，执行日志返回异常报错:"unable to reach a settlment of keyexchangalgorithms"。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230308112613TWV83T8XR8TSVFTM79)

【问题解决】

  1. 配置 \`/etc/ssh/sshd_config\` 文件，将页面提示的交换秘钥协议添加到配置文件中，根据实际情况屏蔽掉不安全的 KexAlgorithms；



![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202303081520318WM5AT6EU05XDIEGZL)

  2. 修改完成后重启服务。



```
systemctl restart sshd.service
```

可能会出现无法启动情况，使用 journalctl -xe 查看详细信息，将 Unsupported 的信息删除即可，步骤如下：

（1）执行 journalctl -xe 查看 ssh 不支持 diffie-hellman-group13-sha1；

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202303081127102QI7N7URQSSU9ON18A)

```
/etc/ssh/sshd_config
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230308112955UQGUDG90DD5EHCGBEH)

## DEM 中批量执行功能选择 ssh 类型时执行报错：更换有效认证方式

【问题描述】

DEM 中新建批量执行，当选择 ssh 类型执行批量执行任务时，执行日志返回异常报错:"exhausted available authentication methods"。

【问题解决】

  1. 排查 \`/etc/ssh/sshd_config\` 配置文件中中是否存在以下参数：



```
PasswordAuthentication  no，
PermitRootLogin  no
AllowUsers
DenyUsers
```

AllowUsers 表示允许 ssh 连接的用户，DenyUsers 表示禁止 ssh 连接的用户。

  2. 如果 DEM 执行 ssh 使用的是 root 账号密码，\`/etc/ssh/sshd_config\` 配置文件中需要如下设置；



```
PermitRootLogin yes,

PasswordAuthentication yes,
```

其中 PasswordAuthentication 参数在 `/etc/ssh/ssh_config` 配置文件中也存在，需要将注释去掉。

  3. 如果使用的是非 root 账号密码；



例如：使用 U1 用户。

需要在  `/etc/ssh/sshd_config`  文件中配置 ；

```
PasswordAuthentication yes 

AllowUsers  U1
```

PasswordAuthentication 参数在  `/etc/ssh/ssh_config`  配置文件中也存在，需要将注释去掉。

## dmagent 启动报错： dmagent may be runnin,but PID file could not be found!

【问题描述】

dmagent 在启动时报错： “dmagent may be runnin,but PID file could not be found!”

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230413093157G6G0UIOHY7YK111IRP)

【问题分析】

通过分析发现产生此问题的原因与 PID_FILE_PATH 环境变量未生效有关。

【问题解决】

在 /dmagent/service/DmAgentService 文件中将原来的 PID_FILE_PATH 复制一份，然后在开头增加 export ，形成如下图的效果，保证 PID_FILE_PATH 配置生效。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230413094033X19FRXCJBWTXVH4V2K)

修改完成后重新启动 dmagent。

## 系统包执行错误

【问题描述】

系统包已经存在，但是执行系统包出现报错。

```
SELECT DBMS_METADATA.GET_DDL('TABLE，T1，TEST'执行失败(语句1)
3325:第1352 行附近出现错误[-2207]:无法解析的成员访问表达式[SE_DBMS_METADATA_RETURN_DDL第1 行附近出现错误
[-3325]:包/对象[DBMS_METADATA]解析失败
```

【问题分析】

该问题一般出现在数据库版本升级后部分系统包无法使用，需要重建报错的系统包。

【问题解决】

方案一：重建报错的系统包：

```
SP_CREATE_SYSTEM_PACKAGES (0,'DBMS_METADATA');
SP_CREATE_SYSTEM_PACKAGES (1,'DBMS_METADATA');
```

方案二：重建所有系统包：

```
SP_CREATE_SYSTEM_PACKAGES(0);
SP_CREATE_SYSTEM_PACKAGES(1);
```

## 如何查询某用户下某张表上字段的具体统计信息

【问题描述】

查询某用户下某张表上字段的具体统计信息

【问题解决】

使用如下 SQL 可以查询某张表上所有字段的具体统计信息（若为空说明没收统计信息），便于优化时分析问题，判断某个字段的过滤性、空值个数、统计采样是否精确，以及信息收集时间。

```
select * from (
select o.owner,o.object_name,b.column_name,b.column_id,b.data_type,s.t_total,s.n_smaple,s.n_distinct,s.n_null,s.n_buckets,s.last_gathered
from sysstats s
inner join dba_objects o on s.id=o.object_id
inner join dba_tab_columns b on o.owner=b.owner and o.object_name=b.table_name and s.colid+1=b.column_id
where o.owner='用户名'
and o.object_name='表名'
and o.object_type='TABLE')
order by b.column_id;
```

## 没有 et 执行权限时如何查看执行计划代价？

【问题描述】

通常在创建普通用户时只授予 public,resource,vti,soi 权限，如果没有授予 execute on sys.et 权限，执行 et 过程会报错：[-5505]:No execute privilege on object [ET]，在没有 et 执行权限时如何查看执行计划代价？

【问题解决】

  1. session 级别开启 MONITOR_SQL_EXEC。



```
alter session set 'MONITOR_SQL_EXEC'=1;
```

  2. 执行待优化的 SQL，获取到 SQL 的执行 ID。
  3. 使用 et 过程中的查询 SQL，EXEC_ID 条件为 SQL 执行 ID，可以在没有权限的情况下查看执行计划代价，结果与 et 一致。



```
SELECT
       NAME AS "OP",
       TIME_USED AS "TIME(US)",
       CAST(TIME_USED * 100.0/SUM(TIME_USED) OVER() AS DEC(10, 2)) || '%' AS "PERCENT",
       RANK() OVER (ORDER BY TIME_USED DESC) AS "RANK",
       SEQ_NO AS "SEQ",
       N_ENTER AS "N_ENTER",
       MEM_USED AS "MEM_USED(KB)",
       DISK_USED AS "DISK_USED(KB)",
       HASH_USED_CELLS AS "HASH_USED_CELLS",
       HASH_CONFLICT AS "HASH_CONFLICT",
       DHASH3_USED_CELLS AS "DHASH3_USED_CELLS",
       DHASH3_CONFLICT AS "DHASH3_CONFLICT"
FROM
       V$SQL_NODE_HISTORY A,
       V$SQL_NODE_NAME B
WHERE
       A.TYPE$   = B.TYPE$
   AND EXEC_ID   = <SQL执行ID>
   AND TIME_USED > 0
ORDER BY 2;
```

## disql 中如何使用上下左右键

【问题描述】

默认情况下，在 Linux 系统中使用 disql 命令时，若使用键盘的上下键查找历史命令复用，会出现乱码，导致在 Linux 上编写 sql 语句不够便利，disql 中如何使用上下左右键？

【问题解决】

可以通过安装 rlwrap 的方法解决:

方法一：使用 yum 安装 rlwrap，具体方法如下：

  1. 使用 yum 安装 rlwrap。



```
yum install rlwrap readline readline-devel
```

  2. 配置环境变量并使环境变量生效。



```
##配置环境变量
cat >>/home/dmdba/.bash_profile<<-"EOF"
alias disql='rlwrap disql'
EOF

##使环境变量生效
source /home/dmdba/.bash_profile
```

方法二：使用源码安装 rlwrap。

rlwrap 依赖 readline 包，在安装之前需先检查操作系统是否安装有 readline 包，若系统无 readline 包，可使用 `yum -y install readline*` 命令安装 readline。

具体方法如下:

  1. 检查是否安装 readline。



```
rpm -qa | grep readline
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230511100724ORWR2LU0IRCYTL0J6O)

  2. 如果未安装 readline 可通过以下命令安装 readline。



```
yum -y install readline*
```

  3. 将下载好的 tar zxvf rlwrap-0.46.1.tar.gz 解压。下载地址可参考:https://github.com/hanslub42/rlwrap/tree/



```
tar zxvf rlwrap-0.46.1.tar.gz
```

  4. 进入解压好的目录，进行安装。



```
cd rlwrap-0.46.1/
./configure
make
sudo make install
```

  5. 配置环境变量并使环境变量生效。



```
##配置环境变量
cat >>/home/dmdba/.bash_profile<<-"EOF"
alias disql='rlwrap disql'
EOF

##使环境变量生效
source /home/dmdba/.bash_profile
```

## 部署 dem 时 agent 日志报错：“Failed to upgrade fail”

【问题描述】

在部署 dem 时，dem 未监控到主机，排查网络无问题，agent 日志报错：“Failed to upgrade fail”

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230525100834L3MQE5GDTJCE3WQCO1)

【问题分析】

出现该问题是 agent 所在机器和部署 dem 的机器时间不一致导致。

【问题解决】

将 agent 所在机器和部署 dem 的机器时间调整一致。

## DEM 监控数据库实例失败

【问题描述】

当 DEM 监控数据库实例失败时，如何排查原因。

【问题解决】

  1. 在 web 界面通过【资源监控】 -->【主机】，查看主机位置是否有感叹号，提示配置内外网信息，按照提示进行配置；
  2. 检查 DEM 服务器与数据库服务器之间网络是否存在问题；
  3. 检查数据库服务器 agent 服务是否启动， 日志是否有报错；
  4. 检查数据库服务器和 DEM 服务器是否配置时钟同步；
  5. 检查 dmagent 版本是否和 dem 匹配，如不匹配建议尝试从 DEM 资源包下载 dmagent 安装包进行部署。



## DPC 如何查询正在对外提供服务节点的会话数

【问题解决】

通过以下命令可以查询到 DPC 正在对外提供服务节点的会话数。

```
SELECT sf_get_ep_seqno(a.rowid) raft_id,
                       COUNT(*) ,
                        b.name
               FROM v$sessions a left join dpc_instance b on sf_get_ep_seqno(a.rowid)=b.RAFT_ID
          WHERE b.SYS_MODE !='STANDBY'
       GROUP BY sf_get_ep_seqno(a.rowid) ,
       b.name
       ORDER BY RAFT_ID ;
```

## 如何禁止修改表中指定的数据

【问题解决】

可通过创建触发器的方式解决，示例如下：

  1. 创建测试表并插入数据：



```
CREATE TABLE STU
(
ID INTEGER,
NAME VARCHAR(50))  ;

insert into stu VALUES (999,'aaa');--禁止修改id值为999的值
insert into stu VALUES (111,'bbb');
commit;
```

  2. 创建触发器实现自定义错误类型，设置条件禁止修改或删除。



```
create or replace trigger tri_stu
after  update or delete of  id  on stu
for each row
begin
    if :old.id=999  then
    raise_application_error(-20002,'该表不允许删除或修改id=999的值');
    elseif   :new.id=999 then
    raise_application_error(-20001,'该表不允许出现第二个id=999的值');end if;
end;
```

  3. 测试。



```
update stu set id =999 where name ='aaa';---20002: 该表不允许删除或修改id=999的值
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230526165154PP8HUG0JB5LQWMMQXV)

```
delete stu where id=999;---20002: 该表不允许删除或修改id=999的值
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230526165311EDYHNFURNIOLEHHQ67)

```
update stu set id =999 where id =111;---20001: 该表不允许出现第二个id=999的值
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202305261654344RMTN2P15Y8RMQE92K)

## 如何查询用户中所有表所有列的注释、列类型、列长度、是否允许为空、缺省值

【问题解决】

可以参考以下 SQL 进行查询：

```
SELECT
       TAB.NAME    AS "表名",
       SYSCOL.NAME AS "列名",
       SYSCOL.TYPE$
       ||'('
       ||SYSCOL.LENGTH$
       ||')'            AS "列类型and列长度",
       SYSCOL.NULLABLE$ as "是否为空"     ,
       SYSCOL.DEFVAL    AS "缺省值",
       COMM.COMMENT$
FROM
       SYSOBJECTS AS TAB,
       SYSOBJECTS AS SCH,
       SYSCOLUMNS AS SYSCOL,
       SYSCOLUMNCOMMENTS as COMM
WHERE
       SCH.ID   =TAB.SCHID
   AND TAB.ID   =SYSCOL.ID
   AND SCH.NAME = 'SYSDBA'
   AND SYSCOL.NAME = COMM.COLNAME
   and TAB.NAME IN
       (
               select TABLE_NAME from ALL_TABLES WHERE OWNER = 'SYSDBA'--用户名
       )
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230526170028FO7JS7MMOW1VYU3LQJ)

## 普通数据库用户登录报错：“-2106 ：无效的表或视图名【login_history】”

【问题描述】

在新迁移完数据和数据库对象后或者删除过表后，SYSDBA 用户可以正常登录，当普通数据库用户登录时报错：
“错误号：-2106 错误消息：无效的表或视图名【login_history】”。

【问题分析】

该问题可能与创建了库级触发器 LOGIN 有关，如下;

```
CREATE TRIGGER  "LOGIN_AUDIT"
AFTER LOGIN
ON DATABASE
BEGIN
INSERT INTO  login_history SELECT 1;
COMMIT;
END;
```

当创建该触发器后用户在登录时可能会出现如下报错的情况。

```
用户登录报错
错误号:   -7160
错误消息: 对象[LOGIN_AUDIT]处于无效状态
```

【问题解决】

  1. 检查所有用户下是否创建如上事件 LOGIN 的库级触发器。
  2. 使用 SYSDBA 用户登录，禁用或删除所有该类型 (LOGIN) 的触发器。



## DEM 管理平台告警信息提示：连接状态-失败

【问题描述】

DEM 管理平台相关数据库服务器发出告警信息提示：连接状态-失败，一分钟后自动恢复正常。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230615155632HXDTLJ00WPVKK6WM6G)

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230615155653C92EY1NY1L3XHBVBAS)

【问题分析】

通过 nmon 日志分析故障时间段服务器网络、日志信息、磁盘监控等信息，发现该告警原因主要是服务器在 3:00 时进行数据增量备份时瞬间文件读速度高，导致 DEM 在这一分钟左右时间无法获取到数据库的状态而发出告警。

【问题解决】

在数据备份时进行读速度限制，可通过在备份语法中添加 LIMIT READ SPEED 来设置数据备份时的读取速度，单位为 MB/S，默认值为 0 表示无限制。在备份作业任务中也可以进行设置，推荐限速使用 200-300MB/s。在备份限速 300MB/s 时，文件瞬间读速度可以控制在 500MB/s 以下（该速度值仅供参考，实际值与服务器的 CPU、内存、磁盘读写速度和网络带宽有关）。

例如：

```
BACKUP DATABASE '/home/dmdba/DAMENG/dm.ini' FULL BACKUPSET '/home/dmdba/dmbackup/DB_FULL_DAMENG_2023061601' limit read speed 300 compressed level 1 parallel 2;
```

## 如何查询包、存储过程、函数的具体执行情况？

【问题解决】

可通过 V$DMSQL_EXEC_TIME 视图来查看包、存储过程、函数的具体执行情况，使用该视图需要开启 ENABLE_MONITOR_DMSQL=1，该参数默认开启。具体方法如下：

  1. 执行完成包、存储过程、函数后获取到对应的执行号。



![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230629143105KLNQD8ND67U2TQNMZA)

  2. 获取到执行号后可通过以下 SQL 查看包、存储过程、函数的具体执行情况。



```
select * from V$DMSQL_EXEC_TIME where exec_id=执行号 order by level,TIME_USED DESC;
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230629143253I2WM1YLM8ER53XDNTI)

通过该视图 V$DMSQL_EXEC_TIME 可以查看到语句类型、调用方法名、包的执行层次、方法循环次数、方法执行时间、SQL 语句等信息。详细参数说明可参考《 DM8 系统管理员手册》中视图 DMSQL_EXEC_TIME.

## window 环境下通过管理工具添加 IP 限定只允许本机登录时报错

【问题描述】

数据库及管理工具都在 window 环境下，在连接限制的 IP 中，添加本机 IP localhost 时，报错："无效的 IP 地址"。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230706093800MOIR5SHGZCKVRH2KML)

【问题解决】

  1. 可将 localhost 改为 127.0.0.1 进行添加。
  2. 可以尝试升级数据库版本来添加 localhost，但 localhost 添加成功后会显示为 127.0.0.1。



## hash 分区表进行 DDL 和 DML 操作报错:“锁超时”

【问题描述】

在 hash 分区表存在较大业务量时，进行 DDL 和 DML 操作会报错：“锁超时”。使用 jmeter 模拟业务压测时，对 hash 分区表添加分区，发现对 hash 分区表存在锁。

【问题分析】

由于 hash 分区表在添加分区时会对某个分区中的数据进行数据平衡，因此该锁仅针对于某个数据减少的分区上锁，而并非整个 hash 分区表。

【问题解决】

若向存在大量业务的 hash 分区表进行 DDL 和 DML，可通过尽量扩增分区来解决此问题。

> **注意**
>
> 对列存 hash 分区表添加分区时，数据是从第一个分区开始将数据的一半分到新的分区中。若原始分区数为 N，则当新增分区数为 2N
> 后，再次增加新分区，分区从第 N+1 个分区开始将数据的一半分到新的分区中。



## DPC 集群中添加分区时报错："-3806: 表依赖于分区组，不能做该 ALTER 操作"

【问题描述】

在 DPC 集群上基于分区组创建 hash 列存分区表，对 hash 列存分区表进行添加分区时报错："-3806: 表依赖于分区组，不能做该 ALTER 操作"。

【问题分析】

根据分区组的限制："基于分区组创建的表，无法增删分区"，由此说明上述报错为正常提示。

【问题解决】

根据手册中描述："删除分区组后，基于该分区组创建的表对象不会被删除，但是表的 DDL 属性会发生变化，不再依附于分区组"，因此删除该分区组并不会影响基于分区组创建的表的数据分布和存储位置。可通过以下方法绕过该报错：

  1. 删除分区组;
  2. 对基于分区组创建的表进行增删分区操作；
  3. 重建分区组。



示例：

  1. 准备分区组和分区表。



```
--创建分区组
create partition group tpch_pg partition by hash(int) partitions 72 
storage (on (TEST_RAFT1,TEST_RAFT2,TEST_RAFT3,TEST_RAFT4,TEST_RAFT5));

--创建分区表
CREATE huge TABLE LC_TEST
(
"C0" INT,
"C1" VARCHAR(30),
"C2" VARCHAR(20),
"C3" date default sysdate) using partition group tpch_pg by (C0);
```

  2. 测试对依赖于某个分区组的列存 hash 分区表进行添加分区操作时会报错：“-3806: 表依赖于分区组，不能做该 ALTER 操作”。



```
ALTER TABLE LC_TEST add PARTITION part5;
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230727092530SE5KAEM1WFUF0VNPLT)

  3. 绕过该报错。



  3.1 获取分区表依赖的分区组

在 manage 中选中”分区表”，右键”属性”,点击”DDL”选项，可以看到分区表依赖的分区组。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/2023072709300067R64QNUHXV8Q1C93U)

  3.2 获取分区组的创建语句。

```
select PARTGROUPDEF('SYSDBA','TPCH_PG');
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230727093109LTM1RKPQL9W1AWGSG0)

```
--分区组的创建语句
CREATE PARTITION GROUP TPCH_PG PARTITION BY HASH( INT ) PARTITIONS 72 STORE IN( TEST_RAFT1,TEST_RAFT2,TEST_RAFT3,TEST_RAFT4,TEST_RAFT5)
```

  3.3 删除分区组。

```
drop partition group tpch_pg force;
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230727093235Q48O41P6FBTVAGK0K5)

  3.4 对分区表增加分区。

```
ALTER TABLE LC_TEST add PARTITION part5;
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230727093317H25SDCPFHRM1UWLRD9)

  3.5 进行重建分区组。

```
CREATE PARTITION GROUP TPCH_PG PARTITION BY HASH( INT ) PARTITIONS 72 
STORE IN( TEST_RAFT1,TEST_RAFT2,TEST_RAFT3,TEST_RAFT4,TEST_RAFT5)
 STORAGE (ON (TEST_RAFT1, TEST_RAFT2, TEST_RAFT3, TEST_RAFT4, TEST_RAFT5),HASHPARTMAP(1));
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202307270933532C3AHTR16XLV08HC1R)

## 无法对 DPC 集群进行滚动升级

【问题描述】

使用 DEM 的默认设置搭建带副本的 DPC 集群时，无法对 DPC 集群进行滚动升级。

【问题分析】

使用 DEM 的默认设置搭建带副本的 DPC 集群时，同一台机器会存在多个实例，并使用同一个执行码，而 DPC 集群滚动升级的前提条件为每个实例拥有独立执行码。

【问题解决】

只有在使用 DEM 搭建 DPC 集群时，在"实例规划"步骤中，手动选择了"独立执行码"选项，这个选项会使同一台机器上的每个实例单独拥有一个执行码，这样才能够进行 DPC 的滚动升级操作。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202307271011455FKGXE5SRHTAQWA2SY)

## 如何配置秒级调度作业

【问题解决】

  1. TIMER_TRIG_CHECK_INTERVAL 参数修改为 1。
  2. 创建秒级调度作业。



```
CREATE TABLE TEST_TI(ID INT IDENTITY(1,1),CREATETIME TIMESTAMP(6));

BEGIN
DBMS_JOB.SUBMIT ( 1, 'INSERT INTO SYSDBA.TEST_TI(CREATETIME) VALUES(NOW);', '2023-06-26 14:23:55', 'sysdate + 1/86400', true, 0 );
END;
```

参数说明：

|**参数**|**属性**|**默认值**|**说明**|
|---|---|---|---|
|TIMER_TRIG_CHECK_INTERVAL|动态，系统级|60|服务器端检查触发器是否触发的时间间隔，单位为秒，即每过设置的秒数检查触发器是否需要触发，取值范围 1~60。|


## DPC 集群扩展节点报错：“数据还原失败”

【问题描述】

在使用 dem 扩容 BP1 RAFT 组时，新节点无法通过 BP1 RAFT 组中主节点的备份进行还原，报错“ BP1_D 数据还原失败”。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230810105659NXCXFEYPTK5CPQHTTS)

【问题分析】

该报错是由于 dmagent 是使用 root 普通用户权限启动导致。

【问题解决】

使用 dmdba 用户重新启动 dmagent 程序，再次进行扩容可以扩容成功。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230810110425O3CB4DBN3XWO0NFQBV)

## 通过 ET 工具查看操作符的执行时间，发现有非该语句的执行计划操作符

【问题描述】

在通过执行号查看 sql 语句每个操作符的执行时间时，发现有非该 SQL 语句执行计划的操作符。

具体步骤如下：

  1. SYSDBA 用户开启 SQL 监控，使用 ET 方法查看执行操作符及耗时情况；



```
/**开启系统监控**/
SP_SET_PARA_VALUE(1,'ENABLE_MONITOR',1);
/**开启时间监控**/
SP_SET_PARA_VALUE(1,'MONITOR_TIME' ,1);
```

  2. 打开操作符、虚拟机栈帧、执行计划节点的监控，选择打开系统级或者会话级；



```
/*系统级，对所有会话生效*/
SP_SET_PARA_VALUE(1,'MONITOR_SQL_EXEC' ,1);

/*会话级，只对本会话有效*/
SF_SET_SESSION_PARA_VALUE('MONITOR_SQL_EXEC' ,1)
```

  3. 查看 update 语句执行计划；



```
explain UPDATE T_1 SET NAME='MIKE' WHERE ID=1;
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230810142823G5FGCRQNL9V9TM8H4J)

  4. 执行该 sql 并查看 et，发现有不属于该语句执行计划的操作符。



![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230810141608UCG2JXFAYNHMFIXDZ5)

【问题分析】

分析执行操作符，推测该现象可能是有触发器之类的对象造成，通过检查发现涉及到的表上存在触发器。

检查表 T_1 存在触发器。

```
SELECT * FROM DBA_TRIGGERS WHERE OWNER='SYSDBA' AND TABLE_NAME='T_1';
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230810142329EO3FW05OBAJYVCM5A9)

【问题解决】

sql 语句的执行号操作符信息，同时会包含该语句所触发的触发器执行信息，所以此现象为正常现象。

## 数据库日志报错：“pthread create error in os_thread create with 11”

【问题描述】

数据库日志报错：“pthread create error in os_thread create with 11”，数据库无法登录。

【问题分析】

排查发现安装部署数据库时未对资源限制进行正确设置，其中 processes 资源设置太小导致线程被用完后无法创建线程。

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202308101534475UYLCL6DT6S9EUZPPG)

【问题解决】

可以临时通过 prlimit 动态修改 processes 资源。例如数据库进程号为 16473，通过以下命令动态修改 processes 资源设置。

```
prlimit --nproc=65536:65536 --pid 16473
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20230810153237ZL6JTUX4OGN01N9QUF)

动态修改 processes 资源完成后，还需要在 /etc/security/limits.conf 中永久修改，以便后续重启生效。

补充命令：

```
top -H -p <pid>  --查看特定进程下的线程运行情况
ps -T -p <pid>  --查看特定进程下的线程运行情况
ps -T -p <pid> |wc –l  --查看进程运行情况是否很多线程占用
```

## 管理工具中批量执行 SQL 时遇到报错如何继续执行

【问题描述】

在 DM 管理工具中批量执行一些 sql 时，中途有些 sql 执行报错，即停止，无法继续执行后面的 sql。如何在批量执行 SQL 时遇到报错不停止执行。

【问题解决】

可通过设置 DM 管理工具“出错后继续执行”来解决，设置方法如下：

在 DM 管理工具中点击【窗口】选择【选项】点击【查询分析器】勾选【出错后继续执行】保存设置。

![df33834b58819be2ad6f3583ff14f2e3_20230817095135P52JTKBBT8ZSR93XBY.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121608420LZ5Q8NYIFM0QDZARK)

## 没有 [DBA_INDEXES] 对象的查询权限

【问题描述】

SYSDBA 授予普通用户 soi，svi，vti，select any dictionary 权限后仍然没有查询 DBA_INDEXES 视图的权限。

![b9b9e75db51b495cc2532954513ee777_20230817100159BXUSZLABHIT9LY6M4U.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121612491DZ6I1PXA874P5WNWN)

【问题分析】

在达梦中 dba_ 开头的数据集仅为普通视图，授予的权限都是与系统字典和系统动态视图相关的权限，

按照普通视图的权限授予用户查询权限即可。

【问题解决】

授予用户 TEST 普通视图 DBA_INDEXES 的查询权限。

```
GRANT SELECT ON SYS.DBA_INDEXES TO TEST;
```

## 数据库日志报错：“No space left on device”

【问题描述】

数据库运行正常但日志报如下错误信息：

```
2023-08-14 14:43:10.031 [ERROR] database P0000006615 T0000000000000006681  pwrite error! err no: 28, ret: -1, fd: 47, offset: 28893184, buf: 0x89ad1306, count: 1045081
2023-08-14 14:43:10.031 [ERROR] database P0000006615 T0000000000000006681  os_file_write_by_offset_normal [pwrite] error! handle: 47, offset: 28890426, bytes_to_write: 1047839, bytes_written: -1, code: 28, desc: No space left on device
```

【问题分析】

该报错为 sqllog.ini 文件中配置的 SQL 日志保存目录空间不足导致报错，不影响数据库服务正常运行和进行数据提交。

【问题解决】

排查对应的 sqllog.ini 文件中配置的 SQL 日志保存目录磁盘空间是否可满足切换和生成日志信息的条件，如果 SQL 日志保存目录磁盘空间不满足 SQL 日志的生成和切换需尽快清理磁盘空间或扩盘。

## 创建用户时报错：“无效的用户名 [TEST1]”

【问题描述】

创建 TEST1 用户时报错：“无效的用户名”。

![768ba79018a460385f517d95b5649b0b_20230817103600B1B2DIEB8KVQ2ROID0.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112161851PGXZCQNWJFU2L2UUNK)

【问题分析】

创建用户的语句语法正确，当创建的用户已存在时应该报错：“对象[TEST]已存在”，此处报错：“无效的用户名 [TEST1]”，可能是有同名的 TEST1 模式存在的缘故。

【问题解决】

通过以下语句查看是否存在名为 TEST1 的模式：

```
select
        SCH_OBJ.NAME SCH_NMAE,
        USER_OBJ.NAME OWNER  ,
        SCH_OBJ.CRTDATE
from
        (
                select NAME, PID, CRTDATE from SYSOBJECTS where TYPE$='SCH'
        )
        SCH_OBJ,
        (
                select NAME, ID from SYSOBJECTS where TYPE$='UR' and SUBTYPE$='USER'
        )
        USER_OBJ
where
        SCH_OBJ.PID=USER_OBJ.ID
ORDER BY
        SCH_OBJ.NAME;
```

![88bcc4dbc34419e73d56ec2bb8d6b312_20230817104237H26FLKEB4KMA6DR1Y8.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112162037Q8IOSRO3Y64O7XBEHQ)

发现 TEST1 模式存在，属于 SYSDBA 用户，可以选择换用户名或者备份该模式后清除该模式再重新创建用户。

## 普通用户如何拥有关闭自己会话的权限

【问题描述】

普通用户没有权限执行 sp_close_session 关掉会话，并且该操作无法单独授权给普通用户。普通用户在不授予 DBA 权限时如何才能关闭自己的会话。

![7c1cae5a6e10f5470f9c5a1e7f96721e_20230824092805YKY4RJHKUOXQZ8DBAK.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121621250834I0GRM13SZHJFBQ)

【问题解决】

可以使用具有 DBA 权限的用户创建一个自定义的存储过程来实现普通用户杀会话的需求，同时在存储过程中限制只能关闭用户自己执行的会话，避免错误关闭其他会话。示例如下：

  1. 普通用户无法关闭自己打开的会话。



![39b0488db77f1c92f21133d7b632f3b3_20230824093808ZRKUM3TO9RZZOH4FRF.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121623511CZCKGSN5LM4VJZXNP)

![104eb4ee4965f18cf15ae8fd65575b74_20230824093856XX2LID4FYIERHI6ZJM.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112162357FJIPTAOCCBGOSHJAT8)

  2. 使用具有 DBA 权限的用户创建存储过程，普通用户调用该存储过程可以杀掉自己打开的会话。



```
create or replace PROCEDURE close_user_session(session_id bigint) as
curr_name varchar(32);
sess_name varchar(32);
BEGIN
--校验用户，只能杀自己执行的
select user into curr_name;
select user_name into sess_name from v$sessions where sess_id=session_id;
if curr_name==sess_name then
sp_close_session(session_id);
else  
print ' ';
print '执行失败,只能关闭当前用户连接的会话!!!' ;
end if;
EXCEPTION
WHEN NO_DATA_FOUND THEN
print ' ';
print '执行失败,没有找到对应的会话 !!!';
WHEN others THEN
print ' ';
print  SQLCODE||' '||SQLERRM;  
end;
```

  3. 将存储过程的执行权限授权给普通用户。



```
grant exec on close_user_session to test;
```

  4. 测试普通用户 TEST 调用该存储过程关闭会话。



```
sysdba.close_user_session('166463576');
```

![e2eeede6a4458c9deeb734635f9a4290_202308240946467VRTRWU8DMW8L8VGTR.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112162536UIOU97B4FW90Y786C3)

会话已断开

![d2d553d8710286a5c0ac02c3fe3b0a1f_202308240947538DL7IOW8V3PX77GTOK.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112162552YR3S20COA2ZZ0DH6ZH)

  5. 测试普通用户关闭非自己打开的会话。



```
sysdba.close_user_session('140361077060808');
```

![5d060249d9c0407834f4bb66d1f98eb6_20230824094957S5QEX4SDE168TVXSDT.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112162639EZTXZ9OALM2PF9DTG5)

关闭会话失败。

![20fdb88ee89a55703844176e93c54382_202308240951168ZCHOMXTBR2XY256NU.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112162719WRRFG3FVLGG8YXC5Z9)

普通用户通过调用该存储过程可以杀掉自己打开的会话，不可以杀掉非自己打开的会话。

## 将表及其索引移动到其它表空间时报错

【问题描述】

业务表数据存储在 MAIN 表空间中，在将业务表移动到指定的表空间时报错，如下所示：

```
ALTER TABLE DEM.DMA_DATABASE_SQL_LOG_FILE MOVE TABLESPACE DMDEM;
执行失败(语句1)
-2723: 仅当指定列列表，且SET IDENTITY_INSERT为ON时，才能对自增列赋值
```

【问题分析】

通过查看表建构发现需要移动的表中某个字段存在自增长的列，当直接移动带有自增列字段的表时，会报上述错误，无法移动表。

![a7f91e08ce666deb525c6a78646000ba_202309141441081OLRGMV7VK9PGOHTCT.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112162832BJWYOOW5HMIPOM4K3H)

【问题解决】

可通过设置“允许将显式值插入表的自增列”来实现移动带有自增长列的表，设置 SET IDENTITY_INSERT 为 ON 即为“允许将显式值插入表的自增列”，具体语法如下所示：

```
/*设置 DEM 模式下表 DMA_DATABASE_SQL_LOG_FILE 允许将显式值插入表的自增列*/
SET IDENTITY_INSERT DEM.DMA_DATABASE_SQL_LOG_FILE ON;
/*移动 DEM 模式下表 DMA_DATABASE_SQL_LOG_FILE */
ALTER TABLE DEM.DMA_DATABASE_SQL_LOG_FILE MOVE TABLESPACE DMDEM;
```

![7e9d6bfdf3184bce1c89628d3efa6395_20230914143926L9E1X2X1X1IX6LA8T5.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121629100UQ9C7EXDCEOGNKYY0)

## 使用管理工具“编辑数据”功能按钮报错

【问题描述】

使用管理工具“编辑数据”功能按钮，提示:“结果集不可更新，请确认查询列是否出自同一张表，并且包含值唯一的列”，报错截图如下:

![1a9c7492b94f777b58cb308392d22c2e_202309211058411JTWSR0WCJRBEG65F2.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112162954RZIK2YQC3S6XHRMXEK)

【问题解决】

以下提供 4 种解决办法：

创建测试表：

```
create table tablel (
                c1 int,
                c2 varchar(10), 
                c3 varchar(10)
                ); 
  
insert into tablel values(1,'A','aa');
insert into tablel values(2,'B','bb');
insert into tablel values(3,'C','cc');
insert into tablel values(4,'D','dd');
commit;
```

方法一：添加主键约束；

```
alter table "SYSDBA"."TABLEl" add constraint PK_C1 primary key("c1")
```

![7fb240ef8c208eacb203297dd9f61162_20230921110307RR0U5V7XX8ZS0UUBVW.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112163257KGNK84CW5F674YU4FE)

![df4dafb71365a067b30e4bf463140eb9_20230921110332WO14EA21XU75JCSH6G.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112163306GUFYTBGTO70NMMNKX6)

可在结果集进行编辑。

方法二：添加唯一约束；

```
alter table "SYSDBA"."TABLEl" add constraint "CONS_UNO_C2" unique("C2")
```

![cac06308ea679dfbaeb8d337ca94582a_20230921110548F72YHF7WLAUH33BEJO.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121633349FFTTZZDL50N4F2KZP)

可在结果集进行编辑。

方法三：创建唯一索引；

```
create unique index "IDX_UNQ_C1" on "SYSDBA"."TABLEL"("C1");
```

![9175a5589b717021dd9973c21f040f2e_2023092111074190NAU1PTHCTEN7Z5RU.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121634490PZB8WEI5CZI54UKYL)

可在结果集进行编辑。

方法四：查询语句附带对 rowid 的查询

```
select rowid,* from tablename；
```

![a9c4e5f34586d2620b437ad5d76b7d53_202309211108414V5PWHY6TW98UPF51P.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112163525TWKS1215XHIPIDPCAO)

可在结果集进行编辑。

## 使用 DEM 默认加解密引擎对密码进行加密报错

【问题描述】

使用 DEM 默认加解密引擎对密码进行加密：

```
java -cp demsdk.jar com.dameng.dem.server.util.DefaultEncryptEngine encrypt "xxxxx"
```

报错：”错误: 找不到或无法加载主类 com.dameng.dem.server.util.DefaultEncryptEngine“。

【问题分析】

该问题可能是由于相应的文件不存在，或者权限不足导致。

![24246f0358adf71c118f69d000974dd3_20230926110357N0UZJ0Y0V6R4ENKQHD.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121638078WKJBEQU6VU9UXCLZF)

DEM 版本对应的 demsdk 文件名字不一定是 demsdk.jar ，可能带了版本号，比如：demsdk-7.1.5.jar ，一般位于 tomcat 下的 webapps/dem/WEB_INF/lib

【问题解决】

保证对应文件的权限足够，将对应的文件拷贝到当前目录或者加密命令里并使用绝对路径，执行如下命令：

```
java -cp /home/dmdba/dmdbms/apache-tomcat-8.5.78/webapps/dem/WEB-INF/lib/demsdk-7.1.5.jar com.dameng.dem.server.util.DefaultEncryptEngine encrypt "xxxxx"
```

## 达梦数据库如何排查阻塞

【问题描述】

达梦数据库如何快速排查是否存在阻塞并关闭造成阻塞的会话。

【问题解决】

  1. 通过 v$trxwait 视图查询阻塞者事务 ID；



```
select id,wait_for_id,wait_time,thrd_id from v$trxwait;
```

  2. 将得到的造成阻塞的事务 ID wait_for_id 代入 v$sessions 进行查询；



```
select sess_id,sql_text,state,trx_id from v$sessions where trx_id='wait_for_id';
```

  3. 通过得到的会话信息确认是否可以关闭阻塞者会话，如果可以关闭可通过执行下面语句关闭该会话。



```
sp_close_session(sess_id);
```

## 如何仅收集新增分区的统计信息

【问题描述】

有的分区表很大，每天或者每个月新增一个分区，全表收集统计信息耗时较长，是否支持仅收集新增分区的统计信息？

【问题解决】

可以使用 DBMS_STATS 包中的 GATHER_TABLE_STATS 过程来收集指定分区的统计信息。

使用方法示例如下：

  1. 创建分区表：



```
DROP TABLE IF EXISTS T_PART;   --删除T_PART 测试分区表
-- 创建测试用的分区表T_PART,使用CUR_DATE字段进行范围分区
CREATE TABLE T_PART
(ID INT,
CUR_DATE DATE,
COL_A VARCHAR(10)
)
PARTITION BY LIST (CUR_DATE)
(
 PARTITION T_PART_1 VALUES (DATE'2023-08-01'),
 PARTITION T_PART_2 VALUES (DATE'2023-08-02'),
 PARTITION T_PART_3 VALUES (DATE'2023-08-03')
);  
-- 插入数据
INSERT INTO T_PART SELECT ROWNUM,DATE'2023-08-01','A' FROM DUAL CONNECT BY ROWNUM < 101;
INSERT INTO T_PART SELECT ROWNUM,DATE'2023-08-02','A' FROM DUAL CONNECT BY ROWNUM < 201;
INSERT INTO T_PART SELECT ROWNUM,DATE'2023-08-03','A' FROM DUAL CONNECT BY ROWNUM < 301;
-- 收集统计信息
BEGIN
  DBMS_STATS.GATHER_TABLE_STATS(OWNNAME          => 'SYSDBA',       -- 方案名
                                TABNAME          => 'T_PART',       -- 表名
                                ESTIMATE_PERCENT => 100,            -- 采样率
                                DEGREE           => 2);             -- 并行度
END;
```

  2. 查看统计信息



```
SELECT B.OBJECT_NAME,SUBOBJECT_NAME,OBJECT_TYPE,A.* 
  FROM SYSSTATS A, 
       ALL_OBJECTS B 
 WHERE A.ID = B.OBJECT_ID
   AND B.OBJECT_NAME ='T_PART' ORDER BY ID,COLID;
```

![75ed9f8e6a5a709a0390b8f0a32c8405_202311030909524CLV6XKRUFHXBYZW7O.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112164517Q6V84JCRGV733YQT4K)

  3. 新增分区并插入数据



```
-- 新增分区
ALTER TABLE T_PART ADD PARTITION T_PART_4 values(DATE'2023-08-04');
ALTER TABLE T_PART ADD PARTITION T_PART_5 values(DATE'2023-08-05');
ALTER TABLE T_PART ADD PARTITION T_PART_6 values(DATE'2023-08-06');

-- 插入数据 
INSERT INTO T_PART SELECT ROWNUM,DATE'2023-08-04','X' FROM DUAL CONNECT BY ROWNUM < 401;
INSERT INTO T_PART SELECT ROWNUM,DATE'2023-08-05','D' FROM DUAL CONNECT BY ROWNUM < 301;
INSERT INTO T_PART SELECT ROWNUM,DATE'2023-08-06','E' FROM DUAL CONNECT BY ROWNUM < 201;

-- 收集T_PART_6分区的统计信息
BEGIN
  DBMS_STATS.GATHER_TABLE_STATS(OWNNAME          => 'SYSDBA',       -- 用户名
                                TABNAME          => 'T_PART',       -- 表名
                                PARTNAME         => 'T_PART_6',     -- 分区名
                                ESTIMATE_PERCENT => 100             ); -- 采样率
END;
```

  4. 查看统计信息



```
SELECT B.OBJECT_NAME,SUBOBJECT_NAME,OBJECT_TYPE,A.* 
  FROM SYSSTATS A, 
       ALL_OBJECTS B 
 WHERE A.ID = B.OBJECT_ID
   AND B.OBJECT_NAME ='T_PART' ORDER BY ID,COLID;
```

T_PART_6 的统计信息已收集。

![cfa0fde1c2fd00c753f5804ba964d69b_20231103091105D5TR49UNUXR7NQDI2A.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112164635DHP3I9MITKCFQDOON3)

## DEM 监控 DSC 集群，调用 dmcssm 监视器服务报错

【问题描述】

DEM 调用 dmcssm 监控查看 DSC 集群状态报错：

![3e377bc66c4ef72ba3a512ac2012fcff_20231130171426L37GNPAFRG2CDJ3XQY.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112164800C0CQV2RK5OZUZQ4714)

![d1b82a91b67249687b35747140762276_202311301716571Y052C4MOFWEGI5QHG.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112164807TP591Z2L0VUR3B3WP7)

【问题分析】

该报错是由于环境变量配置错误导致无法加载本地 dmcssm 服务导致。

【问题解决】

正确配置本地数据库的环境变量，包括 DM_HOME 以及 LD_LIBRARY_PATH 中的 bin 依赖路径。如下截图示例，用户需根据实际环境情况配置。

![fd748328376258568826e1d6448c5e52_20231130170903JHUSI3XM6KMJCPBPSB.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112164837GR125SYQOI7ESQPUWW)

修改成功后验证连接成功。

![8e93c8c86bb802475aacde231d611d8c_202311301712319SXAFQOTF7Z45E90ZH.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112164849Z22RTBNKO9WIA75KS0)

## CPU 使用异常，个别 CPU 使用率较高时，任有其他的 cpu 处于空闲状态

【问题描述】

通过 top 命令查看发现 CPU 只有 2 颗 CPU 在使用，其他的 CPU 处于空闲状态。

![da5c4b7e1382cc6a9fb69dd7788b3620_20231201113448YWR3KYL2KEVHN34G2K.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112165051FZF049M87OY36DAD6I)

【问题分析】

产生这种情况，主要是因为 CPU 划分不正确，导致 CPU 利用率上不来。

【解决办法】

  1. 登录数据库通过 v$license 视图查看 MAX_CPU_NUM 的值是多少，如果 MAX_CPU_NUM 的值为 2，那么数据库只能使用 2 个物理 cup；



![76cc6f857ef66f99bd77a448e4015ca5_20231201113827OY268DPRHYGOK5MPY3.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112165138OZ6WXERXS5N5IRVSU7)

  2. 使用 lscpu 命令查看 Socket(s) 和 Core(s) per socket。可以看到物理 cpu 配置为 8，每颗 cpu 的核心数配置为 1，但实际数据库支持的 cpu 个数为 2，那么 cpu 配置为 8 座 是不合理的。



![8104c600be8691ebc3624ead11cce21b_20231201113731JCMNW8BSSY17YXBHYJ.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112165157U0ZM8WSZ4KCDIU7LZD)

  3. 参考数据库中查询到的 MAX_CPU_NUM 的值修改云主机的 CPU 座数为 2 和每个座的核数为 4。



## 如何查出所有存储过程的依赖关系？

【问题解决】

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/2024111216532359WXPOSXAZA7DHON6L)

```
--将SQL语句中的SYSDBA替换成要查询的模式即可
   SELECT DOBJS.SCHEMA_NAME "模式名", 
          DOBJS.NAME "对象名称", 
          SOBJS.NAME "被依赖对象所属模式", 
          DOBJS.REFED_TYPE$ "被依赖对象类型", 
          OBJS.NAME "被依赖对象名", 
          TEXTS.TXT "对象定义"
     FROM (SELECT OBJPROC.NAME, 
                     OBJPROC.SCHEMA_NAME, 
                     SDEP.REFED_TYPE$, 
                     SDEP.REFED_ID 
                FROM SYSDEPENDENCIES SDEP 
          INNER JOIN (SELECT 
                              /*+ OPTIMIZER_OR_NBEXP(2) ORDER(PROC_OBJ_INNER, SCH_OBJ_INNER, USER_OBJ_INNER)*/ 
                              PROC_OBJ.ID, 
                              PROC_OBJ.NAME, 
                              SCH_OBJ.NAME "SCHEMA_NAME" 
                         FROM (SELECT ID, 
                                      NAME 
                                 FROM SYSOBJECTS 
                                WHERE TYPE$='SCH' 
                                  AND ID = (SELECT ID FROM SYSOBJECTS WHERE TYPE$='SCH' AND NAME ='SYSDBA')) SCH_OBJ, (SELECT PROC_OBJ_INNER.ID, 
                                      PROC_OBJ_INNER.NAME, 
                                      PROC_OBJ_INNER.CRTDATE, 
                                      PROC_OBJ_INNER.INFO1, 
                                      PROC_OBJ_INNER.SCHID, 
                                      PROC_OBJ_INNER.VALID 
                                 FROM SYSOBJECTS PROC_OBJ_INNER, 
                                      SYSOBJECTS SCH_OBJ_INNER, 
                                      SYSOBJECTS USER_OBJ_INNER
                                WHERE PROC_OBJ_INNER.SUBTYPE$='PROC'
                                  AND PROC_OBJ_INNER.TYPE$='SCHOBJ'
                                  AND PROC_OBJ_INNER.INFO1&0X01 = 0X01
                                  AND (PROC_OBJ_INNER.INFO1/4) 
                                      &0X01=0
                                  AND PROC_OBJ_INNER.SCHID = (SELECT ID FROM SYSOBJECTS WHERE TYPE$='SCH' AND NAME ='SYSDBA')
                                  AND USER_OBJ_INNER.SUBTYPE$ = 'USER'
                                  AND SCH_OBJ_INNER.ID = PROC_OBJ_INNER.SCHID
                                  AND SCH_OBJ_INNER.PID = USER_OBJ_INNER.ID
                                  AND SF_CHECK_PRIV_OPT(UID(), CURRENT_USERTYPE(), PROC_OBJ_INNER.ID, USER_OBJ_INNER.ID, USER_OBJ_INNER.INFO1, PROC_OBJ_INNER.ID) = 1) PROC_OBJ
                        WHERE PROC_OBJ.SCHID=SCH_OBJ.ID 
                     ORDER BY PROC_OBJ.NAME) OBJPROC 
                  ON SDEP.ID=OBJPROC.ID) DOBJS
LEFT JOIN SYSOBJECTS OBJS 
       ON DOBJS.REFED_ID = OBJS.ID
LEFT JOIN SYSOBJECTS SOBJS 
       ON OBJS.SCHID = SOBJS.ID 
      AND OBJS.SCHID != 0
LEFT JOIN SYSTEXTS TEXTS 
       ON OBJS.ID = TEXTS.ID;
```

## 如何清除 object_usage 视图中所有监控的索引信息

【问题描述】

索引监控一旦打开，v$object_usage 中将保存所有监控的索引信息。如果想清除该表数据以重新监控索引要如何操作？

【问题解决】

可以使用 SP_DYNAMIC_VIEW_DATA_CLEAR 函数来清除该动态视图数据。

```
call sp_dynamic_view_data_clear('V$OBJECT_USAGE');
```

## 如何设置命令行的前缀标识为用户名，IP，端口以及实例名

【问题描述】

Disql 登录时如何设置命令行的前缀标识为用户名，IP，端口以及实例名。

【问题解决】

在 dmdbms/bin/disql_conf 目录下配置 glogin.sql 文件，配置内容参考如下：

```
column instance_name new_value instance_name
select instance_name from v$instance;
set sqlprompt "_user'@'_connect_identifier(&instance_name)>"
```

![3e97dd787d0a1dc9ea32be071ad586eb_202312150926513WCEDRMV0334QU1IFH.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112165531K7EU0RA8AI4YXF3QRV)

## 表中大字段占用的空间如何回收

【问题描述】

数据库中，某表大字段占用 19G，当将大字段数据全部 update 为 null 或空串时，表依然占用 19G，不会自动回收空闲空间。

【问题解决】

可以在管理工具中使用【表】->【存储选项】->【清理大字段空闲页】功能，可以快速回收已释放的存储空间，或在将大字段数据全部 update 为 null 或空串后执行如下语句回收空闲存储空间：

```
call SP_TABLE_LOB_RECLAIM('模式','表');
```

示例如下：

  1. 查看表大小。



```
select
        t.owner              ,
        t.table_name         ,
        t.used_space_mb                       as MB,
        CAST (t.used_space_mb as number)/1024 as GB
from
        table_count t
where
        table_name like 'SWAP_RECEIVED_ZMW1107%'
order by
        GB desc
```

![96286362002b41df4537d28a9095f18b_2023122117050663WI2012S85ZWJS4HE.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112165716MOLWSQAS9P71AP0C3A)

```
select count(*) from "SYSTH_PAY"."SWAP_RECEIVED_ZMW1107"
```

![75467a98aa15d6732fd28842d0fd3b66_20231221170603IQNKUXK97M8CUGC6UW.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112165750J9TM4PGU1LG1818F1P)

查看表大字段列是否有 null 值。

```
select * from "SYSTH_PAY"."SWAP_RECEIVED_ZMW1107" where RECEIVE_BODY is null;
```

![035cac8860e266ee4f4d46250f6d0d81_20231221170814805H9VU1973SOW1DLC.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112165809ZLZ1CMAQVMCOL82DKH)

  2. 将大字段列置为 null。



RECEIVE_BODY 列为大字段列，将该列置为 null。

```
update "SYSTH_PAY"."SWAP_RECEIVED_ZMW1107" set RECEIVE_BODY = null;
```

![8cca402099077f7a033f8b32662fc478_20231221171129H2QT8ZGRMU9KFGDHYM.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121658479XQVCXHHD8DPHM0BS2)

```
select count(*) from "SYSTH_PAY"."SWAP_RECEIVED_ZMW1107" where RECEIVE_BODY is null;
```

![7339f5b0ee48a7a5189cc799c5ea422c_20231221171528X2C7KU654J8V75GQTG.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112165910K5TUV62CXE284BVCVH)

```
select
        t.owner              ,
        t.table_name         ,
        t.used_space_mb                       as MB,
        CAST (t.used_space_mb as number)/1024 as GB
from
        table_count t
where
        table_name like 'SWAP_RECEIVED_ZMW1107%'
order by
        GB desc
```

![96286362002b41df4537d28a9095f18b_2023122117050663WI2012S85ZWJS4HE.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112170015OTJT9P6LTMD8KIAJG5)

可以看到将大字段列全部变为 null 后，表大小并未变小，空闲空间未回收。

![50dbab1cb7cc7c1063588964ec3f7d81_20231221172239K2EQ1VMJ3L67KM48H3.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112170029K9SV8WYCR2NFFXQJGC)

```
select
        t.owner              ,
        t.table_name         ,
        t.used_space_mb                       as MB,
        CAST (t.used_space_mb as number)/1024 as GB
from
        table_count t
where
        table_name like 'SWAP_RECEIVED_ZMW1107%'
order by
        GB desc
```

![993ac4c0daf3f25afd1174d63e1c1ff1_20231221172347IFTA4TSOCA5FYM6YBG.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121700521CNU39WXE52V1OKL0F)

可以看到已经回收大字段列的空闲空间。

方法二：执行 `call SP_TABLE_LOB_RECLAIM('模式','表')` 语句，回收空闲空间。

```
call SP_TABLE_LOB_RECLAIM('SYSTH_PAY','SWAP_RECEIVED_ZMW1107');
```

![8cfdabe807f96b6eee7942c5fc149e8e_202312211726492DY2BYW38VKN2CA5ON.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121702038CO631HKB84WLU9ICE)

```
select
        t.owner              ,
        t.table_name         ,
        t.used_space_mb                       as MB,
        CAST (t.used_space_mb as number)/1024 as GB
from
        table_count t
where
        table_name like 'SWAP_RECEIVED_ZMW1107%'
order by
        GB desc
```

![ee8f08453ab905cca2616e07376ddece_20231221172716JRFE9ZQX4X8RSWTNBY.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112170236WCDAJRLLB8TIXX0BFN)

## ET 不显示结果

【问题描述】

ENABLE_MONITOR、MONITOR_TIME、MONITOR_SQL_EXEC 三个参数均已开启，但是管理工具中 ET 有时候不显示结果。

【问题解决】

  1. ET 能出结果的前提是，SQL 查询完所有结果，如果结果集过大，可以用 limit 或 TOP 获取一部分数据。
  2. 管理工具中执行 SQL，如果结果集未加载完想要查看 ET 信息，可在执行该 SQL 的窗口执行 ET(执行号)显示结果。



## 扩容临时表空间报错：“超出数据库表空间数量限制，请检查 TS_MAX_ID 参数”

【问题描述】

使用如下 sql 扩容临时表空间时报错：“超出数据库表空间数量限制，请检查 TS_MAX_ID 参数”。

```
alter tablespace temp resize datafile 'TEMP.DBF' to 2048;
```

![ca70e7a638a7231b610d4ca7b56c5358_20231228095443CP9K0Q96A633WFT4JI.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112170327AX1MS9CI5XZMJIF832)

【问题分析】

根据报错信息“超出数据库表空间数量限制”可以推测是由于扩展上限达到了设置的临时表空间上限导致。

【问题解决】

根据实际需求适当放大临时表空间上限。

  1. 查询当前临时表空间上限设置大小。



```
select PARA_NAME,PARA_VALUE from v$dm_ini where para_name='TEMP_SPACE_LIMIT'
```

![b3157115a785463257b87e25becf7bce_20231228095316OTR6HN7S4G0THYFI8S.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112170836KP6SIHKV884FHX9WKP)

  2. 根据实际需求增加临时表空间上限大小。



```
 sp_set_para_value（2,'TEMP_SPACE_LIMIT',4096);
```

![3991432b029ec5cedd6e0b233dfebc29_202312281000318IGPCOYVPC59K05HAQ.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112170858356B3HW2AJ5G629FGI)

  3. 重新执行 sql 扩大临时表空间大小。



```
alter tablespace "TEMP" resize datafile 'TEMP.DBF' to 2048;
```

![7ff9acbc76b5ff69aa30e43f4a85dd15_20231228100514R4M2ITG5QTZMPVJMMD.png](https://eco.dameng.com/eco-file-server/file/eco/preview/2024111217092362LTX1IMLD599G09EK)

## 客户端管理工具如何在消息框打印所有执行的内容

【问题描述】

客户端管理工具调整存储过程时，需要打印执行的内容，当打印的内容过长则无法输出到界面。如下图打印的结果并没有输出到窗口。

![96fc947b90338e2ab8b2e889dc33393b_202312281037320W7ZHADPT7R3XN153J.png](https://eco.dameng.com/eco-file-server/file/eco/preview/202411121709556CZ4VA8O959O2BHBZF)

【问题解决】

![94fb28bb9621e10292d20e649d3ce89a_20231228103813N3BX93G0BTRXWDLJND.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112171012HBWAUQ9O1DG4UOUNPZ)

![b7dc31416b483d1e7f384eeb461d49d0_20231228104030HMXBVGTJXE1MEEKQK5.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112171030946DYIQOW5QFZI43IB)

![00dcba80230091acee15967887ad107f_20231228104051AA0QIIG8A0PGBAY9UX.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112171046CMGQLS1R3C2VECW7RA)

## 通过 dblink 向 oracle 端表插入 BLOB 字段数据时报错："字符不完整“

【问题描述】

![f2a6ab343e1be8df2d21a30956ae79e2_20240111094706Y6P9V06WNOYMLGQ2WN.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112171126BH8XOFJPUYFUZZLWNW)

【问题解决】

可通过创建 dblink 时添加 local_code 参数绕过此问题。

例如：如下使用如下创建的 dblink 向 oracle 端表插入 BLOB 字段数据时报错"字符不完整”。

```
create or replace link dm_ora connect 'ORACLE' with stu identified by 123456789 using '10.15.1.20:1521/orcl' ;
```

通过创建 dblink 时添加 local_code 参数绕过此问题。

```
create or replace link dm_ora connect 'ORACLE' with stu identified by 123456789 using '10.15.1.20:1521/orcl' option (local_code='GBK');
```

参数说明：

local_code：接口(DPI、OCI、JDBC 等接口)的字符集。若与服务器的字符集不一致，则需要进行转换。可取值为 UTF-8，GBK 或 GB18030。

## 如何查询某个表的大字段空间占用大小

【问题解决】

```
   select obj.name, 
          seg.n_extent*sf_get_page_size()*sf_get_extent_size()/1024/1024 MB 
     from sysobjects obj 
left join v$lob_seg seg 
       on obj.id=seg.tab_id
    where obj.name ='表名';
```

## 如何通过 SQL 查看当前库中的作业状态是否启用

【问题解决】

```
select name, 
       CASE ENABLE WHEN '1'THEN '已启用' when '0' THEN '已禁用' end as enable 
  from USER_JOBS_VIEW;
```

## 如何查询分区子表的对象大小和占用空间

【问题解决】

可参考如下 SQL 查询分区表的每个分区的对象大小和占用空间，便于评估分区表数据量。

```
select schname,ptab,subtabname,
TABLE_USED_PAGES(schname,subtabname)*page()/1024/1024.0 as "子表对象大小_MB",
TABLE_USED_SPACE(schname,subtabname)*page()/1024/1024.0 as "子表占用空间_MB"
from
(select SF_GET_SCHEMA_NAME_BY_ID(b.schid) as schname,b.name as subtabname,a.name as ptab
from sysobjects a,sysobjects b
where a.id=b.pid
and b.subtype$='UTAB' and a.name='<分区表名>')
order by 3;
```

![3eedbe13d2f5661483b75d56a9348a3d_20240307101418QQY0EAVRCCCCGEG299.png](https://eco.dameng.com/eco-file-server/file/eco/preview/2024111217143740K4AW4KYC1ANFPGEE)

## 如何查看当前 DML 事务执行进度

【问题解决】

当存在活动事务时，可以查询事务当前进度（执行时间、插入行数、删除行数、更新行数、是否正在回滚）便于判断事务当前状态。可以参考如下 SQL 进行查询：

```
SELECT DATEDIFF(SS,LAST_RECV_TIME,SYSDATE) SS,
      S.LAST_RECV_TIME,
      S.SESS_ID,
      T.THRD_ID,
      T.ID,
      S.SQL_TEXT,
      SF_GET_SESSION_SQL(S.SESS_ID) AS SQL_FULL_TEXT,
      T.STATUS,
      T.INS_CNT,
      T.DEL_CNT,
      T.UPD_CNT,
      T.UPD_INS_CNT,
      T.WAITING,
      T.START_LSN,
      T.ROLLBACK_FLAG,
      T.LOCK_CNT,
      S.AUTO_CMT,
      S.CONNECTED,
      S.CLNT_IP,
      S.USER_NAME
FROM V$SESSIONS S,V$TRX T
WHERE S.TRX_ID=T.ID
AND S.STATE='ACTIVE'
AND S.SESS_ID<>SESSID;
```

![e675b5e6b737330dcfd040c61851b4ac_20240307101636D5HT77WQIAKK12WYCV.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112171512SURPT623BMTOW854AU)

## 如何使图形化工具查询出来的数据不全是明文

【问题描述】

使用图形化管理工具运维时，所有表数据都明文显示，是否可以通过设置，设置部分表的数据不要显示出来，增加隐私性？

【问题解决】

可通过使用 DBMS_RLS 设置相关策略来实现，示例如下：

  1. 登录管理用户执行以下语句设置参数 ENABLE_RLS 的值为 1，执行完成后重启数据库实例生效。



```
ALTER SYSTEM SET 'ENABLE_RLS' =1 SPFILE;
commit;
```

  2. 使用 SYSDBA 创建测试用户 TEST，并赋予角色。



```
CREATE USER "TEST" IDENTIFIED BY "123456789";
GRANT "DBA" TO "TEST";
GRANT "PUBLIC" TO "TEST";
GRANT "RESOURCE" TO "TEST";
GRANT "SOI" TO "TEST";
GRANT "VTI" TO "TEST"; 
COMMIT;
```

  3. 登录 TEST 用户，创建测试表,插入测试数据。



```
CREATE TABLE TEST.TABLE_1(C1 VARCHAR2(10) ,C2 NUMBER(10));
INSERT INTO TEST.TABLE_1 VALUES('A',10);
INSERT INTO TEST.TABLE_1 VALUES('B',20);
INSERT INTO TEST.TABLE_1 VALUES('C',30);
commit;
create index idx_text on TEST.TABLE_1(C1);
```

  4. 登录 TEST 用户创建策略函数。



```
create OR REPLACE function TEST.RLS_FUN_CHAR(p_owner in varchar2, p_obj   in varchar2)
  return varchar(8188) is
  l_ret varchar(8188);
  app varchar(8188);
begin
SELECT substr(APPNAME,0,7) into app FROM V$SESSIONS WHERE SESS_ID=SESSID ;
 return  app != 'manager';
end;
```

  5. 登录 TEST 用户创建掩码函数。



```
create or replace function TEST.MF(c1 varchar) return varchar as
begin
return 'xxxxxx';
end;
```

  6. 登录 TEST 用户创建策略。



```
begin
    dbms_rls.add_policy(object_schema         => 'TEST',         --模式名
                        object_name           => 'TABLE_1',      --表名
                        policy_name           => 'TABLE_1_C1',   --策略名
                        function_schema       => 'TEST',         --函数所属模式
                        policy_function       => 'RLS_FUN_CHAR', --函数名
                        statement_types       => 'select',       --语句
                        sec_relevant_cols     => 'C1',           --列名
                        sec_relevant_cols_opt => dbms_rls.all_rows);
end;
```

  7. 登录 TEST 用户添加掩码策略。



```
DBMS_RLS.ADD_MASK('TEST', 'TABLE_1', 'C1', 'TEST', NULL, 'MF');
```

  8. 使用测试用户 TEST 查询测试表（CI 列已非明文显示）。



```
select * from TABLE_1;
```

![bc411f5ef9ae2f57a318a0f6693085e3_20240322095401KYN0RD88B742YJ40SG.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112171940WY2RRYM1U0DMCCVOJA)

> **注意**
>
> 2023 年第三季度及以后的版本才支持此功能。



## 如何更换图形化工具 Mganger-DM 管理工具连接数据库的驱动

【问题解决】

图形化工具 Mganger-DM 管理工具连接数据库驱动的路径为：数据库软件安装目录：\tool\dropins\com.dameng\plugins\com.dameng.jdbc.drivers，在目录下找到 DmJdbcDriver.jar 文件将其更换后，重新打开 DM 管理工具即可。

## 表空间文件达到上限后如何继续添加

【问题描述】

新增表空间文件，抛出“超出表空间文件数量限制，请检查 TS_FIL_MAX_ID 参数"报错，在不调整单个表空间文件上限情况下，如何继续新增表空间文件？

【问题解决】

在 dm.ini 文件中 TS_FIL_MAX_ID 参数对表空间文件数量进行了限制，目前版本默认 255，可以通过适当调整此参数继续增加表空间文件数量，该参数是静态参数，调整后需重启数据库生效。

## 重建系统包报错：“无效的过程/函数名”

【问题描述】

![a8befff4a631861b434115294f352764_202409110946096LQCEJVXVFYM1XA5L1.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241112172325G4WG0O4VGCHKBRS771)

【问题分析】

排查发现数据库开启了 oracle 兼容参数（COMPATIBLE_MODE=2），当开启该参数时需要同步开启 ORA_DATE_FMT=1 才可以正常重建系统包。

【问题解决】

设置参数 ORA_DATE_FMT=1，重启数据库。

参数说明：

|**参数说明**|**默认值**|**属性**|**说明**|
|----|----|----|----|
|ORA_DATE_FMT|0|静态|指定 DATE 类型格式。0：DATE 类型使用 NLS_TIMESTAMP_FORMAT 格式；1：DATE 类型使用 NLS_DATE_FORMAT 格式。注：仅当 COMPATIBLE_MODE 为 2 时有效。|


## docker 环境修改数据库参数报错：“磁盘空间不足”

【问题描述】

![03b6bb04a23c1d558aab52e9845ef6b3_20240911095548PS3BJ8LWOIWDC44JT1.png](https://eco.dameng.com/eco-file-server/file/eco/preview/2024111217254350BFSJZB02EXIAXTAW)

【问题分析】

排查发现，实例所在路径的用户及所属组为 root，在 docker 环境下，会导致修改数据库参数报错。

【问题解决】

可通过修改实例所在路径用户组权限（chown dmdba:dinstall 实例所在路径）解决该问题。

## 归档路径的已用大小超出了归档配置的 arch_space_limit 大小

【问题描述】

查看数据库服务器存储使用情况发现归档路径的已用大小超出了归档配置的 arch_space_limit 大小，或归档日志并未达到 arch_space_limit 大小但数据库异常。

【问题分析】

如果归档路径中有其他非归档文件，数据库并不能管理这些文件。

归档路径空间如果足够大，由于有其它文件存在，通过命令检查归档路径空间大小会大于 arch_space_limit 限制的大小。

如果归档路径空间大小是按照 arch_space_limit 限制的大小严格配置的，此时如果有其它文件在该路径下，则会导致归档保存空间不足，数据库异常。

## DMDPC 集群怎么查询哪些列未启用压缩

【问题描述】

DMDPC 集群中经常使用 huge 表并启用了压缩，随着业务的上线升级，存在对 huge 添加列的需求，而新增列默认并没有启用压缩，导致空间使用率较高，怎么查询哪些列未启用压缩？

【问题解决】

主要涉及数据字典 SYSCOLUMNS，列压缩信息存储其列 info1 中，需要对其解析，其规则为：info1 转换二进制后的倒数第 9 至 13 位为该列的压缩级别。

  1. 创建十进制到二进制转换函数。



```
CREATE OR REPLACE FUNCTION NUMBER_TO_BIT(V_NUM NUMBER)
RETURN VARCHAR IS V_RTN VARCHAR(800);--注意返回列长度
  V_N1  NUMBER;
  V_N2  NUMBER;
BEGIN
V_N1 := V_NUM;
    LOOP
      V_N2  := MOD(V_N1, 2);
      V_N1  := ABS(TRUNC(V_N1 / 2));
      V_RTN := TO_CHAR(V_N2) || V_RTN;
      EXIT WHEN V_N1 = 0;
    END LOOP;
--返回二进制长度
 SELECT lpad(V_RTN,64,0)
    INTO   V_RTN
    FROM dual;
return V_RTN;
end;
```

  2. 创建二进制到十进制转换函数。



```
CREATE OR REPLACE FUNCTION binary_to_num (pbin VARCHAR2) 
RETURN BIGINT DETERMINISTIC
IS  
   v_len   INT := LENGTH (pbin);  
   v_num   BIGINT := 0;  
BEGIN  
   FOR i IN 1..v_len LOOP  
      IF SUBSTR(pbin, i, 1) = '1' THEN  
         v_num := v_num + POWER(2, v_len - i);  
      END IF;  
   END LOOP;  
   RETURN v_num;  
END binary_to_num;
```

  3. 查询 huge 未启用压缩的列信息。



```
select username,
       id,
       name,
       lvl,
       colcnt,
       huge_table_used_space(username, name) used_MB
  from (select tn1.name username,
               tn.*,
               count(*) over(partition by tn.id, tn.name order by tn.id) lvlcnt
          from (select schid, id, name, lvl, count(*) colcnt
                  from (select t.schid,
                               t.id,
                               t.name, --NUMBER_TO_BIT(tc.info1),
                               binary_to_num(substr(NUMBER_TO_BIT(tc.info1),
                                                    -13,
                                                    4)) lvl
                          from SYSCOLUMNS tc, sysobjects t
                         where tc.id = t.id
                           and (t.INFO3 &0X3F) BETWEEN 0X21 AND 0X27
                           AND t.PID = -1)
                 group by schid, id, name, lvl) tn,
               sysobjects tn1
         where tn.schid = tn1.id)
 where lvlcnt > 1
 order by 6 desc;
```

  4. 对应已经添加的未启用压缩列的表，建议表重建。
  5. 对已启用压缩的 huge 表，正确的添加列语句如下：



```
alter table t add column c3 varchar(100) compress level 5;
```

## 有哪些方法可以获取当前会话的事务 id？

【问题解决】

  1. 通过包 DBMS_TRANSACTION。



```
select DBMS_TRANSACTION.LOCAL_TRANSACTION_ID();
```

  2. 通过函数 tid。



```
select tid ;
```

  3. 通过 v$sessions 视图。



```
select trx_id from v$sessions where sess_id=sessid;
```

## DM 中创建表、索引，会修改哪些字典表？

【问题分析】

通过开启 autotrace，可以跟踪显示修改了哪些数据字典。

验证步骤：

  1. 通过 disql 登录数据库，并开启 autotrace。



```
set autotrace traceonly
```

  2. 创建表。



```
SQL> create table t as select * from dual;
executed successfully

1   #INSERT : [0, 0, 0]; table(SYSOBJECTS), type(values) mpp_opt(0)
1   #INSERT : [0, 0, 0]; table(SYSCOLUMNS), type(values) mpp_opt(0)
1   #INSERT : [0, 0, 0]; table(SYSOBJECTS), type(values) mpp_opt(0)
1   #INSERT : [0, 0, 0]; table(SYSINDEXES), type(values) mpp_opt(0)
1   #INSERT : [0, 0, 0]; table(SYSOBJINFOS), type(values) mpp_opt(0)

```

从以上执行计划可知，创建表操作对 SYSOBJECTS、SYSINDEXES、SYSCOLUMNS、SYSOBJINFOS 字典表执行了 insert 操作。

## 在 dmdpc 集群环境中，怎么查看用户默认表空间组？

【问题分析】

在 dmdpc 集群环境中，怎么查看用户默认表空间组？dba_users 视图中没有记录该信息。

【问题解决】

可以通过查询用户定义获取，参考命令如下：

```
select dbms_metadata.get_ddl('USER','USERNAME');
--其中包含：default tablespace group xxxx
```

## 函数 REGEXP_LIKE 执行报错

【问题描述】

函数 REGEXP_LIKE 执行报错：[-2207]:Error in line 1 Member access [REGEXP_LIKE] unresolved，怎么解决？

【问题解决】

触发该错误是由于数据库 bin 目录中缺少文件 libregex.dll（windows）或 libregex.so（linux）库文件，可尝试通过从其他环境拷贝该文件到 bin 目录下，并重启数据库解决。

## 达梦管理工具如何禁用 IPV6 登录数据库

【问题描述】

数据库服务器只分配了 IPV4，在 windows 上使用 DM 管理工具连接不上数据库，报错网络通信异常，但是同一机器上的 disql 命令和 dts 可以连通。

【问题分析】

由于数据库服务器只分配了 IPV4， windows 上 dts 默认安装时指定参数 Djava.net.preferIPv4Stack=true，此参数为优先使用 IPV4 连接，而管理工具默认没有，所以会发生 dts 连接成功，但管理工具连接不上。

【问题解决】

通过在 DM 管理工具目录下的 manager.ini 中添加 -Djava.net.preferIPv4Stack=true 参数来解决，此参数为优先使用 ipv4 连接。

参数说明：

在 java 中 java.net.preferIPv4Stack 默认为 false，在支持 IPv6 的双栈系统上，使用 Java 的 Socket 会默认通过底层 native 方法创建一个 IPv6 Socket，这个 IPv6 Socket 可以同时支持和 IPv4 或 IPv6 主机通信。如果设置为 true，Java 程序将无法使用 IPv6 进行网络通信，也就是仅支持 IPv4。

类似参数还有 java.net.preferIPv6Addresses，当 java.net.preferIPv6Addresses 为默认值 false 时，IPv4 地址会优先使用，例如在 DNS 通过域名查询 IP 地址时，会优先使用 IPv4 地址，反之设为 true，则会优先使用 IPv6 地址。

## 如何配置可在任意目录下执行 disql 等命令

【问题描述】

在运维过程中，执行达梦命令，在默认情况下，我们环境变量会写入 LD_LIBRARY_PATH 和 DM_HOME 的达梦环境变量，但是我们在执行命令时，需要绝对路径或者进入到 DM_HOME/bin 目录下执行，运维相对不便捷，无法任意目录执行 disql 以及 dmrman，DmServer，DmWater 等脚本。

【问题解决】

成功添加环境变量即可在任意目录执行达梦命令，参考如下：

```
su - dmdba
vi  ~/.bash_profile
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/home/dmdba/dmdbms/bin"
export DM_HOME="/home/dmdba/dmdbms"
export PATH=$PATH:$DM_HOME/bin:$DM_HOME/tool:$LD_LIBRARY_PATH
source   ~/.bash_profile
```

## 如何修改作业拥有者

【问题描述】

将作业创建在普通用户下时，如果因特殊情况，暂时无法登录到普通用户，且此时作业出现故障，尝试使用 SYSDBA 执行作业测试时，会报错，提示“只允许作业拥有者运行”，如下图：

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241121132846LOHKHNOVGFRH19PWNJ)

【问题解决】

可以使用 SYSDBA 用户执行如下语句，临时修改对应作业所属模式：

```
call SP_JOB_SET_SCHEMA('JOBNAME', 'USERNAME');
```

参数说明：

JOB_NAME：作业名称。必须是有效的标识符，同时不能是 DM 关键字。作业必须存在，否则报错。

SCHEMA_NAME：模式名称。必须是有效的模式，否则报错。

修改过后，需右键代理-作业进行刷新，即可看到作业拥有者已变更。

此时即可使用相应的用户正常测试作业。后续可使用上诉语句将作业拥有者改回去。更改拥有者不会清空作业历史执行记录。

## 如何保证新插入的数据在查询时不展示含有的反斜杠

【问题描述】

varchar 类型的数据，insert 插入的数据内容中存在反斜杠，在 select 查询的时候如何保证不展示含有的反斜杠。

【问题解决】

可通过设置参数 BACKSLASH_ESCAPE=1 来解决，该参数是静态参数，需要重启数据库生效。

> **注意**
>
> 修改参数 BACKSLASH_ESCAPE=1 后只对新插入的数据中含有反斜杠生效。



示例：

  1. 设置 BACKSLASH_ESCAPE=1 ，并重启数据库。
  2. 创建表并插入数据。



```
drop table test2;
create table test2 (name char(200) );
insert into test2 values('[{\"type\": \"USERINPUT\"}] ');
commit;
```

  3. 查询数据。



```
select  * from  test2;
```

![image.png](https://eco.dameng.com/eco-file-server/file/eco/preview/20241121145122OQVU5GXAAPIMXBMREK)

## 如何允许较多的定时任务或异步任务同时执行

【问题描述】

如何处理同时间较多的定时任务或异步任务需要执行时，个别任务不执行情况。

【问题分析】

定时任务和异步任务与 task_threads 参数有关，该参数设置过小时，同时执行的任务有限制。例如设置 task_threads=8，同时执行的任务超过 8 个时，个别任务可能会出现不执行情况。

【问题解决】

可通过适当调大该参数 task_threads 解决该问题。

task_threads 参数解释： 任务线程个数。静态，默认值 16；非 DMDSC 环境取值范围 1~1000；

DMDSC 环境取值范围 16~1000。
