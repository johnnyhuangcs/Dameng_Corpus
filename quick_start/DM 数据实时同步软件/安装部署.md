

# 安装部署

在安装 DMHS 之前，请用户仔细阅读安装手册，在安装开始之前，首先应该检查所得到的 DMHS 产品是否完整，并准备好 DMHS 所需的硬件环境、软件环境。

## 一、DMHS 产品完整性检查

DMHS 主要用于数据库的数据实时同步系统，需要同步的源端数据库与目的端数据库（含操作系统及硬件信息）必须在获取版本前已明确。

  1. 如果源端数据库平台与目的端数据库平台完全一致（数据库类型、操作系统、硬件架构），则只需要一个 DMHS 产品版本，DMHS 版本不区分源端软件与目的端软件。
  2. 如果源端数据库平台与目的端数据库平台不一致，则需要两个对应的 DMHS 版本。



## 二、软硬件环境需求

源端的 DMHS 必须安装在源端数据库所在机器，目的端则可以根据所获得版本的操作系统硬件环境选择合适的主机。硬件环境通常包括网络环境(如一个局域网)。如果仅有单台 PC，DMHS 也允许将所有软件装在同一台 PC 上使用。

操作系统：Windows（简体中文服务器版 sp2 以上）/Linux（glibc2.3 以上，内核 2.6，已安装 KDE/GNOME 桌面环境）。

## 三、DMHS 的安装

  * Linux 执行：./dmhs_V0.0.0_dm8_rev00000_rh6_64_veri_20200522.bin 如果没有图形化界面，则可以在此命令后面加上 -i 选项，使用字符安装模式。
  * Windows 双击 dmhs_V0.0.0_dm8_rev00000_win64_veri_20200522.exe，运行安装程序。



详细操作，请详见安装指导手册《DMHS-Install-Guide》。

## 四、产品许可

根据版本的用途，安装 DMHS 程序后，默认装有一个许可证 (License)，使用期限为：自编译之日起 3 个月，License 的载体是一个加密文件 dmhs.key。如果用户想拥有更多授权的许可证，请联系达梦公司申请或购买。

用户获得 License 文件 dmhs.key 后，首先将达梦数据实时同步服务关闭，然后将 dmhs.key 复制到 DMHS 同步服务运行目录（安装目录下 bin 目录）。

> **注意**
>
> key 文件名称必须为 dmhs.key，若获取的 key 文件名称不是这个，请重命名。



## 五、配置 DMHS

在图形化安装程序安装完成后，可以通过配置助手 HSCA，进行 DMHS 的配置。

![HSCA](https://download.dameng.com/eco/docs/asset/start/dmhs-002.png)

还可以通过达梦数据实时同步管理平台 HSEM，进行 web 页面配置。

![HSCA](https://download.dameng.com/eco/docs/asset/start/dmhs-003.png)

## 六、启动 DMHS 服务

达梦数据实时同步管理平台 HSEM，进行操作。

## 七、初始装载

当源端业务不能停止，但是有需要将源端的表数据迁移到目的数据库，此时可以使用 DMHS 的初始装载。启动初始装载的时候源端捕获进程必须停止，只启动 DMHS 管理进程。停止 cpt 的命令为 `Stop cpt`
如果源端只部署了 cpt，没有 exec 也可以使用 stop 命令停止。

使用初始化装载命令 `COPY 0 “sch.name=***” DICT|LSN|CREATE|INSERT|INDEX` 多线程并发装载。

## 八、开启同步

开启源端同步服务，初始装载完成后，则可以开启同步：

```
./dmhs_console
DMHS>start
```

开启目的端同步服务，作为系统服务器的，在 dmhs_serverd 配置完成的情况下，使用下面命令启动：

```
linux：
./dmhs_serverd start
windows:
net start dmhs_server
```

或者，进入 DMHS 安装程序的 bin 目录，执行以下命令：

```
linux：
./dmhs_server
windows:
dmhs_server.exe
```

也可以通过达梦数据实时同步管理平台 HSEM，进行操作。

> **建议**
>
> 如果您安装了 DMHS 数据实时同步软件，可参考在安装目录的 \`\doc\` 子目录中找到 DMHS 数据实时同步软件的各种手册。


